# NodeJSå­¦ä¹ 

## ä¸€ã€ç®€ä»‹

### 1.1 ç®€ä»‹

Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚

å®ƒé‡‡ç”¨äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O æ¨¡å‹ï¼Œä½¿å…¶è½»é‡ä¸”é«˜æ•ˆï¼Œå°¤å…¶é€‚åˆæ•°æ®å¯†é›†å‹å®æ—¶åº”ç”¨ã€‚ 

### 1.2 ä½¿ç”¨åœºæ™¯

|ä½¿ç”¨åœºæ™¯|ç¤ºä¾‹|
| ---- | ---- |
| æœåŠ¡å™¨ç«¯å¼€å‘ | webæœåŠ¡å™¨ |
| å¼€å‘å·¥å…·ç±»åº”ç”¨ | vscodeç­‰ |
| æ¡Œé¢åº”ç”¨å¼€å‘ | electronæ¡†æ¶å¼€å‘è·¨å¹³å°æ¡Œé¢åº”ç”¨ |

### 1.3 ä¸‹è½½å®‰è£…

å®˜ç½‘ä¸‹è½½ï¼š[https://nodejs.org/zh-cn/download](https://nodejs.org/zh-cn/download)ï¼Œæ¨èä½¿ç”¨LTSç‰ˆæœ¬

å®‰è£…åï¼Œä½¿ç”¨nodeå‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬

```
C:\Users\kk>node -v
v22.14.0
```

### 1.4 å‰ç«¯æ ¸å¿ƒæŠ€æœ¯ä½“ç³»

![](./images/1.png)

### 1.5 å­¦ä¹ æ•™ç¨‹

å°šç¡…è°·è§†é¢‘ï¼š[https://www.bilibili.com/video/BV1gM411W7ex/](https://www.bilibili.com/video/BV1gM411W7ex/)

### 1.6 æ³¨æ„äº‹é¡¹

- æµè§ˆå™¨ä¸­çš„Javascript

![](./images/2.png)

- Node.jsä¸­çš„Javascript

![](./images/3.png)

æ³¨æ„ï¼š

1. Node.jsä¸­ä¸èƒ½ä½¿ç”¨BOMå’ŒDOMçš„APIï¼Œå¯ä»¥ä½¿ç”¨consoleå’Œå®šæ—¶å™¨API

2. Node.jsä¸­çš„é¡¶çº§å¯¹è±¡ä¸ºglobalï¼Œä¹Ÿå¯ç”¨globalThisè®¿é—®é¡¶çº§å¯¹è±¡(globalThis === global)

### 1.7 ç›¸å…³èµ„æ–™

https://nodejs.cn/

## äºŒã€Buffer

### 2.1 æ¦‚å¿µ

Buffer æ˜¯ä¸€ä¸ªç±»ä¼¼äºæ•°ç»„çš„ `å¯¹è±¡` ï¼Œç”¨äºè¡¨ç¤ºå›ºå®šé•¿åº¦çš„å­—èŠ‚åºåˆ—

Buffer æœ¬è´¨æ˜¯ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œä¸“é—¨ç”¨æ¥å¤„ç† `äºŒè¿›åˆ¶æ•°æ®` ã€‚

![](./images/4.png)

### 2.2 ç‰¹ç‚¹

1. Buffer å¤§å°å›ºå®šä¸”æ— æ³•è°ƒæ•´
2. Buffer æ€§èƒ½è¾ƒå¥½ï¼Œå¯ä»¥ç›´æ¥å¯¹è®¡ç®—æœºå†…å­˜è¿›è¡Œæ“ä½œ
3. æ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º 1 å­—èŠ‚ï¼ˆbyteï¼‰

![](./images/5.png)

### 2.3 ä½¿ç”¨

#### 1. åˆ›å»º Buffer

Node.js ä¸­åˆ›å»º Buffer çš„æ–¹å¼ä¸»è¦å¦‚ä¸‹å‡ ç§ï¼š

1. Buffer.alloc

```javascript
//åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º 10 å­—èŠ‚çš„ Bufferï¼Œç›¸å½“äºç”³è¯·äº† 10 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œæ¯ä¸ªå­—èŠ‚çš„å€¼ä¸º 0
let buf_1 = Buffer.alloc(10); // ç»“æœä¸º <Buffer 00 00 00 00 00 00 00 00 00 00>
```

2. Buffer.allocUnsafe

```javascript
//åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º 10 å­—èŠ‚çš„ Bufferï¼Œbuffer ä¸­å¯èƒ½å­˜åœ¨æ—§çš„æ•°æ®, å¯èƒ½ä¼šå½±å“æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥å«
unsafe
let buf_2 = Buffer.allocUnsafe(10);
```

3. Buffer.from

```javascript
//é€šè¿‡å­—ç¬¦ä¸²åˆ›å»º Buffer
let buf_3 = Buffer.from('hello');
//é€šè¿‡æ•°ç»„åˆ›å»º Buffer
let buf_4 = Buffer.from([105, 108, 111, 118, 101, 121, 111, 117]);
```

#### 2. Buffer ä¸å­—ç¬¦ä¸²çš„è½¬åŒ–

æˆ‘ä»¬å¯ä»¥å€ŸåŠ© toString æ–¹æ³•å°† Buffer è½¬ä¸ºå­—ç¬¦ä¸²

```javascript
let buf_4 = Buffer.from([105, 108, 111, 118, 101, 121, 111, 117]);
console.log(buf_4.toString())
```

> toString é»˜è®¤æ˜¯æŒ‰ç…§ utf-8 ç¼–ç æ–¹å¼è¿›è¡Œè½¬æ¢çš„ã€‚

#### 3. Buffer çš„è¯»å†™

Buffer å¯ä»¥ç›´æ¥é€šè¿‡ [] çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚

```javascript
//è¯»å–
console.log(buf_3[1]);
//ä¿®æ”¹
buf_3[1] = 97;
//æŸ¥çœ‹å­—ç¬¦ä¸²ç»“æœ
console.log(buf_3.toString());
```

> æ³¨æ„:
> 1. å¦‚æœä¿®æ”¹çš„æ•°å€¼è¶…è¿‡ 255 ï¼Œåˆ™è¶…è¿‡ 8 ä½æ•°æ®ä¼šè¢«èˆå¼ƒ
> 2. ä¸€ä¸ª utf-8 çš„å­—ç¬¦ ä¸€èˆ¬ å  3 ä¸ªå­—èŠ‚

## ä¸‰ã€fsæ¨¡å—

fs å…¨ç§°ä¸º file system ï¼Œç§°ä¹‹ä¸º æ–‡ä»¶ç³»ç»Ÿ ï¼Œæ˜¯ Node.js ä¸­çš„ å†…ç½®æ¨¡å— ï¼Œå¯ä»¥å¯¹è®¡ç®—æœºä¸­çš„ç£ç›˜è¿›è¡Œæ“ä½œ

### 3.1 æ–‡ä»¶å†™å…¥

æ–‡ä»¶å†™å…¥å°±æ˜¯å°† æ•°æ® ä¿å­˜åˆ° æ–‡ä»¶ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•æ¥å®ç°è¯¥æ•ˆæœ

| æ–¹æ³•                      | è¯´æ˜     |
| ------------------------- | -------- |
| writeFile                 | å¼‚æ­¥å†™å…¥ |
| writeFIleSync             | åŒæ­¥å†™å…¥ |
| appendFile/appendFileSync | è¿½åŠ å†™å…¥ |
| createWriteStream         | æµå¼å†™å…¥ |

#### 1. writeFile å¼‚æ­¥å†™å…¥

è¯­æ³•ï¼š fs.writeFile(file, data[, options], callback)

å‚æ•°è¯´æ˜ï¼š

* file æ–‡ä»¶å

*  data å¾…å†™å…¥çš„æ•°æ®

* options é€‰é¡¹è®¾ç½® ï¼ˆå¯é€‰ï¼‰

* callback å†™å…¥å›è°ƒ

è¿”å›å€¼ï¼š undefined

ä»£ç ç¤ºä¾‹ï¼š

```javascript
// require æ˜¯ Node.js ç¯å¢ƒä¸­çš„'å…¨å±€'å˜é‡ï¼Œç”¨æ¥å¯¼å…¥æ¨¡å—
const fs = require('fs');
//å°† ã€ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ã€‚ã€ å†™å…¥åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ã€åº§å³é“­.txtã€æ–‡ä»¶ä¸­
fs.writeFile('./åº§å³é“­.txt', 'ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ã€‚', err => {
//å¦‚æœå†™å…¥å¤±è´¥ï¼Œåˆ™å›è°ƒå‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šä¼ å…¥é”™è¯¯å¯¹è±¡ï¼Œå¦‚å†™å…¥æˆåŠŸï¼Œä¼šä¼ å…¥ null
if(err){
console.log(err);
return;
}
console.log('å†™å…¥æˆåŠŸ')ï¼›
});
```

#### 2. writeFileSync åŒæ­¥å†™å…¥

è¯­æ³•: fs.writeFileSync(file, data[, options])

å‚æ•°ä¸ fs.writeFile å¤§ä½“ä¸€è‡´ï¼Œåªæ˜¯æ²¡æœ‰ callback å‚æ•°

è¿”å›å€¼ï¼š undefined

ä»£ç ç¤ºä¾‹ï¼š

```javascript
try{
fs.writeFileSync('./åº§å³é“­.txt', 'ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ã€‚');
}catch(e){
console.log(e);
}
```

> Node.js ä¸­çš„ç£ç›˜æ“ä½œæ˜¯ç”±å…¶ä»– çº¿ç¨‹ å®Œæˆçš„ï¼Œç»“æœçš„å¤„ç†æœ‰ä¸¤ç§æ¨¡å¼ï¼š
>
> * åŒæ­¥å¤„ç† JavaScript ä¸»çº¿ç¨‹ ä¼šç­‰å¾… å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹çš„ä»£ç ï¼Œ
>   æ•ˆç‡è¾ƒä½
>
> * å¼‚æ­¥å¤„ç† JavaScript ä¸»çº¿ç¨‹ ä¸ä¼šç­‰å¾… å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œç›´æ¥æ‰§è¡Œåç»­çš„ä¸»çº¿ç¨‹ä»£ç ï¼Œ
>   æ•ˆç‡è¾ƒå¥½

#### 3. appendFile / appendFileSync è¿½åŠ å†™å…¥

appendFile ä½œç”¨æ˜¯åœ¨æ–‡ä»¶å°¾éƒ¨è¿½åŠ å†…å®¹ï¼ŒappendFile è¯­æ³•ä¸ writeFile è¯­æ³•å®Œå…¨ç›¸åŒ
è¯­æ³•:

fs.appendFile(file, data[, options], callback)

fs.appendFileSync(file, data[, options])

è¿”å›å€¼ï¼š äºŒè€…éƒ½ä¸º undefined

å®ä¾‹ä»£ç ï¼š

```javascript
fs.appendFile('./åº§å³é“­.txt','æ‹©å…¶å–„è€…è€Œä»ä¹‹ï¼Œå…¶ä¸å–„è€…è€Œæ”¹ä¹‹ã€‚', err => {
if(err) throw err;
console.log('è¿½åŠ æˆåŠŸ')
});
fs.appendFileSync('./åº§å³é“­.txt','\r\næ¸©æ•…è€ŒçŸ¥æ–°, å¯ä»¥ä¸ºå¸ˆçŸ£');
```

#### 4. createWriteStream æµå¼å†™å…¥

è¯­æ³•ï¼š fs.createWriteStream(path[, options])

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶è·¯å¾„

* (options é€‰é¡¹é…ç½®ï¼ˆ å¯é€‰ ï¼‰

è¿”å›å€¼ï¼š Object

ä»£ç ç¤ºä¾‹ï¼š

```javascript
let ws = fs.createWriteStream('./è§‚ä¹¦æœ‰æ„Ÿ.txt');
ws.write('åŠäº©æ–¹å¡˜ä¸€é‰´å¼€\r\n');
ws.write('å¤©å…‰äº‘å½±å…±å¾˜å¾Š\r\n');
ws.write('é—®æ¸ é‚£å¾—æ¸…å¦‚è®¸\r\n');
ws.write('ä¸ºæœ‰æºå¤´æ´»æ°´æ¥\r\n');
ws.end();
```

> ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ˜¯éœ€è¦æ¶ˆè€—èµ„æºçš„ ï¼Œæµå¼å†™å…¥å¯ä»¥å‡å°‘æ‰“å¼€å…³é—­æ–‡ä»¶çš„æ¬¡æ•°ã€‚
> æµå¼å†™å…¥æ–¹å¼é€‚ç”¨äº å¤§æ–‡ä»¶å†™å…¥æˆ–è€…é¢‘ç¹å†™å…¥ çš„åœºæ™¯, writeFile é€‚åˆäº å†™å…¥é¢‘ç‡è¾ƒä½çš„åœºæ™¯

#### 5. å†™å…¥æ–‡ä»¶çš„åœºæ™¯

æ–‡ä»¶å†™å…¥ åœ¨è®¡ç®—æœºä¸­æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„æ“ä½œï¼Œä¸‹é¢çš„åœºæ™¯éƒ½ç”¨åˆ°äº†æ–‡ä»¶å†™å…¥

* ä¸‹è½½æ–‡ä»¶

* å®‰è£…è½¯ä»¶

* ä¿å­˜ç¨‹åºæ—¥å¿—ï¼Œå¦‚ Git

* ç¼–è¾‘å™¨ä¿å­˜æ–‡ä»¶

* è§†é¢‘å½•åˆ¶

> å½“éœ€è¦æŒä¹…åŒ–ä¿å­˜æ•°æ®çš„æ—¶å€™ï¼Œåº”è¯¥æƒ³åˆ°æ–‡ä»¶å†™å…¥

### 3.2 æ–‡ä»¶è¯»å–

æ–‡ä»¶è¯»å–é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡ç¨‹åºä»æ–‡ä»¶ä¸­å–å‡ºå…¶ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š

| æ–¹æ³•             | è¯´æ˜     |
| ---------------- | -------- |
| readFile         | å¼‚æ­¥è¯»å– |
| readFileSync     | åŒæ­¥è¯»å– |
| createReadStream | æµå¼è¯»å– |

#### 1. readFile å¼‚æ­¥è¯»å–

è¯­æ³•ï¼š fs.readFile(path[, options], callback)

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶è·¯å¾„

* options é€‰é¡¹é…ç½®

* callback å›è°ƒå‡½æ•°

è¿”å›å€¼ï¼š undefined

ä»£ç ç¤ºä¾‹ï¼š

```javascript
//å¯¼å…¥ fs æ¨¡å—
const fs = require('fs');
fs.readFile('./åº§å³é“­.txt', (err, data) => {
if(err) throw err;
console.log(data);
});
fs.readFile('./åº§å³é“­.txt', 'utf-8',(err, data) => {
if(err) throw err;
console.log(data);
});
```

#### 2. readFileSync åŒæ­¥è¯»å–

è¯­æ³•ï¼š fs.readFileSync(path[, options])


å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶è·¯å¾„

* options é€‰é¡¹é…ç½®

è¿”å›å€¼ï¼š string | Buffer

ä»£ç ç¤ºä¾‹ï¼š

```javascript
let data = fs.readFileSync('./åº§å³é“­.txt');
let data2 = fs.readFileSync('./åº§å³é“­.txt', 'utf-8');
```

#### 3. createReadStream æµå¼è¯»å–

è¯­æ³•ï¼š fs.createReadStream(path[, options])

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶è·¯å¾„

* options é€‰é¡¹é…ç½®ï¼ˆ å¯é€‰ ï¼‰

è¿”å›å€¼ï¼š Object

ä»£ç ç¤ºä¾‹ï¼š

```javascript
//åˆ›å»ºè¯»å–æµå¯¹è±¡
let rs = fs.createReadStream('./è§‚ä¹¦æœ‰æ„Ÿ.txt');
//æ¯æ¬¡å–å‡º 64k æ•°æ®åæ‰§è¡Œä¸€æ¬¡ data å›è°ƒ
rs.on('data', data => {
console.log(data);
console.log(data.length);
});
//è¯»å–å®Œæ¯•å, æ‰§è¡Œ end å›è°ƒ
rs.on('end', () => {
console.log('è¯»å–å®Œæˆ')
})
```

#### 4. è¯»å–æ–‡ä»¶åº”ç”¨åœºæ™¯

* ç”µè„‘å¼€æœº

* ç¨‹åºè¿è¡Œ

* ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶

* æŸ¥çœ‹å›¾ç‰‡

* æ’­æ”¾è§†é¢‘

* æ’­æ”¾éŸ³ä¹

* Git æŸ¥çœ‹æ—¥å¿—

* ä¸Šä¼ æ–‡ä»¶

* æŸ¥çœ‹èŠå¤©è®°å½•

### 3.3 æ–‡ä»¶ç§»åŠ¨ä¸é‡å‘½å

åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rename æˆ– renameSync æ¥ç§»åŠ¨æˆ–é‡å‘½å æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹
è¯­æ³•ï¼š

fs.rename(oldPath, newPath, callback)

fs.renameSync(oldPath, newPath)

å‚æ•°è¯´æ˜ï¼š

* oldPath æ–‡ä»¶å½“å‰çš„è·¯å¾„

* newPath æ–‡ä»¶æ–°çš„è·¯å¾„

* callback æ“ä½œåçš„å›è°ƒ

ä»£ç ç¤ºä¾‹ï¼š

```javascript
fs.rename('./è§‚ä¹¦æœ‰æ„Ÿ.txt', './è®ºè¯­/è§‚ä¹¦æœ‰æ„Ÿ.txt', (err) =>{
if(err) throw err;
console.log('ç§»åŠ¨å®Œæˆ')
});
fs.renameSync('./åº§å³é“­.txt', './è®ºè¯­/æˆ‘çš„åº§å³é“­.txt');
```

### 3.4 æ–‡ä»¶åˆ é™¤

åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ unlink æˆ– unlinkSync æ¥åˆ é™¤æ–‡ä»¶
è¯­æ³•ï¼š

fs.unlink(path, callback)

fs.unlinkSync(path)

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶è·¯å¾„

* callback æ“ä½œåçš„å›è°ƒ

ä»£ç ç¤ºä¾‹ï¼š

```javascript
const fs = require('fs');
fs.unlink('./test.txt', err => {
if(err) throw err;
console.log('åˆ é™¤æˆåŠŸ');
});
fs.unlinkSync('./test2.txt');
```

### 3.5 æ–‡ä»¶å¤¹æ“ä½œ

å€ŸåŠ© Node.js çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ–‡ä»¶å¤¹è¿›è¡Œ åˆ›å»º ã€ è¯»å– ã€ åˆ é™¤ ç­‰æ“ä½œ

| æ–¹æ³•                  | è¯´æ˜       |
| --------------------- | ---------- |
| mkdir / mkdirSync     | åˆ›å»ºæ–‡ä»¶å¤¹ |
| readdir / readdirSync | è¯»å–æ–‡ä»¶å¤¹ |
| rmdir / rmdirSync     | åˆ é™¤æ–‡ä»¶å¤¹ |

#### 1. mkdir åˆ›å»ºæ–‡ä»¶å¤¹

åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ mkdir æˆ– mkdirSync æ¥åˆ›å»ºæ–‡ä»¶å¤¹
è¯­æ³•ï¼š

fs.mkdir(path[, options], callback)

fs.mkdirSync(path[, options])

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶å¤¹è·¯å¾„

* options é€‰é¡¹é…ç½®ï¼ˆ å¯é€‰ ï¼‰

* callback æ“ä½œåçš„å›è°ƒ

ç¤ºä¾‹ä»£ç ï¼š

```javascript
//å¼‚æ­¥åˆ›å»ºæ–‡ä»¶å¤¹
fs.mkdir('./page', err => {
if(err) throw err;
console.log('åˆ›å»ºæˆåŠŸ');
});
//é€’å½’å¼‚æ­¥åˆ›å»º
fs.mkdir('./1/2/3', {recursive: true}, err => {
if(err) throw err;
console.log('é€’å½’åˆ›å»ºæˆåŠŸ');
});
//é€’å½’åŒæ­¥åˆ›å»ºæ–‡ä»¶å¤¹
fs.mkdirSync('./x/y/z', {recursive: true});
```

#### 2. readdir è¯»å–æ–‡ä»¶å¤¹

åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ readdir æˆ– readdirSync æ¥è¯»å–æ–‡ä»¶å¤¹
è¯­æ³•ï¼š

fs.readdir(path[, options], callback)

fs.readdirSync(path[, options])

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶å¤¹è·¯å¾„

* options é€‰é¡¹é…ç½®ï¼ˆ å¯é€‰ ï¼‰

* callback æ“ä½œåçš„å›è°ƒ

ç¤ºä¾‹ä»£ç ï¼š

```javascript
//å¼‚æ­¥è¯»å–
fs.readdir('./è®ºè¯­', (err, data) => {
if(err) throw err;
console.log(data);
});
//åŒæ­¥è¯»å–
let data = fs.readdirSync('./è®ºè¯­');
console.log(data);
```

#### 3. rmdir åˆ é™¤æ–‡ä»¶å¤¹

åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rmdir æˆ– rmdirSync æ¥åˆ é™¤æ–‡ä»¶å¤¹
è¯­æ³•ï¼š

fs.rmdir(path[, options], callback)

fs.rmdirSync(path[, options])

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶å¤¹è·¯å¾„

* options é€‰é¡¹é…ç½®ï¼ˆ å¯é€‰ ï¼‰

* callback æ“ä½œåçš„å›è°ƒ

ç¤ºä¾‹ä»£ç ï¼š

```javascript
//å¼‚æ­¥åˆ é™¤æ–‡ä»¶å¤¹
fs.rmdir('./page', err => {
if(err) throw err;
console.log('åˆ é™¤æˆåŠŸ');
});
//å¼‚æ­¥é€’å½’åˆ é™¤æ–‡ä»¶å¤¹
fs.rmdir('./1', {recursive: true}, err => {
if(err) {
console.log(err);
}
console.log('é€’å½’åˆ é™¤')
});
//åŒæ­¥é€’å½’åˆ é™¤æ–‡ä»¶å¤¹
fs.rmdirSync('./x', {recursive: true})
```

### 3.6 æŸ¥çœ‹èµ„æºçŠ¶æ€

åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ stat æˆ– statSync æ¥æŸ¥çœ‹èµ„æºçš„è¯¦ç»†ä¿¡æ¯

è¯­æ³•ï¼š

fs.stat(path[, options], callback)

fs.statSync(path[, options])

å‚æ•°è¯´æ˜ï¼š

* path æ–‡ä»¶å¤¹è·¯å¾„

* options é€‰é¡¹é…ç½®ï¼ˆ å¯é€‰ ï¼‰

* callback æ“ä½œåçš„å›è°ƒ

ç¤ºä¾‹ä»£ç ï¼š

```javascript
//å¼‚æ­¥è·å–çŠ¶æ€
fs.stat('./data.txt', (err, data) => {
if(err) throw err;
console.log(data);
});
//åŒæ­¥è·å–çŠ¶æ€
let data = fs.statSync('./data.txt');
```

ç»“æœå€¼å¯¹è±¡ç»“æ„ï¼š

* size æ–‡ä»¶ä½“ç§¯

* birthtime åˆ›å»ºæ—¶é—´

* mtime æœ€åä¿®æ”¹æ—¶é—´

* isFile æ£€æµ‹æ˜¯å¦ä¸ºæ–‡ä»¶

* isDirectory æ£€æµ‹æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹
* ....

### 3.7 ç›¸å¯¹è·¯å¾„é—®é¢˜

fs æ¨¡å—å¯¹èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œè·¯å¾„çš„å†™æ³•æœ‰ä¸¤ç§ï¼š

* ç›¸å¯¹è·¯å¾„

  * ./åº§å³é“­.txt å½“å‰ç›®å½•ä¸‹çš„åº§å³é“­.txt

  * åº§å³é“­.txt ç­‰æ•ˆäºä¸Šé¢çš„å†™æ³•

  * ../åº§å³é“­.txt å½“å‰ç›®å½•çš„ä¸Šä¸€çº§ç›®å½•ä¸­çš„åº§å³é“­.txt

* ç»å¯¹è·¯å¾„

  * D:/Program Files windows ç³»ç»Ÿä¸‹çš„ç»å¯¹è·¯å¾„

  * /usr/bin Linux ç³»ç»Ÿä¸‹çš„ç»å¯¹è·¯å¾„

> ç›¸å¯¹è·¯å¾„ä¸­æ‰€è°“çš„ å½“å‰ç›®å½• ï¼ŒæŒ‡çš„æ˜¯ å‘½ä»¤è¡Œçš„å·¥ä½œç›®å½• ï¼Œè€Œå¹¶éæ˜¯æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•
> æ‰€ä»¥å½“å‘½ä»¤è¡Œçš„å·¥ä½œç›®å½•ä¸æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸ä¸€è‡´æ—¶ï¼Œä¼šå‡ºç°ä¸€äº› BUG

### 3.8 __dirname

__dirname ä¸ require ç±»ä¼¼ï¼Œéƒ½æ˜¯ Node.js ç¯å¢ƒä¸­çš„'å…¨å±€'å˜é‡

__dirname ä¿å­˜ç€ å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„ ï¼Œå¯ä»¥ä½¿ç”¨ __dirname ä¸æ–‡ä»¶åæ‹¼æ¥æˆç»å¯¹è·¯å¾„

ä»£ç ç¤ºä¾‹ï¼š

```javascript
let data = fs.readFileSync(__dirname + '/data.txt');
console.log(data);
```

> ä½¿ç”¨ fs æ¨¡å—çš„æ—¶å€™ï¼Œå°½é‡ä½¿ç”¨ __dirname å°†è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„ï¼Œè¿™æ ·å¯ä»¥é¿å…ç›¸å¯¹è·¯å¾„äº§ç”Ÿçš„
> Bug

### 3.9 ç»ƒä¹ 

1. ç¼–å†™ä¸€ä¸ª JS æ–‡ä»¶ï¼Œå®ç°å¤åˆ¶æ–‡ä»¶çš„åŠŸèƒ½
2. æ–‡ä»¶é‡å‘½å

## å››ã€pathæ¨¡å—

path æ¨¡å—æä¾›äº† æ“ä½œè·¯å¾„ çš„åŠŸèƒ½ï¼Œè¿™æ˜¯å‡ ä¸ªè¾ƒä¸ºå¸¸ç”¨çš„å‡ ä¸ª APIï¼š

| API           | è¯´æ˜                     |
| ------------- | ------------------------ |
| path.resolve  | æ‹¼æ¥è§„èŒƒçš„ç»å¯¹è·¯å¾„å¸¸ç”¨   |
| path.sep      | è·å–æ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ |
| path.parse    | è§£æè·¯å¾„å¹¶è¿”å›å¯¹è±¡       |
| path.basename | è·å–è·¯å¾„çš„åŸºç¡€åç§°       |
| path.dirname  | è·å–è·¯å¾„çš„ç›®å½•å         |
| path.extname  | è·å¾—è·¯å¾„çš„æ‰©å±•å         |

ä»£ç ç¤ºä¾‹ï¼š

```javascript
const path = require('path');
//è·å–è·¯å¾„åˆ†éš”ç¬¦
console.log(path.sep);
//æ‹¼æ¥ç»å¯¹è·¯å¾„
console.log(path.resolve(__dirname, 'test'));
//è§£æè·¯å¾„
let pathname = 'D:/program file/nodejs/node.exe';
console.log(path.parse(pathname));
//è·å–è·¯å¾„åŸºç¡€åç§°
console.log(path.basename(pathname))
//è·å–è·¯å¾„çš„ç›®å½•å
console.log(path.dirname(pathname));
//è·å–è·¯å¾„çš„æ‰©å±•å
console.log(path.extname(pathname));
```

## äº”ã€httpåè®®

### 5.1 æ¦‚å¿µ

HTTPï¼ˆhypertext transport protocolï¼‰åè®®ï¼›ä¸­æ–‡å«è¶…æ–‡æœ¬ä¼ è¾“åè®®
æ˜¯ä¸€ç§åŸºäºTCP/IPçš„åº”ç”¨å±‚é€šä¿¡åè®®

è¿™ä¸ªåè®®è¯¦ç»†è§„å®šäº† æµè§ˆå™¨ å’Œä¸‡ç»´ç½‘ æœåŠ¡å™¨ ä¹‹é—´äº’ç›¸é€šä¿¡çš„è§„åˆ™ã€‚

åè®®ä¸­ä¸»è¦è§„å®šäº†ä¸¤ä¸ªæ–¹é¢çš„å†…å®¹

* å®¢æˆ·ç«¯ï¼šç”¨æ¥å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œå¯ä»¥è¢«ç§°ä¹‹ä¸ºè¯·æ±‚æŠ¥æ–‡
* æœåŠ¡ç«¯ï¼šå‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ï¼Œå¯ä»¥è¢«ç§°ä¹‹ä¸ºå“åº”æŠ¥æ–‡

> æŠ¥æ–‡ï¼šå¯ä»¥ç®€å•ç†è§£ä¸ºå°±æ˜¯ä¸€å †å­—ç¬¦ä¸²

### 5.2 è¯·æ±‚æŠ¥æ–‡çš„ç»„æˆ

* è¯·æ±‚è¡Œ

* è¯·æ±‚å¤´

* ç©ºè¡Œ

* è¯·æ±‚ä½“

### 5.3 httpçš„è¯·æ±‚è¡Œ

* è¯·æ±‚æ–¹æ³•ï¼ˆgetã€postã€putã€deleteç­‰ï¼‰

* è¯·æ±‚ URLï¼ˆç»Ÿä¸€èµ„æºå®šä½å™¨ï¼‰

    ä¾‹å¦‚ï¼š http://www.baidu.com:80/index.html?a=100&b=200#logo

    * httpï¼š åè®®ï¼ˆhttpsã€ftpã€sshç­‰

    * www.baidu.com åŸŸå
    * 80 ç«¯å£å·
    * /index.html è·¯å¾„
    * a=100&b=200 æŸ¥è¯¢å­—ç¬¦ä¸²
    * #logo å“ˆå¸Œï¼ˆé”šç‚¹é“¾æ¥ï¼‰
* HTTPåè®®ç‰ˆæœ¬å·

### 5.4 httpè¯·æ±‚å¤´

æ ¼å¼ï¼šã€å¤´åï¼šå¤´å€¼ã€

å¸¸è§çš„è¯·æ±‚å¤´æœ‰ï¼š

| è¯·æ±‚å¤´                              | è§£é‡Š                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| Host                                | ä¸»æœºå                                                       |
| Connection                          | è¿æ¥çš„è®¾ç½® keep-aliveï¼ˆä¿æŒè¿æ¥ï¼‰ï¼›closeï¼ˆå…³é—­è¿æ¥ï¼‰         |
| Cache-Control                       | ç¼“å­˜æ§åˆ¶ max-age = 0 ï¼ˆæ²¡æœ‰ç¼“å­˜ï¼‰                            |
| Upgrade-<br/>Insecure-<br/>Requests | å°†ç½‘é¡µä¸­çš„httpè¯·æ±‚è½¬åŒ–ä¸ºhttpsè¯·æ±‚ï¼ˆå¾ˆå°‘ç”¨ï¼‰è€ç½‘ç«™å‡çº§        |
| User-Agent                          | ç”¨æˆ·ä»£ç†ï¼Œå®¢æˆ·ç«¯å­—ç¬¦ä¸²æ ‡è¯†ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è¯†æ¥è¯†åˆ«è¿™ä¸ªè¯·æ±‚æ¥è‡ª<br/>å“ªä¸ªå®¢æˆ·ç«¯ ï¼Œä¸€èˆ¬åœ¨PCç«¯å’Œæ‰‹æœºç«¯çš„åŒºåˆ† |
| Accept                              | è®¾ç½®æµè§ˆå™¨æ¥æ”¶çš„æ•°æ®ç±»å‹                                     |
| Accept-Encoding                     | è®¾ç½®æ¥æ”¶çš„å‹ç¼©æ–¹å¼                                           |
| Accept-<br/>Language                | è®¾ç½®æ¥æ”¶çš„è¯­è¨€ q=0.7 ä¸ºå–œå¥½ç³»æ•°ï¼Œæ»¡åˆ†ä¸º1                     |
| Cookie                              | åé¢å•ç‹¬è®²                                                   |

### 5.5 httpçš„è¯·æ±‚ä½“

è¯·æ±‚ä½“å†…å®¹çš„æ ¼å¼æ˜¯éå¸¸çµæ´»çš„ï¼Œ

ï¼ˆå¯ä»¥æ˜¯ç©ºï¼‰==> GETè¯·æ±‚ï¼Œ

ï¼ˆä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥æ˜¯JSONï¼‰===> POSTè¯·æ±‚

ä¾‹å¦‚ï¼š

```
å­—ç¬¦ä¸²ï¼škeywords=æ‰‹æœº&price=2000
JSONï¼š{"keywords":"æ‰‹æœº","price":2000}
```

### 5.6 å“åº”æŠ¥æ–‡çš„ç»„æˆ

* ç›¸åº”è¡Œ

    ```
    HTTP/1.1 200 OK
    ```
    
    * HTTP/1.1ï¼šHTTPåè®®ç‰ˆæœ¬å·
    
    * 200ï¼šå“åº”çŠ¶æ€ç  404 Not Found 500 Internal Server Error
    
    * è¿˜æœ‰ä¸€äº›çŠ¶æ€ç ï¼Œå‚è€ƒï¼š https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status
    
    * OKï¼šå“åº”çŠ¶æ€æè¿°

* å“åº”å¤´

  ```
  Cache-Control:ç¼“å­˜æ§åˆ¶ private ç§æœ‰çš„ï¼Œåªå…è®¸å®¢æˆ·ç«¯ç¼“å­˜æ•°æ®
  Connection é“¾æ¥è®¾ç½®
  Content-Type:text/html;charset=utf-8 è®¾ç½®å“åº”ä½“çš„æ•°æ®ç±»å‹ä»¥åŠå­—ç¬¦é›†,å“åº”ä½“ä¸ºhtmlï¼Œå­—ç¬¦é›†
  utf-8
  Content-Length:å“åº”ä½“çš„é•¿åº¦ï¼Œå•ä½ä¸ºå­—èŠ‚
  ```

* ç©ºè¡Œ

* å“åº”ä½“
    å“åº”ä½“å†…å®¹çš„ç±»å‹æ˜¯éå¸¸çµæ´»çš„ï¼Œå¸¸è§çš„ç±»å‹æœ‰ HTMLã€CSSã€JSã€å›¾ç‰‡ã€JSON

### 5.7 åˆ›å»ºhttpæœåŠ¡

ä½¿ç”¨ nodejs åˆ›å»º HTTP æœåŠ¡

#### 1. æ“ä½œæ­¥éª¤

```javascript
//1. å¯¼å…¥ http æ¨¡å—
const http = require('http');

//2. åˆ›å»ºæœåŠ¡å¯¹è±¡ create åˆ›å»º server æœåŠ¡
// request æ„ä¸ºè¯·æ±‚. æ˜¯å¯¹è¯·æ±‚æŠ¥æ–‡çš„å°è£…å¯¹è±¡, é€šè¿‡ request å¯¹è±¡å¯ä»¥è·å¾—è¯·æ±‚æŠ¥æ–‡çš„æ•°æ®
// response æ„ä¸ºå“åº”. æ˜¯å¯¹å“åº”æŠ¥æ–‡çš„å°è£…å¯¹è±¡, é€šè¿‡ response å¯¹è±¡å¯ä»¥è®¾ç½®å“åº”æŠ¥æ–‡
const server = http.createServer((request, response) => {
response.end('Hello HTTP server');
});

//3. ç›‘å¬ç«¯å£, å¯åŠ¨æœåŠ¡
server.listen(9000, () => {
console.log('æœåŠ¡å·²ç»å¯åŠ¨, ç«¯å£ 9000 ç›‘å¬ä¸­...');
});
```

> http.createServer é‡Œçš„å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼š å½“æ¥æ”¶åˆ° HTTP è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œ

#### 2. æµ‹è¯•

æµè§ˆå™¨è¯·æ±‚å¯¹åº”ç«¯å£

```
http://127.0.0.1:9000
```

#### 3. æ³¨æ„äº‹é¡¹

1. å‘½ä»¤è¡Œ ctrl + c åœæ­¢æœåŠ¡

2. å½“æœåŠ¡å¯åŠ¨åï¼Œæ›´æ–°ä»£ç  å¿…é¡»é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ

3. å“åº”å†…å®¹ä¸­æ–‡ä¹±ç çš„è§£å†³åŠæ³•

   ```javascript
   response.setHeader('content-type','text/html;charset=utf-8');
   ```

4. ç«¯å£å·è¢«å ç”¨

  ```javascript
  Error: listen EADDRINUSE: address already in use :::9000
  ```

  1ï¼‰å…³é—­å½“å‰æ­£åœ¨è¿è¡Œç›‘å¬ç«¯å£çš„æœåŠ¡ ï¼ˆ ä½¿ç”¨è¾ƒå¤š ï¼‰
  2ï¼‰ä¿®æ”¹å…¶ä»–ç«¯å£å·

5. HTTP åè®®é»˜è®¤ç«¯å£æ˜¯ 80 ã€‚HTTPS åè®®çš„é»˜è®¤ç«¯å£æ˜¯ 443, HTTP æœåŠ¡å¼€å‘å¸¸ç”¨ç«¯å£æœ‰ 3000ï¼Œ8080ï¼Œ8090ï¼Œ9000 ç­‰

> å¦‚æœç«¯å£è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ èµ„æºç›‘è§†å™¨ æ‰¾åˆ°å ç”¨ç«¯å£çš„ç¨‹åºï¼Œç„¶åä½¿ç”¨ ä»»åŠ¡ç®¡ç†å™¨å…³é—­å¯¹åº”çš„ç¨‹åº

### 5.8 æµè§ˆå™¨æŸ¥çœ‹ HTTP æŠ¥æ–‡

ç‚¹å‡»æ­¥éª¤

![](./images/6.png)

#### 1. æŸ¥çœ‹è¯·æ±‚è¡Œä¸è¯·æ±‚å¤´

![](./images/7.png)

#### 2. æŸ¥çœ‹è¯·æ±‚ä½“

![](./images/8.png)

#### 3. æŸ¥çœ‹ URL æŸ¥è¯¢å­—ç¬¦ä¸²

![](./images/9.png)

#### 4. æŸ¥çœ‹å“åº”è¡Œä¸å“åº”å¤´

![](./images/10.png)

#### 5. æŸ¥çœ‹å“åº”ä½“

![](./images/11.png)

### 5.9 è·å– HTTP è¯·æ±‚æŠ¥æ–‡

æƒ³è¦è·å–è¯·æ±‚çš„æ•°æ®ï¼Œéœ€è¦é€šè¿‡ request å¯¹è±¡

| å«ä¹‰           | è¯­æ³•                                                         | é‡ç‚¹æŒæ¡ |
| -------------- | ------------------------------------------------------------ | -------- |
| è¯·æ±‚æ–¹æ³•       | request.method                                               | *        |
| è¯·æ±‚ç‰ˆæœ¬       | request.httpVersion                                          |          |
| è¯·æ±‚è·¯å¾„       | request.url                                                  | *        |
| URL è·¯å¾„       | require('url').parse(request.url).pathname                   | *        |
| URL æŸ¥è¯¢å­—ç¬¦ä¸² | require('url').parse(request.url, true).query                | *        |
| è¯·æ±‚å¤´         | request.headers                                              | *        |
| è¯·æ±‚ä½“         | request.on('data', function(chunk){})<br/>request.on('end', function(){}); |          |

æ³¨æ„äº‹é¡¹ï¼š
1. request.url åªèƒ½è·å–è·¯å¾„ä»¥åŠæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæ— æ³•è·å– URL ä¸­çš„åŸŸåä»¥åŠåè®®çš„å†…å®¹
2. request.headers å°†è¯·æ±‚ä¿¡æ¯è½¬åŒ–æˆä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å±æ€§åéƒ½è½¬åŒ–æˆäº†ã€å°å†™ã€
3. å…³äºè·¯å¾„ï¼šå¦‚æœè®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œåªå¡«å†™äº† IP åœ°å€æˆ–è€…æ˜¯åŸŸåä¿¡æ¯ï¼Œæ­¤æ—¶è¯·æ±‚çš„è·¯å¾„ä¸ºã€ / ã€
4. å…³äº favicon.icoï¼šè¿™ä¸ªè¯·æ±‚æ˜¯å±äºæµè§ˆå™¨è‡ªåŠ¨å‘é€çš„è¯·æ±‚

#### 1. ç»ƒä¹ 

æŒ‰ç…§ä»¥ä¸‹è¦æ±‚æ­å»º HTTP æœåŠ¡

| è¯·æ±‚ç±»å‹(æ–¹æ³•) | è¯·æ±‚åœ°å€ | å“åº”ä½“ç»“æœ |
| -------------- | -------- | ---------- |
| get            | /login   | ç™»å½•é¡µé¢   |
| get            | /reg     | æ³¨å†Œé¡µé¢   |

```javascript
//1ã€å¼•å…¥httpæ¨¡å—
const http = require("http");

//2ã€å»ºç«‹æœåŠ¡
const server = http.createServer((request,response)=>{
let {url,method} = request; //å¯¹è±¡çš„è§£æ„èµ‹å€¼
//è®¾ç½®å“åº”å¤´ä¿¡æ¯
//è§£å†³ä¸­æ–‡ä¹±ç 
response.setHeader("Content-Type","text/html;charset=utf-8")
if(url == "/register" && method == "GET"){
response.end("æ³¨å†Œé¡µé¢");
}else if(url=="/login" && method == "GET"){
response.end("ç™»å½•é¡µé¢");
}else{
response.end("<h1>404 Not Found</h1>")
}
})

//3ã€ç›‘å¬ç«¯å£
server.listen(8000,()=>{
console.log('æœåŠ¡å¯åŠ¨ä¸­....');
})
```

### 5.10 è®¾ç½® HTTP å“åº”æŠ¥æ–‡

| ä½œç”¨             | è¯­æ³•                                         |
| ---------------- | -------------------------------------------- |
| è®¾ç½®å“åº”çŠ¶æ€ç    | response.statusCode                          |
| è®¾ç½®å“åº”çŠ¶æ€æè¿° | response.statusMessage ï¼ˆ ç”¨çš„éå¸¸å°‘ ï¼‰      |
| è®¾ç½®å“åº”å¤´ä¿¡æ¯   | response.setHeader('å¤´å', 'å¤´å€¼')           |
| è®¾ç½®å“åº”ä½“       | response.write('xx')<br/>response.end('xxx') |

```javascript
//write å’Œ end çš„ä¸¤ç§ä½¿ç”¨æƒ…å†µï¼š
//1. write å’Œ end çš„ç»“åˆä½¿ç”¨ å“åº”ä½“ç›¸å¯¹åˆ†æ•£
response.write('xx');
response.write('xx');
response.write('xx');
response.end(); //æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨å¤„ç†çš„æ—¶å€™å¿…é¡»è¦æ‰§è¡Œ end æ–¹æ³•çš„

//2. å•ç‹¬ä½¿ç”¨ end æ–¹æ³• å“åº”ä½“ç›¸å¯¹é›†ä¸­
response.end('xxx');
```

#### 1. ç»ƒä¹ 

æ­å»º HTTP æœåŠ¡ï¼Œå“åº”ä¸€ä¸ª 4 è¡Œ 3 åˆ—çš„è¡¨æ ¼ï¼Œå¹¶ä¸”è¦æ±‚è¡¨æ ¼æœ‰ éš”è¡Œæ¢è‰²æ•ˆæœ ï¼Œä¸” ç‚¹å‡» å•å…ƒæ ¼èƒ½ é«˜äº®æ˜¾ç¤º

```javascript
//1.å¯¼å…¥httpæ¨¡å—
const http = require('http')

//2.åˆ›å»ºæœåŠ¡å¯¹è±¡
const server = http.createServer((request, response) => {
    response.end(`
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        td{
            padding: 20px 40px;
        }
        table tr:nth-child(odd){
            background-color: #fcb;
        }
        table tr:nth-child(even){
            background-color: #fdf;
        }
        table,td{
            border-collapse: collapse;
        }
    </style>
    </head>
    <body>
        <table border="1">
            <tr>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
        <script>
            //è·å–æ‰€æœ‰çš„td
            const tds = document.querySelectorAll('td');
            //éå†td
            tds.forEach(item => {
                item.onclick = function() {
                    this.style.background = '#222';
                    }
                })
            
        </script>
    
    </body>
    </html>
        `)
})

//3.ç›‘å¬ç«¯å£ï¼Œå¯åŠ¨æœåŠ¡
server.listen(9000, () => {
    console.log("æœåŠ¡å·²ç»å¯åŠ¨");

})
```

### 5.11 ç½‘é¡µèµ„æºçš„åŸºæœ¬åŠ è½½è¿‡ç¨‹

![](./images/12.png)

ç½‘é¡µèµ„æºçš„åŠ è½½éƒ½æ˜¯å¾ªåºæ¸è¿›çš„ï¼Œé¦–å…ˆè·å– HTML çš„å†…å®¹ï¼Œ ç„¶åè§£æ HTML åœ¨å‘é€å…¶ä»–èµ„æºçš„è¯·æ±‚ï¼Œå¦‚CSSï¼ŒJavascriptï¼Œå›¾ç‰‡ç­‰ã€‚ 

ç†è§£äº†è¿™ä¸ªå†…å®¹å¯¹äºåç»­çš„å­¦ä¹ ä¸æˆé•¿æœ‰éå¸¸å¤§çš„å¸®åŠ©

### 5.12 é™æ€èµ„æºæœåŠ¡

é™æ€èµ„æºæ˜¯æŒ‡ å†…å®¹é•¿æ—¶é—´ä¸å‘ç”Ÿæ”¹å˜çš„èµ„æº ï¼Œä¾‹å¦‚å›¾ç‰‡ï¼Œè§†é¢‘ï¼ŒCSS æ–‡ä»¶ï¼ŒJSæ–‡ä»¶ï¼ŒHTMLæ–‡ä»¶ï¼Œå­—ä½“æ–‡ä»¶ç­‰

åŠ¨æ€èµ„æºæ˜¯æŒ‡ å†…å®¹ç»å¸¸æ›´æ–°çš„èµ„æº ï¼Œä¾‹å¦‚ç™¾åº¦é¦–é¡µï¼Œç½‘æ˜“é¦–é¡µï¼Œäº¬ä¸œæœç´¢åˆ—è¡¨é¡µé¢ç­‰

#### 1. ç½‘ç«™æ ¹ç›®å½•æˆ–é™æ€èµ„æºç›®å½•

HTTP æœåŠ¡åœ¨å“ªä¸ªæ–‡ä»¶å¤¹ä¸­å¯»æ‰¾é™æ€èµ„æºï¼Œé‚£ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯ é™æ€èµ„æºç›®å½• ï¼Œä¹Ÿç§°ä¹‹ä¸º ç½‘ç«™æ ¹ç›®å½•

> æ€è€ƒï¼švscode ä¸­ä½¿ç”¨ live-server è®¿é—® HTML æ—¶ï¼Œ å®ƒå¯åŠ¨çš„æœåŠ¡ä¸­ç½‘ç«™æ ¹ç›®å½•æ˜¯è°ï¼Ÿ

#### 2. ç½‘é¡µä¸­çš„ URL

ç½‘é¡µä¸­çš„ URL ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç›¸å¯¹è·¯å¾„ä¸ç»å¯¹è·¯å¾„

##### (1) ç»å¯¹è·¯å¾„

ç»å¯¹è·¯å¾„å¯é æ€§å¼ºï¼Œè€Œä¸”ç›¸å¯¹å®¹æ˜“ç†è§£ï¼Œåœ¨é¡¹ç›®ä¸­è¿ç”¨è¾ƒå¤š

| å½¢å¼                   | ç‰¹ç‚¹                                                         |
| ---------------------- | ------------------------------------------------------------ |
| http://atguigu.com/web | ç›´æ¥å‘ç›®æ ‡èµ„æºå‘é€è¯·æ±‚ï¼Œå®¹æ˜“ç†è§£ã€‚ç½‘ç«™çš„å¤–é“¾ä¼šç”¨åˆ°æ­¤å½¢å¼     |
| //atguigu.com/web      | ä¸é¡µé¢ URL çš„åè®®æ‹¼æ¥å½¢æˆå®Œæ•´ URL å†å‘é€è¯·æ±‚ã€‚å¤§å‹ç½‘ç«™ç”¨çš„æ¯”è¾ƒå¤š |
| /web                   | ä¸é¡µé¢ URL çš„åè®®ã€ä¸»æœºåã€ç«¯å£æ‹¼æ¥å½¢æˆå®Œæ•´ URL å†å‘é€è¯·æ±‚ã€‚ä¸­å°<br/>å‹ç½‘ç«™ |

##### (2) ç›¸å¯¹è·¯å¾„

ç›¸å¯¹è·¯å¾„åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œéœ€è¦ä¸å½“å‰é¡µé¢ URL è·¯å¾„è¿›è¡Œ è®¡ç®— ï¼Œå¾—åˆ°å®Œæ•´ URL åï¼Œå†å‘é€è¯·æ±‚ï¼Œå­¦ä¹ é˜¶æ®µç”¨çš„è¾ƒå¤š

ä¾‹å¦‚å½“å‰ç½‘é¡µ url ä¸º http://www.atguigu.com/course/h5.html

| å½¢å¼               | æœ€ç»ˆçš„ URL                                |
| ------------------ | ----------------------------------------- |
| ./css/app.css      | http://www.atguigu.com/course/css/app.css |
| js/app.js          | http://www.atguigu.com/course/js/app.js   |
| ../img/logo.png    | http://www.atguigu.com/img/logo.png       |
| ../../mp4/show.mp4 | http://www.atguigu.com/mp4/show.mp4       |

##### (3) ç½‘é¡µä¸­ä½¿ç”¨ URL çš„åœºæ™¯å°ç»“

åŒ…æ‹¬ä½†ä¸é™äºå¦‚ä¸‹åœºæ™¯ï¼š

* a æ ‡ç­¾ href
* link æ ‡ç­¾ href
* script æ ‡ç­¾ src
  img æ ‡ç­¾ src
* video audio æ ‡ç­¾ src
* form ä¸­çš„ action
* AJAX è¯·æ±‚ä¸­çš„ URL

#### 3. è®¾ç½®èµ„æºç±»å‹ï¼ˆmimeç±»å‹ï¼‰

åª’ä½“ç±»å‹ï¼ˆé€šå¸¸ç§°ä¸º Multipurpose Internet Mail Extensions æˆ– MIME ç±»å‹ ï¼‰æ˜¯ä¸€ç§æ ‡å‡†ï¼Œç”¨æ¥è¡¨ç¤ºæ–‡æ¡£ã€æ–‡ä»¶æˆ–å­—èŠ‚æµçš„æ€§è´¨å’Œæ ¼å¼ã€‚

```
mime ç±»å‹ç»“æ„ï¼š [type]/[subType]
ä¾‹å¦‚ï¼š text/html text/css image/jpeg image/png application/json
```

HTTP æœåŠ¡å¯ä»¥è®¾ç½®å“åº”å¤´ Content-Type æ¥è¡¨æ˜å“åº”ä½“çš„ MIME ç±»å‹ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®è¯¥ç±»å‹å†³å®šå¦‚ä½•å¤„ç†èµ„æº

ä¸‹é¢æ˜¯å¸¸è§æ–‡ä»¶å¯¹åº”çš„ mime ç±»å‹

```
html: 'text/html',
css: 'text/css',
js: 'text/javascript',
png: 'image/png',
jpg: 'image/jpeg',
gif: 'image/gif',
mp4: 'video/mp4',
mp3: 'audio/mpeg',
json: 'application/json'
```

> å¯¹äºæœªçŸ¥çš„èµ„æºç±»å‹ï¼Œå¯ä»¥é€‰æ‹© application/octet-stream ç±»å‹ï¼Œæµè§ˆå™¨åœ¨é‡åˆ°è¯¥ç±»å‹çš„å“åº”æ—¶ï¼Œä¼šå¯¹å“åº”ä½“å†…å®¹è¿›è¡Œç‹¬ç«‹å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ ä¸‹è½½ æ•ˆæœ

```javascript
require('http').createServer((request, response) => {
    //è·å–è¯·æ±‚çš„æ–¹æ³•å·²ç»è·¯å¾„
    let { url, method } = request;
    //åˆ¤æ–­è¯·æ±‚æ–¹å¼ä»¥åŠè¯·æ±‚è·¯å¾„
    if (method == "GET" && url == "/index.html") {
        //éœ€è¦å“åº”æ–‡ä»¶ä¸­çš„å†…å®¹
        let data = require('fs').readFileSync(__dirname + '/index.html');
        response.end(data);
    } else if (method == "GET" && url == "/css/app.css") {
        //éœ€è¦å“åº”æ–‡ä»¶ä¸­çš„å†…å®¹
        let data = require('fs').readFileSync(__dirname + '/public/css/app.css');
        response.end(data);
    } else if (method == "GET" && url == "/js/app.js") {
        //éœ€è¦å“åº”æ–‡ä»¶ä¸­çš„å†…å®¹
        let data = require('fs').readFileSync(__dirname + '/public/js/app.js');
        response.end(data);
    }
    else {
        //404å“åº”
        response.statusCode = 404;
        response.end("<h1>404 Not Found</h1>");
    }
}).listen(80, () => {
    console.log('80ç«¯å£æ­£åœ¨å¯åŠ¨ä¸­....');
})
```

å¾ˆæ˜æ˜¾ä¸Šé¢çš„ä»£ç ï¼Œå½“åªè¦æœ‰ä¸€ä¸ªè¯·æ±‚è·¯å¾„å°±éœ€è¦è¿›è¡Œåˆ¤æ–­ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼ä¸å¤Ÿå®Œç¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°è£…

```javascript
require('http').createServer((request, response) => {
    //è·å–è¯·æ±‚çš„æ–¹æ³•å·²ç»è·¯å¾„
    let { url, method } = request;
    //æ–‡ä»¶å¤¹è·¯å¾„
    let rootDir = __dirname + '/public';
    //æ‹¼æ¥æ–‡ä»¶è·¯å¾„
    let filePath = rootDir + url;
    //è¯»å–æ–‡ä»¶å†…å®¹
    fs.readFile(filePath, (err, data) => {
        //åˆ¤æ–­
        if (err) {
            //å¦‚æœå‡ºç°é”™è¯¯ï¼Œå“åº”404çŠ¶æ€ç 
            response.statusCode = 404;
            response.end('<h1>404 Not Found</h1>');
        } else {
            //å“åº”æ–‡ä»¶å†…å®¹
            response.end(data);
        }
    })
}).listen(80, () => {
    console.log('80ç«¯å£æ­£åœ¨å¯åŠ¨ä¸­....');
})
```

#### 4. GET å’Œ POST è¯·æ±‚åœºæ™¯å°ç»“

GET è¯·æ±‚çš„æƒ…å†µï¼š

* åœ¨åœ°å€æ ç›´æ¥è¾“å…¥ url è®¿é—®

* ç‚¹å‡» a é“¾æ¥

* link æ ‡ç­¾å¼•å…¥ css

* script æ ‡ç­¾å¼•å…¥ js

* img æ ‡ç­¾å¼•å…¥å›¾ç‰‡

* form æ ‡ç­¾ä¸­çš„ method ä¸º get ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰

* ajax ä¸­çš„ get è¯·æ±‚

POST è¯·æ±‚çš„æƒ…å†µï¼š

* form æ ‡ç­¾ä¸­çš„ method ä¸º postï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
* AJAX çš„ post è¯·æ±‚

### 5.13 GETå’ŒPOSTè¯·æ±‚çš„åŒºåˆ«

GET å’Œ POST æ˜¯ HTTP åè®®è¯·æ±‚çš„ä¸¤ç§æ–¹å¼ã€‚

* GET ä¸»è¦ç”¨æ¥è·å–æ•°æ®ï¼ŒPOST ä¸»è¦ç”¨æ¥æäº¤æ•°æ®

* GET å¸¦å‚æ•°è¯·æ±‚æ˜¯å°†å‚æ•°ç¼€åˆ° URL ä¹‹åï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥ url è®¿é—®ç½‘ç«™å°±æ˜¯ GET è¯·æ±‚ï¼Œ
  POST å¸¦å‚æ•°è¯·æ±‚æ˜¯å°†å‚æ•°æ”¾åˆ°è¯·æ±‚ä½“ä¸­

* POST è¯·æ±‚ç›¸å¯¹ GET å®‰å…¨ä¸€äº›ï¼Œå› ä¸ºåœ¨æµè§ˆå™¨ä¸­å‚æ•°ä¼šæš´éœ²åœ¨åœ°å€æ 

* GET è¯·æ±‚å¤§å°æœ‰é™åˆ¶ï¼Œä¸€èˆ¬ä¸º 2Kï¼Œè€Œ POST è¯·æ±‚åˆ™æ²¡æœ‰å¤§å°é™åˆ¶

## å…­ã€æ¨¡å—åŒ–

### 6.1 ä»‹ç»

#### 1. ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–ä¸æ¨¡å— ?

å°†ä¸€ä¸ªå¤æ‚çš„ç¨‹åºæ–‡ä»¶ä¾æ®ä¸€å®šè§„åˆ™ï¼ˆè§„èŒƒï¼‰æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶çš„è¿‡ç¨‹ç§°ä¹‹ä¸º æ¨¡å—åŒ–

å…¶ä¸­æ‹†åˆ†å‡ºçš„ æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å— ï¼Œæ¨¡å—çš„å†…éƒ¨æ•°æ®æ˜¯ç§æœ‰çš„ï¼Œä¸è¿‡æ¨¡å—å¯ä»¥æš´éœ²å†…éƒ¨æ•°æ®ä»¥ä¾¿å…¶ä»–æ¨¡å—ä½¿ç”¨

#### 2. ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–é¡¹ç›® ?

ç¼–ç æ—¶æ˜¯æŒ‰ç…§æ¨¡å—ä¸€ä¸ªä¸€ä¸ªç¼–ç çš„ï¼Œ æ•´ä¸ªé¡¹ç›®å°±æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„é¡¹ç›®

#### 3. æ¨¡å—åŒ–å¥½å¤„

ä¸‹é¢æ˜¯æ¨¡å—åŒ–çš„ä¸€äº›å¥½å¤„ï¼š

* é˜²æ­¢å‘½åå†²çª

* é«˜å¤ç”¨æ€§
* é«˜ç»´æŠ¤æ€§

### 6.2 æ¨¡å—æš´éœ²æ•°æ®

#### 1. æ¨¡å—åˆä½“éªŒ

å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ“ä½œæ­¥éª¤ï¼Œå¿«é€Ÿä½“éªŒæ¨¡å—åŒ–

* åˆ›å»º me.js

```javascript
//å£°æ˜å‡½æ•°
function tiemo(){
console.log('è´´è†œ....');
}
//æš´éœ²æ•°æ®
module.exports = tiemo;
```

* åˆ›å»º index.js

```javascript
//å¯¼å…¥æ¨¡å—
const tiemo = require('./me.js');
//è°ƒç”¨å‡½æ•°
tiemo();
```

#### 2. æš´éœ²æ•°æ®

æ¨¡å—æš´éœ²æ•°æ®çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š

1. module.exports = value

2. exports.name = value

> ä½¿ç”¨æ—¶æœ‰å‡ ç‚¹æ³¨æ„ï¼š
> * module.exports å¯ä»¥æš´éœ² ä»»æ„ æ•°æ®
> * ä¸èƒ½ä½¿ç”¨ exports = value çš„å½¢å¼æš´éœ²æ•°æ®ï¼Œæ¨¡å—å†…éƒ¨ module ä¸ exports çš„éšå¼å…³ç³»exports = module.exports = {} ï¼Œrequire è¿”å›çš„æ˜¯ç›®æ ‡æ¨¡å—ä¸­ module.exports çš„å€¼

![](./images/13.png)

### 6.3 å¯¼å…¥ï¼ˆå¼•å…¥ï¼‰æ¨¡å—

åœ¨æ¨¡å—ä¸­ä½¿ç”¨ require ä¼ å…¥æ–‡ä»¶è·¯å¾„å³å¯å¼•å…¥æ–‡ä»¶

```javascript
const test = require('./me.js');
```

require ä½¿ç”¨çš„ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š

1. å¯¹äºè‡ªå·±åˆ›å»ºçš„æ¨¡å—ï¼Œå¯¼å…¥æ—¶è·¯å¾„å»ºè®®å†™ ç›¸å¯¹è·¯å¾„ ï¼Œä¸”ä¸èƒ½çœç•¥ ./ å’Œ ../

2. js å’Œ json æ–‡ä»¶å¯¼å…¥æ—¶å¯ä»¥ä¸ç”¨å†™åç¼€ï¼Œc/c++ç¼–å†™çš„ node æ‰©å±•æ–‡ä»¶ä¹Ÿå¯ä»¥ä¸å†™åç¼€ï¼Œä½†æ˜¯ä¸€èˆ¬ç”¨ä¸åˆ°

3. å¦‚æœå¯¼å…¥å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œä¼šä»¥ js æ–‡ä»¶è¿›è¡Œå¤„ç†

4. å¦‚æœå¯¼å…¥çš„è·¯å¾„æ˜¯ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™ä¼š é¦–å…ˆ æ£€æµ‹è¯¥æ–‡ä»¶å¤¹ä¸‹ package.json æ–‡ä»¶ä¸­ main å±æ€§å¯¹åº”çš„æ–‡ä»¶ï¼Œ
å¦‚æœå­˜åœ¨åˆ™å¯¼å…¥ï¼Œåä¹‹å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¼šæŠ¥é”™ã€‚
å¦‚æœ main å±æ€§ä¸å­˜åœ¨ï¼Œæˆ–è€… package.json ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå°è¯•å¯¼å…¥æ–‡ä»¶å¤¹ä¸‹çš„ index.js å’Œindex.json ï¼Œ
å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°±ä¼šæŠ¥é”™

5. å¯¼å…¥ node.js å†…ç½®æ¨¡å—æ—¶ï¼Œç›´æ¥ require æ¨¡å—çš„åå­—å³å¯ï¼Œæ— éœ€åŠ  ./ å’Œ ../

### 6.4 å¯¼å…¥æ¨¡å—çš„åŸºæœ¬æµç¨‹

è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ require å¯¼å…¥ è‡ªå®šä¹‰æ¨¡å— çš„åŸºæœ¬æµç¨‹

1. å°†ç›¸å¯¹è·¯å¾„è½¬ä¸ºç»å¯¹è·¯å¾„ï¼Œå®šä½ç›®æ ‡æ–‡ä»¶

2. ç¼“å­˜æ£€æµ‹

3. è¯»å–ç›®æ ‡æ–‡ä»¶ä»£ç 

4. åŒ…è£¹ä¸ºä¸€ä¸ªå‡½æ•°å¹¶æ‰§è¡Œï¼ˆè‡ªæ‰§è¡Œå‡½æ•°ï¼‰ã€‚é€šè¿‡ arguments.callee.toString() æŸ¥çœ‹è‡ªæ‰§è¡Œå‡½æ•°

5. ç¼“å­˜æ¨¡å—çš„å€¼

6. è¿”å› module.exports çš„å€¼

![](./images/14.png)

### 6.5 CommonJS è§„èŒƒ

module.exports ã€ exports ä»¥åŠ require è¿™äº›éƒ½æ˜¯ CommonJS æ¨¡å—åŒ–è§„èŒƒä¸­çš„å†…å®¹ã€‚

è€Œ Node.js æ˜¯å®ç°äº† CommonJS æ¨¡å—åŒ–è§„èŒƒï¼ŒäºŒè€…å…³ç³»æœ‰ç‚¹åƒ JavaScript ä¸ ECMAScript

## ä¸ƒã€åŒ…ç®¡ç†å·¥å…·

### 7.1æ¦‚å¿µä»‹ç»

#### 1. åŒ…æ˜¯ä»€ä¹ˆ

è‹±æ–‡å•è¯æ˜¯ package ï¼Œä»£è¡¨äº†ä¸€ç»„ç‰¹å®šåŠŸèƒ½çš„æºç é›†åˆ

#### 2. åŒ…ç®¡ç†å·¥å…·

ç®¡ç†ã€åŒ…ã€çš„åº”ç”¨è½¯ä»¶ï¼Œå¯ä»¥å¯¹ã€ŒåŒ…ã€è¿›è¡Œä¸‹è½½å®‰è£…ï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼Œä¸Šä¼ ç­‰æ“ä½œ

å€ŸåŠ©åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘é¡¹ç›®ï¼Œæå‡å¼€å‘æ•ˆç‡

åŒ…ç®¡ç†å·¥å…·æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¦‚å¿µï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æœ‰åŒ…ç®¡ç†å·¥å…·ï¼Œæ‰€ä»¥æŒæ¡å¥½åŒ…ç®¡ç†å·¥å…·éå¸¸é‡è¦

#### 3. å¸¸ç”¨çš„åŒ…ç®¡ç†å·¥å…·

ä¸‹é¢åˆ—ä¸¾äº†å‰ç«¯å¸¸ç”¨çš„åŒ…ç®¡ç†å·¥å…·

* npm

* yarn

* cnpm

### 7.2 npm

npm å…¨ç§° Node Package Manager ï¼Œç¿»è¯‘ä¸ºä¸­æ–‡æ„æ€æ˜¯ã€Node çš„åŒ…ç®¡ç†å·¥å…·ã€

npm æ˜¯ node.js å®˜æ–¹å†…ç½®çš„åŒ…ç®¡ç†å·¥å…·ï¼Œæ˜¯ å¿…é¡»è¦æŒæ¡ä½çš„å·¥å…·

#### 1. npmçš„å®‰è£…

node.js åœ¨å®‰è£…æ—¶ä¼š è‡ªåŠ¨å®‰è£… npm ï¼Œæ‰€ä»¥å¦‚æœä½ å·²ç»å®‰è£…äº† node.jsï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ npm

å¯ä»¥é€šè¿‡ npm -v æŸ¥çœ‹ç‰ˆæœ¬å·æµ‹è¯•ï¼Œå¦‚æœæ˜¾ç¤ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…æˆåŠŸï¼Œåä¹‹å®‰è£…å¤±è´¥

![](./images/15.png)

> æŸ¥çœ‹ç‰ˆæœ¬æ—¶å¯èƒ½ä¸ä¸Šå›¾ç‰ˆæœ¬å·ä¸ä¸€æ ·ï¼Œä¸è¿‡ä¸å½±å“æ­£å¸¸ä½¿ç”¨

#### 2. npm åŸºæœ¬ä½¿ç”¨

##### (1) åˆå§‹åŒ–

åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œç„¶åä»¥æ­¤ç›®å½•ä½œä¸ºå·¥ä½œç›®å½• å¯åŠ¨å‘½ä»¤è¡Œå·¥å…· ï¼Œæ‰§è¡Œ npm init

![](./images/16.png)

npm init å‘½ä»¤çš„ä½œç”¨æ˜¯å°†æ–‡ä»¶å¤¹åˆå§‹åŒ–ä¸ºä¸€ä¸ªã€åŒ…ã€ï¼Œ äº¤äº’å¼åˆ›å»º package.json æ–‡ä»¶

package.json æ˜¯åŒ…çš„é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªåŒ…éƒ½å¿…é¡»è¦æœ‰ package.json

package.json å†…å®¹ç¤ºä¾‹ï¼š

```json
{
    "name": "01_npm",
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1"
    },
    "author": "",
    "license": "ISC"
}
```

> åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š
> 
> 1. package name ( åŒ…å ) ä¸èƒ½ä½¿ç”¨ä¸­æ–‡ã€å¤§å†™ï¼Œé»˜è®¤å€¼æ˜¯ æ–‡ä»¶å¤¹çš„åç§° ï¼Œæ‰€ä»¥æ–‡ä»¶å¤¹åç§°ä¹Ÿä¸èƒ½ä½¿ç”¨ä¸­æ–‡å’Œå¤§å†™
> 
> 2. version ( ç‰ˆæœ¬å· )è¦æ±‚ x.x.x çš„å½¢å¼å®šä¹‰ï¼Œ x å¿…é¡»æ˜¯æ•°å­—ï¼Œé»˜è®¤å€¼æ˜¯ 1.0.0
> 
> 3. ISC è¯ä¹¦ä¸ MIT è¯ä¹¦åŠŸèƒ½ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå…³äºå¼€æºè¯ä¹¦æ‰©å±•é˜…è¯» http://www.ruanyifeng.com/blog/2011/05/how_to_choose_free_software_licenses.html
>
> 4. package.json å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸ä¿®æ”¹
>
> 5. ä½¿ç”¨ npm init -y æˆ–è€… npm init --yes æé€Ÿåˆ›å»º package.json

##### (2) æœç´¢åŒ…

æœç´¢åŒ…çš„æ–¹å¼æœ‰ä¸¤ç§

1. å‘½ä»¤è¡Œ ã€npm s/search å…³é”®å­—ã€

2. ç½‘ç«™æœç´¢ ç½‘å€æ˜¯ https://www.npmjs.com/

> ç»å¸¸æœ‰åŒå­¦é—®ï¼Œã€æˆ‘æ€æ ·æ‰èƒ½ç²¾å‡†æ‰¾åˆ°æˆ‘éœ€è¦çš„åŒ…ï¼Ÿã€
>
> è¿™ä¸ªäº‹å„¿éœ€è¦å¤§å®¶åœ¨å®è·µä¸­ä¸æ–­çš„ç§¯ç´¯ï¼Œé€šè¿‡çœ‹æ–‡ç« ï¼Œçœ‹é¡¹ç›®å»å­¦ä¹ å»ç§¯ç´¯

##### (3) ä¸‹è½½å®‰è£…åŒ…

æˆ‘ä»¬å¯ä»¥é€šè¿‡ npm install å’Œ npm i å‘½ä»¤å®‰è£…åŒ…

```shell
# æ ¼å¼
npm install <åŒ…å>
npm i <åŒ…å>
# ç¤ºä¾‹
npm install uniq
npm i uniq
```

è¿è¡Œä¹‹åæ–‡ä»¶å¤¹ä¸‹ä¼šå¢åŠ ä¸¤ä¸ªèµ„æº

* node_modules æ–‡ä»¶å¤¹ å­˜æ”¾ä¸‹è½½çš„åŒ…
* package-lock.json åŒ…çš„é”æ–‡ä»¶ ï¼Œç”¨æ¥é”å®šåŒ…çš„ç‰ˆæœ¬

> å®‰è£… uniq ä¹‹åï¼Œuniq å°±æ˜¯å½“å‰è¿™ä¸ªåŒ…çš„ä¸€ä¸ªä¾èµ–åŒ… ï¼Œæœ‰æ—¶ä¼šç®€ç§°ä¸ºä¾èµ–
> 
> æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…åå­—ä¸º Aï¼ŒA ä¸­å®‰è£…äº†åŒ…åå­—æ˜¯ Bï¼Œæˆ‘ä»¬å°±è¯´ B æ˜¯ A çš„ä¸€ä¸ªä¾èµ–åŒ… ï¼Œä¹Ÿä¼šè¯´A ä¾èµ– B

##### (4) require å¯¼å…¥ npm åŒ…åŸºæœ¬æµç¨‹

1. åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ node_modules ä¸­å¯»æ‰¾åŒåçš„æ–‡ä»¶å¤¹

2. åœ¨ä¸Šçº§ç›®å½•ä¸­ä¸‹çš„ node_modules ä¸­å¯»æ‰¾åŒåçš„æ–‡ä»¶å¤¹ï¼Œç›´è‡³æ‰¾åˆ°ç£ç›˜æ ¹ç›®å½•

#### 3. ç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒ

å¼€å‘ç¯å¢ƒæ˜¯ç¨‹åºå‘˜ä¸“é—¨ç”¨æ¥å†™ä»£ç çš„ç¯å¢ƒï¼Œä¸€èˆ¬æ˜¯æŒ‡ç¨‹åºå‘˜çš„ç”µè„‘ï¼Œå¼€å‘ç¯å¢ƒçš„é¡¹ç›®ä¸€èˆ¬åªèƒ½ç¨‹åºå‘˜è‡ªå·±è®¿é—®

ç”Ÿäº§ç¯å¢ƒæ˜¯é¡¹ç›®ä»£ç æ­£å¼è¿è¡Œçš„ç¯å¢ƒï¼Œä¸€èˆ¬æ˜¯æŒ‡æ­£å¼çš„æœåŠ¡å™¨ç”µè„‘ï¼Œç”Ÿäº§ç¯å¢ƒçš„é¡¹ç›®ä¸€èˆ¬æ¯ä¸ªå®¢æˆ·éƒ½å¯ä»¥è®¿é—®

#### 4. ç”Ÿäº§ä¾èµ–ä¸å¼€å‘ä¾èµ–

æˆ‘ä»¬å¯ä»¥åœ¨å®‰è£…æ—¶è®¾ç½®é€‰é¡¹æ¥åŒºåˆ† ä¾èµ–çš„ç±»å‹ ï¼Œç›®å‰åˆ†ä¸ºä¸¤ç±»ï¼š

| ç±»å‹     | å‘½ä»¤                                    | è¡¥å……                                                         |
| -------- | --------------------------------------- | ------------------------------------------------------------ |
| ç”Ÿäº§ä¾èµ– | npm i -S uniq<br/>npm i --save uniq     | -S ç­‰æ•ˆäº --saveï¼Œ -S æ˜¯é»˜è®¤é€‰é¡¹<br/>åŒ…ä¿¡æ¯ä¿å­˜åœ¨ package.json ä¸­ dependencies å±æ€§ |
| å¼€å‘ä¾èµ– | npm i -D less<br/>npm i --save-dev less | -D ç­‰æ•ˆäº --save-dev<br/>åŒ…ä¿¡æ¯ä¿å­˜åœ¨ package.json ä¸­ devDependencies å±æ€§ |

> ä¸¾ä¸ªä¾‹å­æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæ¯”å¦‚è¯´åšè›‹ç‚’é¥­éœ€è¦å¤§ç±³ï¼Œæ²¹ï¼Œè‘±ï¼Œé¸¡è›‹ï¼Œé”…ï¼Œç…¤æ°”ï¼Œé“²å­ç­‰
> 
> å…¶ä¸­é”…ï¼Œç…¤æ°”ï¼Œé“²å­å±äºå¼€å‘ä¾èµ–ï¼Œåªåœ¨åˆ¶ä½œé˜¶æ®µä½¿ç”¨
> 
> è€Œå¤§ç±³ï¼Œæ²¹ï¼Œè‘±ï¼Œé¸¡è›‹å±äºç”Ÿäº§ä¾èµ–ï¼Œåœ¨åˆ¶ä½œä¸æœ€ç»ˆé£Ÿç”¨éƒ½ä¼šç”¨åˆ°
> 
> æ‰€ä»¥å¼€å‘ä¾èµ–æ˜¯åªåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨çš„ä¾èµ–åŒ…ï¼Œè€Œç”Ÿäº§ä¾èµ–æ˜¯å¼€å‘é˜¶æ®µå’Œæœ€ç»ˆä¸Šçº¿è¿è¡Œé˜¶æ®µéƒ½ç”¨åˆ°çš„ä¾èµ–åŒ…

#### 5. å…¨å±€å®‰è£…

æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå®‰è£…é€‰é¡¹ -g è¿›è¡Œå…¨å±€å®‰è£…

```shell
npm i -g nodemon
```

å…¨å±€å®‰è£…å®Œæˆä¹‹åå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œçš„ä»»ä½•ä½ç½®è¿è¡Œ nodemon å‘½ä»¤

è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ è‡ªåŠ¨é‡å¯ node åº”ç”¨ç¨‹åº

> è¯´æ˜ï¼š
>
> - å…¨å±€å®‰è£…çš„å‘½ä»¤ä¸å—å·¥ä½œç›®å½•ä½ç½®å½±å“
> 
> - å¯ä»¥é€šè¿‡ npm root -g å¯ä»¥æŸ¥çœ‹å…¨å±€å®‰è£…åŒ…çš„ä½ç½®
> 
> - ä¸æ˜¯æ‰€æœ‰çš„åŒ…éƒ½é€‚åˆå…¨å±€å®‰è£… ï¼Œ åªæœ‰å…¨å±€ç±»çš„å·¥å…·æ‰é€‚åˆï¼Œå¯ä»¥é€šè¿‡ æŸ¥çœ‹åŒ…çš„å®˜æ–¹æ–‡æ¡£æ¥ç¡®å®šå®‰è£…æ–¹å¼ ï¼Œè¿™é‡Œå…ˆä¸å¿…å¤ªçº ç»“

##### (1) ä¿®æ”¹ windows æ‰§è¡Œç­–ç•¥

å¦‚æœè¿è¡Œæ—¶æŠ¥é”™ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

ä»¥ ç®¡ç†å‘˜èº«ä»½ æ‰“å¼€ powershell å‘½ä»¤è¡Œï¼Œé€‰å…¨æ˜¯A

```powershell
set-ExecutionPolicy remoteSigned
```

#### 6. å®‰è£…åŒ…ä¾èµ–

åœ¨é¡¹ç›®åä½œä¸­æœ‰ä¸€ä¸ªå¸¸ç”¨çš„å‘½ä»¤å°±æ˜¯ npm i ï¼Œé€šè¿‡è¯¥å‘½ä»¤å¯ä»¥ä¾æ® package.json å’Œ package-lock.json çš„ä¾èµ–å£°æ˜å®‰è£…é¡¹ç›®ä¾èµ–

```shell
npm i
npm install
```

> node_modules æ–‡ä»¶å¤¹å¤§å¤šæ•°æƒ…å†µéƒ½ä¸ä¼šå­˜å…¥ç‰ˆæœ¬åº“

#### 7. å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…

é¡¹ç›®ä¸­å¯èƒ½ä¼šé‡åˆ°ç‰ˆæœ¬ä¸åŒ¹é…çš„æƒ…å†µï¼Œæœ‰æ—¶å°±éœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤çš„

```shell
## æ ¼å¼
npm i <åŒ…å@ç‰ˆæœ¬å·>
## ç¤ºä¾‹
npm i jquery@1.11.2
```

#### 8. åˆ é™¤ä¾èµ–

é¡¹ç›®ä¸­å¯èƒ½éœ€è¦åˆ é™¤æŸäº›ä¸éœ€è¦çš„åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤

```shell
## å±€éƒ¨åˆ é™¤
npm remove uniq
npm r uniq
## å…¨å±€åˆ é™¤
npm remove -g nodemon
```

#### 9. é…ç½®å‘½ä»¤åˆ«å

é€šè¿‡é…ç½®å‘½ä»¤åˆ«åå¯ä»¥æ›´ç®€å•çš„æ‰§è¡Œå‘½ä»¤

é…ç½® package.json ä¸­çš„ scripts å±æ€§

```shell
{
.
.
.
"scripts": {
"server": "node server.js",
"start": "node index.js",
},
.
.
}
```

é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥ä½¿ç”¨åˆ«åæ‰§è¡Œå‘½ä»¤

```shell
npm run server
npm run start
```

ä¸è¿‡ start åˆ«åæ¯”è¾ƒç‰¹åˆ«ï¼Œä½¿ç”¨æ—¶å¯ä»¥çœç•¥ run

```shell
npm start
```

> è¡¥å……è¯´æ˜ï¼š
> 
> - npm start æ˜¯é¡¹ç›®ä¸­å¸¸ç”¨çš„ä¸€ä¸ªå‘½ä»¤ï¼Œä¸€èˆ¬ç”¨æ¥å¯åŠ¨é¡¹ç›®
> 
> - npm run æœ‰è‡ªåŠ¨å‘ä¸Šçº§ç›®å½•æŸ¥æ‰¾çš„ç‰¹æ€§ï¼Œè·Ÿ require å‡½æ•°ä¹Ÿä¸€æ ·
> 
> - å¯¹äºé™Œç”Ÿçš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ scripts å±æ€§æ¥å‚è€ƒé¡¹ç›®çš„ä¸€äº›æ“ä½œ

### 7.3 cnpm

#### 1. ä»‹ç»

cnpm æ˜¯ä¸€ä¸ªæ·˜å®æ„å»ºçš„ npmjs.com çš„å®Œæ•´é•œåƒï¼Œä¹Ÿç§°ä¸ºã€æ·˜å®é•œåƒã€ï¼Œç½‘å€ https://npmmirror.com/

cnpm æœåŠ¡éƒ¨ç½²åœ¨å›½å†… é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Š ï¼Œ å¯ä»¥æé«˜åŒ…çš„ä¸‹è½½é€Ÿåº¦

å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€ä¸ªå…¨å±€å·¥å…·åŒ… cnpm ï¼Œæ“ä½œå‘½ä»¤ä¸ npm å¤§ä½“ç›¸åŒ

#### 2. å®‰è£…

æˆ‘ä»¬å¯ä»¥é€šè¿‡ npm æ¥å®‰è£… cnpm å·¥å…·

```shell
npm install -g cnpm --registry=https://registry.npmmirror.com
```

#### 3. æ“ä½œå‘½ä»¤

| åŠŸèƒ½         | å‘½ä»¤                                                         |
| ------------ | ------------------------------------------------------------ |
| åˆå§‹åŒ–       | cnpm init / cnpm init                                        |
| å®‰è£…åŒ…       | cnpm i uniq<br/>cnpm i -S uniq<br/>cnpm i -D uniq<br/>cnpm i -g nodemon |
| å®‰è£…é¡¹ç›®ä¾èµ– | cnpm i                                                       |
| åˆ é™¤         | cnpm r uniq                                                  |

#### 4. npm é…ç½®æ·˜å®é•œåƒ

ç”¨ npm ä¹Ÿå¯ä»¥ä½¿ç”¨æ·˜å®é•œåƒï¼Œé…ç½®çš„æ–¹å¼æœ‰ä¸¤ç§

- ç›´æ¥é…ç½®

- å·¥å…·é…ç½®

##### (1) ç›´æ¥é…ç½®ï¼ˆä¸æ¨èï¼‰

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯å®Œæˆé…ç½®

```shell
npm config set registry https://registry.npmmirror.com/
```

##### (2) å·¥å…·é…ç½®ï¼ˆæ¨èï¼‰

ä½¿ç”¨ nrm é…ç½® npm çš„é•œåƒåœ°å€ npm registry manager

1. å®‰è£… nrm

```shell
npm i -g nrm
```

2. ä¿®æ”¹é•œåƒ

```shell
nrm use taobao
```

3. æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸï¼ˆé€‰åšï¼‰

```shell
npm config list
```

æ£€æŸ¥ registry åœ°å€æ˜¯å¦ä¸º https://registry.npmmirror.com/ , å¦‚æœæ˜¯åˆ™è¡¨æ˜æˆåŠŸ

> è¡¥å……è¯´æ˜ï¼š
> 
> 1.å»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ è¿›è¡Œé•œåƒé…ç½®ï¼Œå› ä¸ºåç»­ä¿®æ”¹èµ·æ¥ä¼šæ¯”è¾ƒæ–¹ä¾¿
>
> 2.è™½ç„¶ cnpm å¯ä»¥æé«˜é€Ÿåº¦ï¼Œä½†æ˜¯ npm ä¹Ÿå¯ä»¥é€šè¿‡æ·˜å®é•œåƒè¿›è¡ŒåŠ é€Ÿï¼Œæ‰€ä»¥ npm çš„ä½¿ç”¨ç‡è¿˜æ˜¯é«˜äº cnpm

### 7.4 yarn

#### 1. yarn ä»‹ç»

yarn æ˜¯ç”± Facebook åœ¨ 2016 å¹´æ¨å‡ºçš„æ–°çš„ Javascript åŒ…ç®¡ç†å·¥å…·ï¼Œå®˜æ–¹ç½‘å€ï¼š https://yarnpkg.com/

#### 2. yarn ç‰¹ç‚¹

yarn å®˜æ–¹å®£ç§°çš„ä¸€äº›ç‰¹ç‚¹

- é€Ÿåº¦è¶…å¿«ï¼šyarn ç¼“å­˜äº†æ¯ä¸ªä¸‹è½½è¿‡çš„åŒ…ï¼Œæ‰€ä»¥å†æ¬¡ä½¿ç”¨æ—¶æ— éœ€é‡å¤ä¸‹è½½ã€‚ åŒæ—¶åˆ©ç”¨å¹¶è¡Œä¸‹è½½ä»¥æœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡ï¼Œå› æ­¤å®‰è£…é€Ÿåº¦æ›´å¿«

- è¶…çº§å®‰å…¨ï¼šåœ¨æ‰§è¡Œä»£ç ä¹‹å‰ï¼Œyarn ä¼šé€šè¿‡ç®—æ³•æ ¡éªŒæ¯ä¸ªå®‰è£…åŒ…çš„å®Œæ•´

- è¶…çº§å¯é ï¼šä½¿ç”¨è¯¦ç»†ã€ç®€æ´çš„é”æ–‡ä»¶æ ¼å¼å’Œæ˜ç¡®çš„å®‰è£…ç®—æ³•ï¼Œyarn èƒ½å¤Ÿä¿è¯åœ¨ä¸åŒç³»ç»Ÿä¸Šæ— å·®å¼‚çš„å·¥ä½œ

#### 3. yarnå®‰è£…

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ npm å®‰è£… yarn

```shell
npm i -g yarn
```

#### 4. yarn å¸¸ç”¨å‘½ä»¤

| åŠŸèƒ½         | å‘½ä»¤                                                         |
| ------------ | ------------------------------------------------------------ |
| åˆå§‹åŒ–       | yarn init / yarn init -y                                     |
| å®‰è£…åŒ…       | yarn add uniq ç”Ÿäº§ä¾èµ–<br/>yarn add less --dev å¼€å‘ä¾èµ–<br/>yarn global add nodemon å…¨å±€å®‰è£… |
| åˆ é™¤åŒ…       | yarn remove uniq åˆ é™¤é¡¹ç›®ä¾èµ–åŒ…<br/>yarn global remove nodemon å…¨å±€åˆ é™¤åŒ… |
| å®‰è£…é¡¹ç›®ä¾èµ– | yarn                                                         |
| è¿è¡Œå‘½ä»¤åˆ«å | yarn `<åˆ«å>` # ä¸éœ€è¦æ·»åŠ  run                                 |

> æ³¨æ„ï¼š yarnå…¨å±€å®‰è£…çš„åŒ…ä¸å¯ç”¨ ï¼Œyarn å…¨å±€å®‰è£…åŒ…çš„ä½ç½®å¯ä»¥é€šè¿‡ yarn global bin
æ¥æŸ¥çœ‹ï¼Œæ‰‹åŠ¨æ·»åŠ ç¯å¢ƒå˜é‡

#### 5. yarn é…ç½®æ·˜å®é•œåƒ

å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é…ç½®æ·˜å®é•œåƒ

```shell
yarn config set registry https://registry.npmmirror.com/
```

å¯ä»¥é€šè¿‡ yarn config list æŸ¥çœ‹ yarn çš„é…ç½®é¡¹

#### 6. npm å’Œ yarn é€‰æ‹©

å¤§å®¶å¯ä»¥æ ¹æ®ä¸åŒçš„åœºæ™¯è¿›è¡Œé€‰æ‹©

1. ä¸ªäººé¡¹ç›®

å¦‚æœæ˜¯ä¸ªäººé¡¹ç›®ï¼Œ å“ªä¸ªå·¥å…·éƒ½å¯ä»¥ ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥é€‰æ‹©

2. å…¬å¸é¡¹ç›®

å¦‚æœæ˜¯å…¬å¸è¦æ ¹æ®é¡¹ç›®ä»£ç æ¥é€‰æ‹©ï¼Œå¯ä»¥ é€šè¿‡é”æ–‡ä»¶åˆ¤æ–­ é¡¹ç›®çš„åŒ…ç®¡ç†å·¥å…·

npm çš„é”æ–‡ä»¶ä¸º package-lock.json

yarn çš„é”æ–‡ä»¶ä¸º yarn.lock

> åŒ…ç®¡ç†å·¥å…· ä¸è¦æ··ç€ç”¨ï¼Œåˆ‡è®°ï¼Œåˆ‡è®°ï¼Œåˆ‡è®°

### 7.5 ç®¡ç†å‘å¸ƒåŒ…

#### 1. åˆ›å»ºä¸å‘å¸ƒ

æˆ‘ä»¬å¯ä»¥å°†è‡ªå·±å¼€å‘çš„å·¥å…·åŒ…å‘å¸ƒåˆ° npm æœåŠ¡ä¸Šï¼Œæ–¹ä¾¿è‡ªå·±å’Œå…¶ä»–å¼€å‘è€…ä½¿ç”¨ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

1. åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºæ–‡ä»¶ index.jsï¼Œ åœ¨æ–‡ä»¶ä¸­å£°æ˜å‡½æ•°ï¼Œä½¿ç”¨ module.exports æš´éœ²

2. npm åˆå§‹åŒ–å·¥å…·åŒ…ï¼Œpackage.json å¡«å†™åŒ…çš„ä¿¡æ¯ (åŒ…çš„åå­—æ˜¯å”¯ä¸€çš„)

3. æ³¨å†Œè´¦å· https://www.npmjs.com/signup

4. æ¿€æ´»è´¦å· ï¼ˆ ä¸€å®šè¦æ¿€æ´»è´¦å· ï¼‰

5. ä¿®æ”¹ä¸ºå®˜æ–¹çš„å®˜æ–¹é•œåƒ (å‘½ä»¤è¡Œä¸­è¿è¡Œ nrm use npm )

6. å‘½ä»¤è¡Œä¸‹ npm login å¡«å†™ç›¸å…³ç”¨æˆ·ä¿¡æ¯

7. å‘½ä»¤è¡Œä¸‹ npm publish æäº¤åŒ… ğŸ‘Œ

#### 2. æ›´æ–°åŒ…

åç»­å¯ä»¥å¯¹è‡ªå·±å‘å¸ƒçš„åŒ…è¿›è¡Œæ›´æ–°ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹

1. æ›´æ–°åŒ…ä¸­çš„ä»£ç 

2. æµ‹è¯•ä»£ç æ˜¯å¦å¯ç”¨

3. ä¿®æ”¹ package.json ä¸­çš„ç‰ˆæœ¬å·

4. å‘å¸ƒæ›´æ–°

```shell
npm publish
```

#### 3. åˆ é™¤åŒ…

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ é™¤åŒ…

```shell
npm unpublish --force
```

> åˆ é™¤åŒ…éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œ https://docs.npmjs.com/policies/unpublish
> 
> - ä½ æ˜¯åŒ…çš„ä½œè€…
> 
> - å‘å¸ƒå°äº 24 å°æ—¶
> 
> - å¤§äº 24 å°æ—¶åï¼Œæ²¡æœ‰å…¶ä»–åŒ…ä¾èµ–ï¼Œå¹¶ä¸”æ¯å‘¨å°äº 300 ä¸‹è½½é‡ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªç»´æŠ¤è€…

### 7.6 æ‰©å±•å†…å®¹

åœ¨å¾ˆå¤šè¯­è¨€ä¸­éƒ½æœ‰åŒ…ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚ï¼š

| è¯­è¨€       | åŒ…ç®¡ç†å·¥å…·          |
| ---------- | ------------------- |
| PHP        | composer            |
| Python     | pip                 |
| Java       | maven               |
| Go         | go mod              |
| JavaScript | npm/yarn/cnpm/other |
| Ruby       | rubyGems            |

é™¤äº†ç¼–ç¨‹è¯­è¨€é¢†åŸŸæœ‰åŒ…ç®¡ç†å·¥å…·ä¹‹å¤–ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢ä¹Ÿå­˜åœ¨åŒ…ç®¡ç†å·¥å…·ï¼Œä¸è¿‡è¿™ä¸ªåŒ…æŒ‡çš„æ˜¯ã€ è½¯ä»¶åŒ… ã€

| æ“ä½œç³»ç»Ÿ | åŒ…ç®¡ç†å·¥å…· | ç½‘å€                                |
| -------- | ---------- | ----------------------------------- |
| Centos   | yum        | https://packages.debian.org/stable/ |
| Ubuntu   | apt        | https://packages.ubuntu.com/        |
| MacOS    | homebrew   | https://brew.sh/                    |
| Windows  | chocolatey | https://chocolatey.org/             |

### 7.7 nvm

#### 1. ä»‹ç»

nvm å…¨ç§° Node Version Manager é¡¾åæ€ä¹‰å®ƒæ˜¯ç”¨æ¥ç®¡ç† node ç‰ˆæœ¬çš„å·¥å…·ï¼Œæ–¹ä¾¿åˆ‡æ¢ä¸åŒç‰ˆæœ¬çš„Node.js

#### 2. ä½¿ç”¨

nvm çš„ä½¿ç”¨éå¸¸çš„ç®€å•ï¼Œè·Ÿ npm çš„ä½¿ç”¨æ–¹æ³•ç±»ä¼¼

##### (1) ä¸‹è½½å®‰è£…

é¦–å…ˆå…ˆä¸‹è½½ nvmï¼Œä¸‹è½½åœ°å€ https://github.com/coreybutler/nvm-windows/releases ï¼Œ

é€‰æ‹© nvm-setup.exe ä¸‹è½½å³å¯ï¼ˆç½‘ç»œå¼‚å¸¸çš„å°æœ‹å‹å¯ä»¥åœ¨èµ„æ–™æ–‡ä»¶å¤¹ä¸­è·å–ï¼‰

##### (2) å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤                  | è¯´æ˜                            |
| --------------------- | ------------------------------- |
| nvm list available    | æ˜¾ç¤ºæ‰€æœ‰å¯ä»¥ä¸‹è½½çš„ Node.js ç‰ˆæœ¬ |
| nvm list              | æ˜¾ç¤ºå·²å®‰è£…çš„ç‰ˆæœ¬                |
| nvm install 18.12.1   | å®‰è£… 18.12.1 ç‰ˆæœ¬çš„ Node.js     |
| nvm install latest    | å®‰è£…æœ€æ–°ç‰ˆçš„ Node.js            |
| nvm uninstall 18.12.1 | åˆ é™¤æŸä¸ªç‰ˆæœ¬çš„ Node.js          |
| nvm use 18.12.1       | åˆ‡æ¢ 18.12.1 çš„ Node.js         |

## å…«ã€express

### 8.1 express ä»‹ç»

express æ˜¯ä¸€ä¸ªåŸºäº Node.js å¹³å°çš„æç®€ã€çµæ´»çš„ WEB åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå®˜æ–¹ç½‘å€ï¼š https://www.expressjs.com.cn/

ç®€å•æ¥è¯´ï¼Œexpress æ˜¯ä¸€ä¸ªå°è£…å¥½çš„å·¥å…·åŒ…ï¼Œå°è£…äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä¾¿äºæˆ‘ä»¬å¼€å‘ WEB åº”ç”¨ï¼ˆHTTP æœåŠ¡ï¼‰

### 8.2 express ä½¿ç”¨

#### 1. expressä¸‹è½½

express æœ¬èº«æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ npm å®‰è£…

```shell
npm init
npm i express
```

#### 2. express åˆä½“éªŒ

å¤§å®¶å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ­¥éª¤è¿›è¡Œæ“ä½œï¼š

##### (1) åˆ›å»º JS æ–‡ä»¶ï¼Œé”®å…¥å¦‚ä¸‹ä»£ç 

```javascript
//å¯¼å…¥ express
const express = require('express');

//åˆ›å»ºåº”ç”¨å¯¹è±¡
const app = express();

//åˆ›å»ºè·¯ç”±è§„åˆ™
app.get('/home', (req, res) => {
    res.end('hello express server');
});

//ç›‘å¬ç«¯å£ å¯åŠ¨æœåŠ¡
app.listen(3000, () => {
    console.log('æœåŠ¡å·²ç»å¯åŠ¨, ç«¯å£ç›‘å¬ä¸º 3000...');
});
```

##### (2) å‘½ä»¤è¡Œä¸‹æ‰§è¡Œè¯¥è„šæœ¬

```shell
node <æ–‡ä»¶å>
# æˆ–è€…
nodemon <æ–‡ä»¶å>
```

##### (3) è®¿é—®

ç„¶ååœ¨æµè§ˆå™¨å°±å¯ä»¥è®¿é—® http://127.0.0.1:3000/home ğŸ‘Œ

### 8.3 expressè·¯ç”±

#### 1. ä»€ä¹ˆæ˜¯è·¯ç”±

å®˜æ–¹å®šä¹‰ï¼šè·¯ç”±ç¡®å®šäº†åº”ç”¨ç¨‹åºå¦‚ä½•å“åº”å®¢æˆ·ç«¯å¯¹ç‰¹å®šç«¯ç‚¹çš„è¯·æ±‚

#### 2. è·¯ç”±çš„ä½¿ç”¨

ä¸€ä¸ªè·¯ç”±çš„ç»„æˆç”± `è¯·æ±‚æ–¹æ³•` ï¼Œ `è·¯å¾„` å’Œ `å›è°ƒå‡½æ•°` ç»„æˆ

express ä¸­æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨è·¯ç”±ï¼Œä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š

```javascript
app.<method>(pathï¼Œcallback)
```

ä»£ç ç¤ºä¾‹ï¼š

```javascript
//å¯¼å…¥ express
const express = require('express');

//åˆ›å»ºåº”ç”¨å¯¹è±¡
const app = express();

//åˆ›å»ºè·¯ç”±è§„åˆ™
app.get('/home', (req, res) => {
    res.send('ç½‘ç«™é¦–é¡µ');
});

//é¦–é¡µè·¯ç”±
app.get('/', (req, res) => {
    res.send('æˆ‘æ‰æ˜¯çœŸæ­£çš„é¦–é¡µ')
})

//ç™»é™†postè·¯å“Ÿ
app.post('/login', (req, res) => {
    res.send('ç™»é™†æˆåŠŸ')
})

//åŒ¹é…æ‰€æœ‰çš„è¯·æ±‚
app.all('/search', (req, res) => {
    res.send('1ç§’é’Ÿä¸ºæ‚¨æ‰¾åˆ°ç›¸å…³ç»“æœ100000000ä¸ª')
})

//è‡ªå®šä¹‰404è·¯ç”±
app.all('*', (req, res) => {
    res.send('<h1>404 Not Found</h1>')
})

//ç›‘å¬ç«¯å£ å¯åŠ¨æœåŠ¡
app.listen(3000, () => {
    console.log('æœåŠ¡å·²ç»å¯åŠ¨, ç«¯å£ç›‘å¬ä¸º 3000...');
});
```

#### 3. è·å–è¯·æ±‚å‚æ•°

express æ¡†æ¶å°è£…äº†ä¸€äº› API æ¥æ–¹ä¾¿è·å–è¯·æ±‚æŠ¥æ–‡ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”å…¼å®¹åŸç”Ÿ HTTP æ¨¡å—çš„è·å–æ–¹å¼

```javascript
//å¯¼å…¥ express
const express = require('express');

//åˆ›å»ºåº”ç”¨å¯¹è±¡
const app = express();

//åˆ›å»ºè¯·æ±‚çš„è·¯ç”±è§„åˆ™
app.get('/request', (req, res) => {
    //1.è·å–æŠ¥æ–‡çš„æ–¹å¼ä¸httpè·å–æ–¹å¼æ˜¯å…¼å®¹çš„
    console.log(req.method);
    console.log(req.url);
    console.log(req.httpVersion);
    console.log(req.headers);

    //2.express ç‹¬æœ‰çš„è·å–æŠ¥æ–‡çš„æ–¹å¼
    //è·å–æŸ¥è¯¢å­—ç¬¦ä¸²
    console.log(req.query);
    //è·å–æŒ‡å®šçš„è¯·æ±‚å¤´
    console.log(req.get('host'));
    res.send('è¯·æ±‚æŠ¥æ–‡çš„è·å–')
})

//ç›‘å¬ç«¯å£ å¯åŠ¨æœåŠ¡
app.listen(3000, () => {
    console.log('æœåŠ¡å·²ç»å¯åŠ¨, ç«¯å£ç›‘å¬ä¸º 3000...');
});
```

#### 4. è·å–è·¯ç”±å‚æ•°

 `:id` æ„å‘³ç€è¿™ä¸ªä½ç½®å¯ä»¥åŒ¹é…ä»»ä½•å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹ç§°ä¸ºè·¯ç”±å‚æ•° 

```javascript
app.get('/:id.html', (req, res) => {
res.send('å•†å“è¯¦æƒ…, å•†å“ id ä¸º' + req.params.id);
});
```

### 8.4 expresså“åº”è®¾ç½®

express æ¡†æ¶å°è£…äº†ä¸€äº› API æ¥æ–¹ä¾¿ç»™å®¢æˆ·ç«¯å“åº”æ•°æ®ï¼Œå¹¶ä¸”å…¼å®¹åŸç”Ÿ HTTP æ¨¡å—çš„è·å–æ–¹å¼

```javascript
//å¯¼å…¥ express
const express = require('express');

//åˆ›å»ºåº”ç”¨å¯¹è±¡
const app = express();

//åˆ›å»ºè·¯ç”±è§„åˆ™
app.get('/response', (req, res) => {
    //1.expressä¸­è®¾ç½®å“åº”çš„æ–¹å¼å…¼å®¹httpæ¨¡å—çš„æ–¹å¼
    res.statusCode = 404;
    res.statusMessage = 'xxx';
    //è®¾ç½®å“åº”å¤´utf-8ç¼–ç ï¼Œè®©å“åº”çš„å†…å®¹ä¸ä¹±ç 
    res.setHeader('Content-Type', 'text/plain; charset=utf-8');
    res.write('å“åº”ä½“');
    res.end('xxx');

    //2. express çš„å“åº”æ–¹æ³•
    res.status(500); //è®¾ç½®å“åº”çŠ¶æ€ç 
    res.set('xxx', 'yyy');//è®¾ç½®å“åº”å¤´
    res.send('ä¸­æ–‡å“åº”ä¸ä¹±ç ');//è®¾ç½®å“åº”ä½“
    //è¿è´¯æ“ä½œ
    res.status(404).set('xxx', 'yyy').send('ä½ å¥½æœ‹å‹')

    //3. å…¶ä»–å“åº”
    res.redirect('http://atguigu.com')//é‡å®šå‘
    res.download('./package.json');//ä¸‹è½½å“åº”
    res.json();//å“åº” JSON
    res.sendFile(__dirname + '/home.html') //å“åº”æ–‡ä»¶å†…å®¹  
});

//ç›‘å¬ç«¯å£ å¯åŠ¨æœåŠ¡
app.listen(3000, () => {
    console.log('æœåŠ¡å·²ç»å¯åŠ¨, ç«¯å£ç›‘å¬ä¸º 3000...');
});
```

### 8.5 expressä¸­é—´ä»¶

#### 1. ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶

ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æœ¬è´¨æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°

ä¸­é—´ä»¶å‡½æ•° å¯ä»¥åƒè·¯ç”±å›è°ƒä¸€æ ·è®¿é—® è¯·æ±‚å¯¹è±¡ï¼ˆrequestï¼‰ ï¼Œ å“åº”å¯¹è±¡ï¼ˆresponseï¼‰

#### 2. ä¸­é—´ä»¶çš„ä½œç”¨

ä¸­é—´ä»¶çš„ä½œç”¨ å°±æ˜¯ ä½¿ç”¨å‡½æ•°å°è£…å…¬å…±æ“ä½œï¼Œç®€åŒ–ä»£ç 

####  3. ä¸­é—´ä»¶çš„ç±»å‹

- å…¨å±€ä¸­é—´ä»¶
- è·¯ç”±ä¸­é—´ä»¶

##### (1) å®šä¹‰å…¨å±€ä¸­é—´ä»¶

æ¯ä¸€ä¸ªè¯·æ±‚ åˆ°è¾¾æœåŠ¡ç«¯ä¹‹å éƒ½ä¼šæ‰§è¡Œå…¨å±€ä¸­é—´ä»¶å‡½æ•°

å£°æ˜ä¸­é—´ä»¶å‡½æ•°

```javascript
let recordMiddleware = function(request,response,next){
//å®ç°åŠŸèƒ½ä»£ç 
//.....
//æ‰§è¡Œnextå‡½æ•°(å½“å¦‚æœå¸Œæœ›æ‰§è¡Œå®Œä¸­é—´ä»¶å‡½æ•°ä¹‹åï¼Œä»ç„¶ç»§ç»­æ‰§è¡Œè·¯ç”±ä¸­çš„å›è°ƒå‡½æ•°ï¼Œå¿…é¡»è°ƒç”¨next)
next();
}
```

![](./images/17.png)

åº”ç”¨ä¸­é—´ä»¶

```javascript
app.use(recordMiddleware);
```

å£°æ˜æ—¶å¯ä»¥ç›´æ¥å°†åŒ¿åå‡½æ•°ä¼ é€’ç»™ use

```javascript
app.use(function (request, response, next) {
console.log('å®šä¹‰ç¬¬ä¸€ä¸ªä¸­é—´ä»¶');
next();
})
```

##### (2) å¤šä¸ªå…¨å±€ä¸­é—´ä»¶

express å…è®¸ä½¿ç”¨ app.use() å®šä¹‰å¤šä¸ªå…¨å±€ä¸­é—´ä»¶

```javascript
app.use(function (request, response, next) {
console.log('å®šä¹‰ç¬¬ä¸€ä¸ªä¸­é—´ä»¶');
next();
})
app.use(function (request, response, next) {
console.log('å®šä¹‰ç¬¬äºŒä¸ªä¸­é—´ä»¶');
next();
})
```

##### (3) å®šä¹‰è·¯ç”±ä¸­é—´ä»¶

å¦‚æœ åªéœ€è¦å¯¹æŸä¸€äº›è·¯ç”±è¿›è¡ŒåŠŸèƒ½å°è£… ï¼Œåˆ™å°±éœ€è¦è·¯ç”±ä¸­é—´ä»¶

è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š

```javascript
app.get('/è·¯å¾„',`ä¸­é—´ä»¶å‡½æ•°`,(request,response)=>{
});
app.get('/è·¯å¾„',`ä¸­é—´ä»¶å‡½æ•°1`,`ä¸­é—´ä»¶å‡½æ•°2`,(request,response)=>{
});
```

#### 4. é™æ€èµ„æºä¸­é—´ä»¶

express å†…ç½®å¤„ç†é™æ€èµ„æºçš„ä¸­é—´ä»¶

```javascript
//å¼•å…¥expressæ¡†æ¶
const express = require('express');
//åˆ›å»ºæœåŠ¡å¯¹è±¡
const app = express();
//é™æ€èµ„æºä¸­é—´ä»¶çš„è®¾ç½®ï¼Œå°†å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„publicç›®å½•ä½œä¸ºç½‘ç«™çš„æ ¹ç›®å½•
app.use(express.static('./public')); //å½“ç„¶è¿™ä¸ªç›®å½•ä¸­éƒ½æ˜¯ä¸€äº›é™æ€èµ„æº
//å¦‚æœè®¿é—®çš„å†…å®¹ç»å¸¸å˜åŒ–ï¼Œè¿˜æ˜¯éœ€è¦è®¾ç½®è·¯ç”±
//ä½†æ˜¯ï¼Œåœ¨è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœpublicç›®å½•ä¸‹æœ‰index.htmlæ–‡ä»¶ï¼Œå•ç‹¬ä¹Ÿæœ‰index.htmlçš„è·¯ç”±ï¼Œ
//åˆ™è°ä¹¦å†™åœ¨å‰ï¼Œä¼˜å…ˆæ‰§è¡Œè°
app.get('/index.html',(request,response)=>{
respsonse.send('é¦–é¡µ');
});
//ç›‘å¬ç«¯å£
app.listen(3000,()=>{
console.log('3000 ç«¯å£å¯åŠ¨....');
});
```

> æ³¨æ„äº‹é¡¹:
> 1. index.html æ–‡ä»¶ä¸ºé»˜è®¤æ‰“å¼€çš„èµ„æº
> 2. å¦‚æœé™æ€èµ„æºä¸è·¯ç”±è§„åˆ™åŒæ—¶åŒ¹é…ï¼Œè°å…ˆåŒ¹é…è°å°±å“åº”
> 3. è·¯ç”±å“åº”åŠ¨æ€èµ„æºï¼Œé™æ€èµ„æºä¸­é—´ä»¶å“åº”é™æ€èµ„æº

#### 5. è·å–è¯·æ±‚ä½“æ•°æ® body-parser

express å¯ä»¥ä½¿ç”¨ body-parser åŒ…å¤„ç†è¯·æ±‚ä½“

```javascript
npm i body-parser
```

ç¬¬äºŒæ­¥ï¼šå¯¼å…¥ body-parser åŒ…

```javascript
const bodyParser = require('body-parser');
```

ç¬¬ä¸‰æ­¥ï¼šè·å–ä¸­é—´ä»¶å‡½æ•°

```javascript
//å¤„ç† querystring æ ¼å¼çš„è¯·æ±‚ä½“
let urlParser = bodyParser.urlencoded({extended:false}));
//å¤„ç† JSON æ ¼å¼çš„è¯·æ±‚ä½“
let jsonParser = bodyParser.json();
```

ç¬¬å››æ­¥ï¼šè®¾ç½®è·¯ç”±ä¸­é—´ä»¶ï¼Œç„¶åä½¿ç”¨ request.body æ¥è·å–è¯·æ±‚ä½“æ•°æ®

```javascript
app.post('/login', urlParser, (request,response)=>{
//è·å–è¯·æ±‚ä½“æ•°æ®
//console.log(request.body);
//ç”¨æˆ·å
console.log(request.body.username);
//å¯†ç 
console.log(request.body.userpass);
response.send('è·å–è¯·æ±‚ä½“æ•°æ®');
});
```

è·å–åˆ°çš„è¯·æ±‚ä½“æ•°æ®ï¼š

```javascript
[Object: null prototype] { username: 'admin', userpass: '123456' }
```

### 8.6 Router

#### 1. ä»€ä¹ˆæ˜¯ Router

express ä¸­çš„ Router æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸­é—´ä»¶å’Œè·¯ç”±ç³»ç»Ÿï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå°å‹çš„ app å¯¹è±¡ã€‚

#### 2. Router ä½œç”¨

å¯¹è·¯ç”±è¿›è¡Œæ¨¡å—åŒ–ï¼Œæ›´å¥½çš„ç®¡ç†è·¯ç”±

#### 3. Router ä½¿ç”¨

åˆ›å»ºç‹¬ç«‹çš„ JS æ–‡ä»¶ï¼ˆhomeRouter.jsï¼‰

```javascript
//1. å¯¼å…¥ express
const express = require('express');
//2. åˆ›å»ºè·¯ç”±å™¨å¯¹è±¡
const router = express.Router();
//3. åœ¨ router å¯¹è±¡èº«ä¸Šæ·»åŠ è·¯ç”±
router.get('/', (req, res) => {
res.send('é¦–é¡µ');
})
router.get('/cart', (req, res) => {
res.send('è´­ç‰©è½¦');
});
//4. æš´éœ²
module.exports = router;
```

ä¸»æ–‡ä»¶

```javascript
const express = require('express');
const app = express();
//5.å¼•å…¥å­è·¯ç”±æ–‡ä»¶
const homeRouter = require('./routes/homeRouter');
//6.è®¾ç½®å’Œä½¿ç”¨ä¸­é—´ä»¶
app.use(homeRouter);
app.listen(3000,()=>{
console.log('3000 ç«¯å£å¯åŠ¨....');
})
```

### 8.7 JS æ¨¡æ¿å¼•æ“

#### 1. ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“

æ¨¡æ¿å¼•æ“æ˜¯åˆ†ç¦»ç”¨æˆ·ç•Œé¢å’Œä¸šåŠ¡æ•°æ®çš„ä¸€ç§æŠ€æœ¯

#### 2. ä»€ä¹ˆæ˜¯ EJS

EJS æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ Javascript çš„æ¨¡æ¿å¼•æ“

å®˜ç½‘: https://ejs.co/

ä¸­æ–‡ç«™ï¼š https://ejs.bootcss.com/

#### 3. EJS åˆä½“éªŒ

ä¸‹è½½å®‰è£…EJS

```javascript
npm i ejs --save
```

ä»£ç ç¤ºä¾‹

```javascript
//1.å¼•å…¥ejs
const ejs = require('ejs');
//2.å®šä¹‰æ•°æ®
let person = ['å¼ ä¸‰','æå››','ç‹äºŒéº»å­'];
//3.ejsè§£ææ¨¡æ¿è¿”å›ç»“æ„
//<%= %> æ˜¯ejsè§£æå†…å®¹çš„æ ‡è®°ï¼Œä½œç”¨æ˜¯è¾“å‡ºå½“å‰è¡¨è¾¾å¼çš„æ‰§è¡Œç»“æ„
let html = ejs.render(â€˜<%= person.join(",") %>â€™, {person:person});
//4.è¾“å‡ºç»“æœ
console.log(html);
```

å‘½ä»¤è¡Œä¸‹è¿è¡Œ

#### 4. EJS å¸¸ç”¨è¯­æ³•

æ‰§è¡ŒJSä»£ç 

```javascript
<% code %>
```

è¾“å‡ºè½¬ä¹‰çš„æ•°æ®åˆ°æ¨¡æ¿ä¸Š

```javascript
<%= code %>
```

è¾“å‡ºéè½¬ä¹‰çš„æ•°æ®åˆ°æ¨¡æ¿ä¸Š

```javascript
<%- code %>
```

## ä¹ã€mongoDB

### 9.1 ç®€æ´

#### 1. mongoDBæ˜¯ä»€ä¹ˆ

MongoDB æ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼Œå®˜æ–¹åœ°å€ https://www.mongodb.com/

#### 2. æ•°æ®åº“æ˜¯ä»€ä¹ˆ

æ•°æ®åº“ï¼ˆDataBaseï¼‰æ˜¯æŒ‰ç…§æ•°æ®ç»“æ„æ¥ç»„ç»‡ã€å­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ åº”ç”¨ç¨‹åº

#### 3. æ•°æ®åº“çš„ä½œç”¨

æ•°æ®åº“çš„ä¸»è¦ä½œç”¨å°±æ˜¯ ç®¡ç†æ•°æ® ï¼Œå¯¹æ•°æ®è¿›è¡Œ å¢ï¼ˆcï¼‰ã€åˆ ï¼ˆdï¼‰ã€æ”¹ï¼ˆuï¼‰ã€æŸ¥ï¼ˆrï¼‰

#### 4. æ•°æ®åº“ç®¡ç†æ•°æ®çš„ç‰¹ç‚¹

ç›¸æ¯”äºçº¯æ–‡ä»¶ç®¡ç†æ•°æ®ï¼Œæ•°æ®åº“ç®¡ç†æ•°æ®æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

1. é€Ÿåº¦æ›´å¿«

2. æ‰©å±•æ€§æ›´å¼º

3. å®‰å…¨æ€§æ›´å¼º

#### 5. ä¸ºä»€ä¹ˆé€‰æ‹© Mongodb

æ“ä½œè¯­æ³•ä¸ JavaScript ç±»ä¼¼ï¼Œå®¹æ˜“ä¸Šæ‰‹ï¼Œå­¦ä¹ æˆæœ¬ä½

### 9.2 æ ¸å¿ƒæ¦‚å¿µ

Mongodb ä¸­æœ‰ä¸‰ä¸ªé‡è¦æ¦‚å¿µéœ€è¦æŒæ¡

- æ•°æ®åº“ï¼ˆdatabaseï¼‰ æ•°æ®åº“æ˜¯ä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œæ•°æ®åº“æœåŠ¡ä¸‹å¯ä»¥åˆ›å»ºå¾ˆå¤šæ•°æ®åº“ï¼Œæ•°æ®åº“ä¸­å¯ä»¥å­˜æ”¾å¾ˆå¤šé›†åˆ

- é›†åˆï¼ˆcollectionï¼‰ é›†åˆç±»ä¼¼äº JS ä¸­çš„æ•°ç»„ï¼Œåœ¨é›†åˆä¸­å¯ä»¥å­˜æ”¾å¾ˆå¤šæ–‡æ¡£

- æ–‡æ¡£ï¼ˆdocumentï¼‰ æ–‡æ¡£æ˜¯æ•°æ®åº“ä¸­çš„æœ€å°å•ä½ï¼Œç±»ä¼¼äº JS ä¸­çš„å¯¹è±¡

![](./images/18.png)

JSON æ–‡ä»¶ç¤ºä¾‹ï¼š

```json
{
"accounts": [
{
"id": "3-YLju5f3",
"title": "ä¹°ç”µè„‘",
"time": "2023-02-08",
"type": "-1",
"account": "5500",
"remarks": "ä¸ºäº†ä¸Šç½‘è¯¾"
},
{
"id": "3-YLju5f4",
"title": "è¯·å¥³æœ‹å‹åƒé¥­",
"time": "2023-02-08",
"type": "-1",
"account": "214",
"remarks": "æƒ…äººèŠ‚èšé¤"
},
{
"id": "mRQiD4s3K",
"title": "å‘å·¥èµ„",
"time": "2023-02-19",
"type": "1",
"account": "4396",
"remarks": "ç»ˆäºå‘å·¥èµ„å•¦!~~"
}
],
"users":[
{
"id": 1,
"name": "zhangsan",
"age": 18
},
{
"id": 2,
"name": "lisi",
"age": 20
},
{
"id": 3,
"name": "wangwu",
"age": 22
}
]
}
```

å¤§å®¶å¯ä»¥é€šè¿‡ JSON æ–‡ä»¶æ¥ç†è§£ Mongodb ä¸­çš„æ¦‚å¿µ

- ä¸€ä¸ª JSON æ–‡ä»¶ å¥½æ¯”æ˜¯ä¸€ä¸ª æ•°æ®åº“ ï¼Œä¸€ä¸ª Mongodb æœåŠ¡ä¸‹å¯ä»¥æœ‰ N ä¸ªæ•°æ®åº“

- JSON æ–‡ä»¶ä¸­çš„ ä¸€çº§å±æ€§çš„æ•°ç»„å€¼ å¥½æ¯”æ˜¯ é›†åˆ

- æ•°ç»„ä¸­çš„å¯¹è±¡å¥½æ¯”æ˜¯ æ–‡æ¡£

- å¯¹è±¡ä¸­çš„å±æ€§æœ‰æ—¶ä¹Ÿç§°ä¹‹ä¸º å­—æ®µ

### 9.3 ä¸‹è½½å®‰è£…ä¸å¯åŠ¨

ä¸‹è½½åœ°å€ï¼š https://www.mongodb.com/try/download/community

å»ºè®®é€‰æ‹© zip ç±»å‹ï¼Œ é€šç”¨æ€§æ›´å¼º

é…ç½®æ­¥éª¤å¦‚ä¸‹:

1> å°†å‹ç¼©åŒ…ç§»åŠ¨åˆ° C:\Program Files ä¸‹ï¼Œç„¶åè§£å‹

2> åˆ›å»º C:\data\db ç›®å½•ï¼Œmongodb ä¼šå°†æ•°æ®é»˜è®¤ä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹

3> ä»¥ mongodb ä¸­ bin ç›®å½•ä½œä¸ºå·¥ä½œç›®å½•ï¼Œå¯åŠ¨å‘½ä»¤è¡Œ

4> è¿è¡Œå‘½ä»¤ mongod

![](./images/19.png)

çœ‹åˆ°æœ€åçš„ waiting for connections åˆ™è¡¨æ˜æœåŠ¡ å·²ç»å¯åŠ¨æˆåŠŸ

ç„¶åå¯ä»¥ä½¿ç”¨ mongo å‘½ä»¤è¿æ¥æœ¬æœºçš„ mongodb æœåŠ¡

![](./images/20.png)

> æ³¨æ„ï¼š
>
> - ä¸ºäº†æ–¹ä¾¿åç»­æ–¹ä¾¿ä½¿ç”¨ mongod å‘½ä»¤ï¼Œå¯ä»¥å°† bin ç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡ Path ä¸­
>
> - åƒä¸‡ä¸è¦é€‰ä¸­æœåŠ¡ç«¯çª—å£çš„å†…å®¹ ï¼Œé€‰ä¸­ä¼šåœæ­¢æœåŠ¡ï¼Œå¯ä»¥ æ•²å›è½¦ å–æ¶ˆé€‰ä¸­

### 9.4 å‘½ä»¤è¡Œäº¤äº’

#### 1. æ•°æ®åº“å‘½ä»¤

##### (1) æ˜¾ç¤ºæ‰€æœ‰çš„æ•°æ®åº“

```
show dbs
```

##### (2) åˆ‡æ¢åˆ°æŒ‡å®šçš„æ•°æ®åº“ï¼Œå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºæ–°æ•°æ®åº“

```
use æ•°æ®åº“å
```

##### (3) æ˜¾ç¤ºå½“å‰æ‰€åœ¨çš„æ•°æ®åº“

```
db
```

##### (4) åˆ é™¤å½“å‰æ•°æ®åº“

```
use æ•°æ®åº“å
db.dropDatabase()
```

#### 2. é›†åˆå‘½ä»¤

##### (1) åˆ›å»ºé›†åˆ

```
db.createCollection('é›†åˆåç§°')
```

##### (2) æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é›†åˆ

```
show collections
```

##### (3) åˆ é™¤æŸä¸ªé›†åˆ

```
db.é›†åˆå.drop()
```

##### (4) é‡å‘½åé›†åˆ

```
db.é›†åˆå.renameCollection('newName')
```

#### 3. æ–‡æ¡£å‘½ä»¤

##### (1) æ’å…¥æ–‡æ¡£

```
db.é›†åˆå.insert(æ–‡æ¡£å¯¹è±¡);
```

##### (2) æŸ¥è¯¢æ–‡æ¡£

```
db.é›†åˆå.find(æŸ¥è¯¢æ¡ä»¶)
```

##### (3) æ›´æ–°æ–‡æ¡£

```
db.é›†åˆå.update(æŸ¥è¯¢æ¡ä»¶,æ–°çš„æ–‡æ¡£)
db.é›†åˆå.update({name:'å¼ ä¸‰'},{$set:{age:19}})
```

##### (4) åˆ é™¤æ–‡æ¡£

```
db.é›†åˆå.remove(æŸ¥è¯¢æ¡ä»¶)
```

#### 4. åº”ç”¨åœºæ™¯

##### (1) æ–°å¢

- ç”¨æˆ·æ³¨å†Œ

- å‘å¸ƒè§†é¢‘

â€” å‘å¸ƒå•†å“

- å‘æœ‹å‹åœˆ

- å‘è¯„è®º

- å‘å¾®åš

- å‘å¼¹å¹•
- .......

##### (2) åˆ é™¤

- åˆ é™¤è¯„è®º

- åˆ é™¤å•†å“

- åˆ é™¤æ–‡ç« 

- åˆ é™¤è§†é¢‘

- åˆ é™¤å¾®åš

- ......

##### (3) æ›´æ–°

- æ›´æ–°ä¸ªäººä¿¡æ¯

- ä¿®æ”¹å•†å“ä»·æ ¼

- ä¿®æ”¹æ–‡ç« å†…å®¹

- .....

##### (4) æŸ¥è¯¢

- å•†å“åˆ—è¡¨

- è§†é¢‘åˆ—è¡¨

- æœ‹å‹åœˆåˆ—è¡¨

- å¾®åšåˆ—è¡¨

- æœç´¢åŠŸèƒ½

- ......

### 9.5.Mongoose

#### 1. ä»‹ç»

Mongoose æ˜¯ä¸€ä¸ªå¯¹è±¡æ–‡æ¡£æ¨¡å‹åº“ï¼Œå®˜ç½‘ http://www.mongoosejs.net/

#### 2. ä½œç”¨

æ–¹ä¾¿ä½¿ç”¨ä»£ç æ“ä½œ mongodb æ•°æ®åº“

#### 3. ä½¿ç”¨æµç¨‹

```javascript
//å®‰è£…mongoose

//å¯¼å…¥mongooseæ¨¡å—
const mongoose = require('mongoose');

//è¿æ¥æ•°æ®åº“
mongoose.connect('mongodb://127.0.0.1:27017/bilibili')

//è®¾ç½®å›è°ƒ

// è®¾ç½®è¿æ¥æˆåŠŸçš„å›è°ƒï¼ˆæ¨è async/awaitï¼‰
mongoose.connection.once('open', async () => {
    console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ');

    // åˆ›å»ºæ–‡æ¡£çš„ç»“æ„å¯¹è±¡
    const BookSchema = new mongoose.Schema({
        name: String,
        author: String,
        price: Number,
        is_hot: Boolean,
        tags: Array,
        pub_time: Date,
        test: mongoose.Schema.Types.Mixed,
        kk: mongoose.Schema.Types.ObjectId
    });

    // åˆ›å»ºæ¨¡å‹å¯¹è±¡ï¼Œå¯¹æ–‡æ¡£æ“ä½œçš„å°è£…å¯¹è±¡
    const BookModel = mongoose.model('books', BookSchema);

    // ä½¿ç”¨ async/await æ–°å¢æ•°æ®
    try {
        const data = await BookModel.create({
            name: 'è¥¿æ¸¸è®°',
            author: 'å´æ‰¿æ©',
            price: 19.9,
            is_hot: true,
            tags: ['é¬¼æ€ª', 'åŠ±å¿—', 'ç¤¾ä¼š'],
            pub_time: new Date(),
            test: 'abc',
            kk: new mongoose.Types.ObjectId()
        });
        console.log('æ’å…¥æˆåŠŸ:', data);
    } catch (err) {
        console.log('æ’å…¥å¤±è´¥:', err);
    } finally {
        // æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥ï¼ˆæ¨èï¼‰
        mongoose.connection.close();
    }
});


//è®¾ç½®è¿æ¥å¤±è´¥çš„å›è°ƒ
mongoose.connection.once('error', () => {
    console.log('è¿æ¥å¤±è´¥');

})

//è®¾ç½®è¿æ¥å…³é—­çš„å›è°ƒ
mongoose.connection.once('close', () => {
    console.log('è¿æ¥å…³é—­');
})
```

#### 4. å­—æ®µç±»å‹

æ–‡æ¡£ç»“æ„å¯é€‰çš„å¸¸ç”¨å­—æ®µç±»å‹åˆ—è¡¨

| ç±»å‹       | æè¿°                                                       |
| ---------- | ---------------------------------------------------------- |
| String     | å­—ç¬¦ä¸²                                                     |
| Number     | æ•°å­—                                                       |
| Boolean    | å¸ƒå°”å€¼                                                     |
| Array      | æ•°ç»„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨[]æ¥æ ‡è¯†                                   |
| Date       | æ—¥æœŸ                                                       |
| Buffer     | Bufferå¯¹è±¡                                                 |
| Mixed      | ä»»æ„ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨mongoose.Schema.Types.Mixed æŒ‡å®š         |
| ObjectId   | å¯¹è±¡ IDï¼Œéœ€è¦ä½¿ç”¨ mongoose.Schema.Types.ObjectId æŒ‡å®š      |
| Decimal128 | é«˜ç²¾åº¦æ•°å­—ï¼Œéœ€è¦ä½¿ç”¨ mongoose.Schema.Types.Decimal128 æŒ‡å®š |

#### 5. å­—æ®µéªŒè¯

Mongoose æœ‰ä¸€äº›å†…å»ºéªŒè¯å™¨ï¼Œå¯ä»¥å¯¹å­—æ®µå€¼è¿›è¡ŒéªŒè¯

##### (1) å¿…å¡«é¡¹

```javascript
title: {
type: String,
required: true // è®¾ç½®å¿…å¡«é¡¹
}
```

##### (2) é»˜è®¤å€¼

```javascript
author: {
type: String,
default: 'åŒ¿å' //é»˜è®¤å€¼
},
```

##### (3) æšä¸¾å€¼

```javascript
gender: {
type: String,
enum: ['ç”·','å¥³'] //è®¾ç½®çš„å€¼å¿…é¡»æ˜¯æ•°ç»„ä¸­çš„
},
```

##### (4) å”¯ä¸€å€¼

```javascript
username: {
type: String,
unique: true
},
```

>unique éœ€è¦ é‡å»ºé›†åˆ æ‰èƒ½æœ‰æ•ˆæœ
>
>æ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥

#### 6. æ–‡æ¡£å¢åˆ æ”¹æŸ¥

##### (1) å¢åŠ 

å¢åŠ 1æ¡

```javascript
    try {
        const data = await BookModel.create({ name: 'è¥¿æ¸¸è®°', author: 'å´æ‰¿æ©', price: 19.9 });
        console.log('æ’å…¥æˆåŠŸ:', data);
    } catch (err) {
        console.log('æ’å…¥å¤±è´¥:', err);
    } finally {
        // æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥ï¼ˆæ¨èï¼‰
        mongoose.connection.close();    //å…³é—­å½“å‰è¿æ¥å®ä¾‹
        // mongoose.disconnect();    //å…³é—­æ‰€æœ‰è¿æ¥å®ä¾‹
    }
```

å¢åŠ å¤šæ¡

```javascript
//1. å®‰è£… mongoose
//2. å¯¼å…¥ mongoose
const mongoose = require('mongoose');

//è®¾ç½® strictQuery ä¸º true
mongoose.set('strictQuery', true);

//3. è¿æ¥ mongodb æœåŠ¡                        æ•°æ®åº“çš„åç§°
mongoose.connect('mongodb://127.0.0.1:27017/bilibili');

//4. è®¾ç½®å›è°ƒ
// è®¾ç½®è¿æ¥æˆåŠŸçš„å›è°ƒ  once ä¸€æ¬¡   äº‹ä»¶å›è°ƒå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡
mongoose.connection.once('open', async () => {
  console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ');

  //5. åˆ›å»ºæ–‡æ¡£çš„ç»“æ„å¯¹è±¡
  let BookSchema = new mongoose.Schema({
    name: String,
    author: String,
    price: Number,
    is_hot: Boolean
  });

  //6. åˆ›å»ºæ¨¡å‹å¯¹è±¡  å¯¹æ–‡æ¡£æ“ä½œçš„å°è£…å¯¹è±¡
  let BookModel = mongoose.model('novel', BookSchema);

  //7. ä½¿ç”¨ async/await æ–°å¢æ•°æ®
  try {
    const data = await BookModel.insertMany([
      { name: 'è¥¿æ¸¸è®°', author: 'å´æ‰¿æ©', price: 19.9, is_hot: true },
      { name: 'çº¢æ¥¼æ¢¦', author: 'æ›¹é›ªèŠ¹', price: 29.9, is_hot: true },
      { name: 'ä¸‰å›½æ¼”ä¹‰', author: 'ç½—è´¯ä¸­', price: 25.9, is_hot: true },
      { name: 'æ°´æµ’ä¼ ', author: 'æ–½è€åºµ', price: 20.9, is_hot: true },
      { name: 'æ´»ç€', author: 'ä½™å', price: 19.9, is_hot: true },
      { name: 'ç‹‚é£™', author: 'å¾çºªå‘¨', price: 68, is_hot: true },
      { name: 'å¤§é­èƒ½è‡£', author: 'é»‘ç”·çˆµ', price: 9.9, is_hot: false },
      { name: 'çŸ¥åŒ—æ¸¸', author: 'æ´›æ°´', price: 59, is_hot: false },
      { name: 'é“å›', author: 'è·ƒåƒæ„', price: 59, is_hot: false },
      { name: 'ä¸ƒç…ç¢‘', author: 'æ¸¸æ³³çš„çŒ«', price: 29, is_hot: false },
      { name: 'ç‹¬æ¸¸', author: 'é…’ç²¾è¿‡æ•', price: 15, is_hot: false },
      { name: 'å¤§æ³¼çŒ´', author: 'ç”²é±¼ä¸æ˜¯é¾Ÿ', price: 26, is_hot: false },
      { name: 'é»‘æš—ç‹è€…', author: 'å¤ç¾²', price: 39, is_hot: false },
      { name: 'ä¸äºŒå¤§é“', author: 'æ–‡åˆ€æ‰‹äºˆ', price: 89, is_hot: false },
      { name: 'å¤§æ³¼çŒ´', author: 'ç”²é±¼ä¸æ˜¯é¾Ÿ', price: 59, is_hot: false },
      { name: 'é•¿å®‰çš„è”æ', author: 'é©¬ä¼¯åº¸', price: 45, is_hot: true },
      { name: 'å‘½è¿', author: 'è”¡å´‡è¾¾', price: 59.8, is_hot: true },
      { name: 'å¦‚é›ªå¦‚å±±', author: 'å¼ å¤©ç¿¼', price: 58, is_hot: true },
      { name: 'ä¸‰ä½“', author: 'åˆ˜æ…ˆæ¬£', price: 23, is_hot: true },
      { name: 'ç§‹å›­', author: 'æ¨æœ¬èŠ¬', price: 38, is_hot: true },
      { name: 'ç™¾å¹´å­¤ç‹¬', author: 'èŒƒæ™”', price: 39.5, is_hot: true },
      { name: 'åœ¨ç»†é›¨ä¸­å‘¼å–Š', author: 'ä½™å', price: 25, is_hot: true },
    ]);
    console.log('æ•°æ®æ’å…¥æˆåŠŸ:', data);
  } catch (error) {
    console.log('æ•°æ®æ’å…¥å¤±è´¥:', error);
  } finally {
    //8. å…³é—­æ•°æ®åº“è¿æ¥
    mongoose.disconnect();
  }
});

// è®¾ç½®è¿æ¥å¤±è´¥çš„å›è°ƒ
mongoose.connection.on('error', (err) => {
  console.log('è¿æ¥å¤±è´¥:', err);
});

// è®¾ç½®è¿æ¥å…³é—­çš„å›è°ƒ
mongoose.connection.on('close', () => {
  console.log('è¿æ¥å…³é—­');
});
```

##### (2) åˆ é™¤

åˆ é™¤1æ¡

```javascript
   try {
        const result = await BookModel.deleteOne({ name: 'è¥¿æ¸¸è®°' });
        console.log('åˆ é™¤ç»“æœ:', result);
    } catch (error) {
        console.log('åˆ é™¤å¤±è´¥:', error);
    } finally {
        // 7. æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥
        mongoose.disconnect();
    }
```

åˆ é™¤å¤šæ¡

```javascript
    try {
        const result = await BookModel.deleteMany({ is_hot: false });
        console.log('åˆ é™¤ç»“æœ:', result);
    } catch (error) {
        console.log('åˆ é™¤å¤±è´¥:', error);
    } finally {
        // 7. æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥
        mongoose.disconnect();
    }
```

##### (3) æ›´æ–°

æ›´æ–°1æ¡

```javascript
    æ›´æ–°1æ¡
    try {
        const result = await BookModel.updateOne({ name: 'çº¢æ¥¼æ¢¦' }, { price: 9.9 });
        console.log('æ›´æ–°æˆåŠŸ', result);
    } catch (err) {
        console.log('æ›´æ–°å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

æ›´æ–°å¤šæ¡

```javascript
    try {
        const result = await BookModel.updateMany({ author: 'ä½™å' }, { $set: { is_hot: false } });
        console.log('æ›´æ–°æˆåŠŸ', result);
    } catch (err) {
        console.log('æ›´æ–°å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

##### (4) è¯»å–

è¯»å–1æ¡

```javascript
    try {
        const result = await BookModel.findOne({ name: 'ç‹‚é£™' });
        console.log('è¯»å–æˆåŠŸ', result);
    } catch (err) {
        console.log('è¯»å–å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

è¯»å–å¤šæ¡

```javascript
    try {
        const result = await BookModel.find({ author: 'ä½™å' });
        console.log('è¯»å–æˆåŠŸ', result);
    } catch (err) {
        console.log('è¯»å–å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

æŒ‰ç…§idè¯»å–

```javascript
    try {
        const result = await BookModel.findById('682605ef1ebb772ebe569633');
        console.log('è¯»å–æˆåŠŸ', result);
    } catch (err) {
        console.log('è¯»å–å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

è¯»å–å…¨éƒ¨

```javascript
    try {
        const result = await BookModel.find();
        console.log('è¯»å–æˆåŠŸ', result);
    } catch (err) {
        console.log('è¯»å–å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

#### 7. æ¡ä»¶æ§åˆ¶

##### (1) è¿ç®—ç¬¦

åœ¨ mongodb ä¸èƒ½ `> < >= <= !==` ç­‰è¿ç®—ç¬¦ï¼Œéœ€è¦ä½¿ç”¨æ›¿ä»£ç¬¦å·

```
\> ä½¿ç”¨ $gt

< ä½¿ç”¨ $lt

= ä½¿ç”¨ $gte

<= ä½¿ç”¨ $lte

!== ä½¿ç”¨ $ne
```

```javascript
    try {
        const books = await BookModel.find({ price: { $lt: 20 } });
        console.log('æŸ¥è¯¢æˆåŠŸ', books);
    } catch (err) {
        console.log('æŸ¥è¯¢å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

##### (2) é€»è¾‘è¿ç®—

é€»è¾‘æˆ–çš„æƒ…å†µ

```javascript
    try {
        const books = await BookModel.find({ author: { $in: ['æ›¹é›ªèŠ¹', 'ä½™å'] } });
        console.log('æŸ¥è¯¢æˆåŠŸ', books);
    } catch (err) {
        console.log('æŸ¥è¯¢å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

é€»è¾‘ä¸çš„æƒ…å†µ

```javascript
    try {
        const books = await BookModel.find({ price: { $gte: 30, $lt: 70 } });
        console.log('æŸ¥è¯¢æˆåŠŸ', books);
    } catch (err) {
        console.log('æŸ¥è¯¢å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

##### (3) æ­£åˆ™åŒ¹é…

```javascript
    try {
        const books = await BookModel.find({ name: { $regex: /ä¸‰/ } });
        console.log('æŸ¥è¯¢æˆåŠŸ', books);
    } catch (err) {
        console.log('æŸ¥è¯¢å¤±è´¥', err);
    } finally {
        mongoose.connection.close();
    }
```

#### 8. ä¸ªæ€§åŒ–è¯»å–

##### (1) å­—æ®µç­›é€‰

```javascript
    try {
        const data = await BookModel.find().select({ name: 1, author: 1, _id: 0 }).exec();
        console.log('æŸ¥è¯¢ç»“æœ:', data);
    } catch (error) {
        console.log('æŸ¥è¯¢å¤±è´¥:', error);
    } finally {
        //8. æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥
        mongoose.disconnect();
    }
```

##### (2) æ•°æ®å‡åº

```javascript
    try {
        const data = await BookModel.find().select({ name: 1, price: 1, _id: 0 }).sort({ price: 1 }).exec();
        console.log('æŸ¥è¯¢ç»“æœ:', data);
    } catch (error) {
        console.log('æŸ¥è¯¢å¤±è´¥:', error);
    } finally {
        //8. æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥
        mongoose.disconnect();
    }
```

##### (3) æ•°æ®æˆªå–

```javascript
    try {
        const data = await BookModel.find().select({ name: 1, price: 1, _id: 0 }).sort({price: -1}).limit(3).skip(3).exec();
        console.log('æŸ¥è¯¢ç»“æœ:', data);
    } catch (error) {
        console.log('æŸ¥è¯¢å¤±è´¥:', error);
    } finally {
        // 8. æ“ä½œå®Œæˆåå…³é—­æ•°æ®åº“è¿æ¥
        mongoose.disconnect();
    }
```

#### 9. å›¾å½¢åŒ–ç®¡ç†å·¥å…·

mongodbå®˜æ–¹å·¥å…·Compassï¼šhttps://www.mongodb.com/try/download/shell

## åã€apiæ¥å£

### 10.1 ç®€ä»‹

#### 1. æ¥å£æ˜¯ä»€ä¹ˆ

æ¥å£æ˜¯ å‰åç«¯é€šä¿¡çš„æ¡¥æ¢

ç®€å•ç†è§£ï¼šä¸€ä¸ªæ¥å£å°±æ˜¯ æœåŠ¡ä¸­çš„ä¸€ä¸ªè·¯ç”±è§„åˆ™ ï¼Œæ ¹æ®è¯·æ±‚å“åº”ç»“æœ

æ¥å£çš„è‹±æ–‡å•è¯æ˜¯ API (Application Program Interface)ï¼Œæ‰€ä»¥æœ‰æ—¶ä¹Ÿç§°ä¹‹ä¸º API æ¥å£

è¿™é‡Œçš„æ¥å£æŒ‡çš„æ˜¯ã€æ•°æ®æ¥å£ã€ï¼Œ ä¸ç¼–ç¨‹è¯­è¨€ï¼ˆJavaï¼ŒGo ç­‰ï¼‰ä¸­çš„æ¥å£è¯­æ³•ä¸åŒ

#### 2. æ¥å£çš„ä½œç”¨

å®ç° å‰åç«¯é€šä¿¡

![](./images/21.png)

#### 3. æ¥å£çš„å¼€å‘ä¸è°ƒç”¨

å¤§å¤šæ•°æ¥å£éƒ½æ˜¯ç”± åç«¯å·¥ç¨‹å¸ˆ å¼€å‘çš„ï¼Œ å¼€å‘è¯­è¨€ä¸é™

ä¸€èˆ¬æƒ…å†µä¸‹æ¥å£éƒ½æ˜¯ç”± å‰ç«¯å·¥ç¨‹å¸ˆ è°ƒç”¨çš„ï¼Œä½†æœ‰æ—¶ åç«¯å·¥ç¨‹å¸ˆä¹Ÿä¼šè°ƒç”¨æ¥å£ ï¼Œæ¯”å¦‚çŸ­ä¿¡æ¥å£ï¼Œæ”¯ä»˜æ¥å£ç­‰

#### 4. æ¥å£çš„ç»„æˆ

ä¸€ä¸ªæ¥å£ä¸€èˆ¬ç”±å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆ

- è¯·æ±‚æ–¹æ³•

- æ¥å£åœ°å€ï¼ˆURLï¼‰

- è¯·æ±‚å‚æ•°

- å“åº”ç»“æœ

ä¸€ä¸ªæ¥å£ç¤ºä¾‹ https://www.free-api.com/doc/325

![](./images/22.png)

> ä½“éªŒä¸€ä¸‹ï¼š https://api.asilu.com/idcard/?id=371522199111299668

### 10.2 RESTful API

RESTful API æ˜¯ä¸€ç§ç‰¹æ®Šé£æ ¼çš„æ¥å£ï¼Œä¸»è¦ç‰¹ç‚¹æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š

- URL ä¸­çš„è·¯å¾„è¡¨ç¤º èµ„æº ï¼Œè·¯å¾„ä¸­ä¸èƒ½æœ‰ åŠ¨è¯ ï¼Œä¾‹å¦‚ create , delete , update ç­‰è¿™äº›éƒ½ä¸èƒ½æœ‰

- æ“ä½œèµ„æºè¦ä¸ HTTP è¯·æ±‚æ–¹æ³• å¯¹åº”

- æ“ä½œç»“æœè¦ä¸ HTTP å“åº”çŠ¶æ€ç  å¯¹åº”

è§„åˆ™ç¤ºä¾‹ï¼š

| æ“ä½œ         | è¯·æ±‚ç±»å‹ | URL      | è¿”å›                 |
| ------------ | -------- | -------- | -------------------- |
| æ–°å¢æ­Œæ›²     | POST     | /song    | è¿”å›æ–°ç”Ÿæˆçš„æ­Œæ›²ä¿¡æ¯ |
| åˆ é™¤æ­Œæ›²     | DELETE   | /song/10 | è¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£       |
| ä¿®æ”¹æ­Œæ›²     | PUT      | /song/10 | è¿”å›æ›´æ–°åçš„æ­Œæ›²ä¿¡æ¯ |
| ä¿®æ”¹æ­Œæ›²     | PATCH    | /song/10 | è¿”å›æ›´æ–°åçš„æ­Œæ›²ä¿¡æ¯ |
| è·å–æ‰€æœ‰æ­Œæ›² | GET      | /song    | è¿”å›æ­Œæ›²åˆ—è¡¨æ•°ç»„     |
| è·å–å•ä¸ªæ­Œæ›² | GET      | /song/10 | è¿”å›å•ä¸ªæ­Œæ›²ä¿¡æ¯     |

> æ‰©å±•é˜…è¯»ï¼š https://www.ruanyifeng.com/blog/2014/05/restful_api.html

### 10.3 json-server

json-server æœ¬èº«æ˜¯ä¸€ä¸ª JS ç¼–å†™çš„å·¥å…·åŒ…ï¼Œå¯ä»¥å¿«é€Ÿæ­å»º RESTful API æœåŠ¡

å®˜æ–¹åœ°å€: https://github.com/typicode/json-server

æ“ä½œæ­¥éª¤ï¼š

#### 1. å…¨å±€å®‰è£…json-server

```
npm i -g json-server
```

#### 2. åˆ›å»º JSON æ–‡ä»¶ï¼ˆdb.jsonï¼‰

ç¼–å†™åŸºæœ¬ç»“æ„

```json
{
"song": [
{ "id": 1, "name": "å¹²æ¯", "singer": "äº”æœˆå¤©" },
{ "id": 2, "name": "å½“", "singer": "åŠ¨åŠ›ç«è½¦" },
{ "id": 3, "name": "ä¸èƒ½è¯´çš„ç§˜å¯†", "singer": "å‘¨æ°ä¼¦" }
]
}
```

#### 3. åˆ›å»ºapiæœåŠ¡

ä»¥ JSON æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä½œä¸ºå·¥ä½œç›®å½• ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

```
json-server --watch db.json
```

### 10.4 æ¥å£æµ‹è¯•å·¥å…·

ä»‹ç»å‡ ä¸ªæ¥å£æµ‹è¯•å·¥å…·

- apipost https://www.apipost.cn/ (ä¸­æ–‡)

- apifox https://www.apifox.cn/ (ä¸­æ–‡)

- postman https://www.postman.com/ (è‹±æ–‡)

## åä¸€ã€ä¼šè¯æ§åˆ¶

### 11.1 ä»‹ç»

æ‰€è°“ä¼šè¯æ§åˆ¶å°±æ˜¯ å¯¹ä¼šè¯è¿›è¡Œæ§åˆ¶

HTTP æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œå®ƒæ²¡æœ‰åŠæ³•åŒºåˆ†å¤šæ¬¡çš„è¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œ æ— æ³•åŒºåˆ†ç”¨æˆ·

è€Œäº§å“ä¸­åˆå¤§é‡å­˜åœ¨çš„è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ ä¼šè¯æ§åˆ¶ æ¥è§£å†³è¯¥é—®é¢˜

å¸¸è§çš„ä¼šè¯æ§åˆ¶æŠ€æœ¯æœ‰ä¸‰ç§ï¼š

- cookie

- session

- token

### 11.2 cookie

#### 1. cookieæ˜¯ä»€ä¹ˆ

cookie æ˜¯ HTTP æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®

cookie æ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ç«¯çš„ä¸€å°å—æ•°æ®

cookie æ˜¯æŒ‰ç…§åŸŸååˆ’åˆ†ä¿å­˜çš„

ç®€å•ç¤ºä¾‹ï¼š

| åŸŸå                     | cookie                        |
| ------------------------ | ----------------------------- |
| http://www.baidu.com/    | a=100; b=200                  |
| http://www.bilibili.com/ | xid=1020abce121; hm=112411213 |
| jd.com                   | x=100; ocw=12414cce           |

#### 2. cookie çš„ç‰¹ç‚¹

æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨å°† å½“å‰åŸŸåä¸‹ å¯ç”¨çš„ cookie è®¾ç½®åœ¨è¯·æ±‚å¤´ä¸­ï¼Œç„¶åä¼ é€’ç»™æœåŠ¡å™¨

![](./images/23.png)

è¿™ä¸ªè¯·æ±‚å¤´çš„åå­—ä¹Ÿå« cookie ï¼Œæ‰€ä»¥å°† cookie ç†è§£ä¸ºä¸€ä¸ª HTTP çš„è¯·æ±‚å¤´ä¹Ÿæ˜¯å¯ä»¥çš„

#### 3.  cookie çš„è¿è¡Œæµç¨‹

å¡«å†™è´¦å·å’Œå¯†ç æ ¡éªŒèº«ä»½ï¼Œæ ¡éªŒé€šè¿‡åä¸‹å‘ cookie

![](./images/24.png)

æœ‰äº† cookie ä¹‹åï¼Œåç»­å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨æºå¸¦ cookie

![](./images/25.png)

#### 4. æµè§ˆå™¨æ“ä½œ cookie

æµè§ˆå™¨æ“ä½œ cookie çš„æ“ä½œï¼Œä½¿ç”¨ç›¸å¯¹è¾ƒå°‘ï¼Œå¤§å®¶äº†è§£å³å¯
1. ç¦ç”¨æ‰€æœ‰ cookie
2. åˆ é™¤ cookie
3. æŸ¥çœ‹ cookie

#### 5. cookie çš„ä»£ç æ“ä½œ

express ä¸­å¯ä»¥ä½¿ç”¨ cookie-parser è¿›è¡Œå¤„ç†

```javascript
//å¯¼å…¥expressæ¨¡å—
const express = require('express')

//å¯¼å…¥cookie-parserä¸­é—´ä»¶
const cookieParser = require('cookie-parser')
const { log } = require('console')

//åˆ›å»ºappåº”ç”¨
const app = express()

//ä½¿ç”¨ä¸­é—´ä»¶
app.use(cookieParser())

//åˆ›å»ºè·¯ç”±è§„åˆ™
app.get('/set-cookie', (req, res) => {
    // res.cookie('name', 'zhangsan')  //ä¼šåœ¨æµè§ˆå™¨å…³é—­æ—¶é”€æ¯

    res.cookie('name', 'lisi', { maxAge: 1000 * 60 })  //è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º1åˆ†é’Ÿ
    res.cookie('theme', 'blue')
    res.send('home')
})

//åˆ é™¤cookie
app.get('/remove-cookie', (req, res) => {
    //è°ƒç”¨æ–¹æ³•åˆ é™¤cookie
    res.clearCookie('name')
    res.send('åˆ é™¤æˆåŠŸ')

})

//è·å–cookie
app.get('/get-cookie', (req, res) => {
    //è·å–cookie
    console.log(req.cookies);
    res.send(`æ¬¢è¿æ‚¨ ${req.cookies.name}`)
    
})

//å¯åŠ¨æœåŠ¡
app.listen(3000)
```

> ä¸åŒæµè§ˆå™¨ä¸­çš„ cookie æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸å…±äº«

### 11.3 session

#### 1. session æ˜¯ä»€ä¹ˆ

session æ˜¯ä¿å­˜åœ¨ æœåŠ¡å™¨ç«¯çš„ä¸€å—å„¿æ•°æ® ï¼Œä¿å­˜å½“å‰è®¿é—®ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯

#### 2. session çš„ä½œç”¨

å®ç°ä¼šè¯æ§åˆ¶ï¼Œå¯ä»¥è¯†åˆ«ç”¨æˆ·çš„èº«ä»½ï¼Œå¿«é€Ÿè·å–å½“å‰ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯

#### 3. session è¿è¡Œæµç¨‹

å¡«å†™è´¦å·å’Œå¯†ç æ ¡éªŒèº«ä»½ï¼Œæ ¡éªŒé€šè¿‡ååˆ›å»º session ä¿¡æ¯ ï¼Œç„¶åå°† session_id çš„å€¼é€šè¿‡å“åº”å¤´è¿”å›ç»™æµè§ˆå™¨

![](./images/26.png)

æœ‰äº† cookieï¼Œä¸‹æ¬¡å‘é€è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨æºå¸¦ cookieï¼ŒæœåŠ¡å™¨é€šè¿‡ cookie ä¸­çš„ session_id çš„å€¼ç¡®å®šç”¨æˆ·çš„èº«ä»½

![](./images/27.png)

#### 4. session çš„ä»£ç æ“ä½œ

express ä¸­å¯ä»¥ä½¿ç”¨ express-session å¯¹ session è¿›è¡Œæ“ä½œ

```javascript
//å¯¼å…¥expressæ¨¡å—
const express = require('express')

//å¯¼å…¥session-expressæ¨¡å—å’Œconnect-mongoæ¨¡å—
const session = require('express-session')
const MongoStore = require('connect-mongo')

//åˆ›å»ºappåº”ç”¨
const app = express()

//3. è®¾ç½® session çš„ä¸­é—´ä»¶
app.use(session({
    name: 'sid', //è®¾ç½®cookieçš„nameï¼Œé»˜è®¤å€¼æ˜¯ï¼šconnect.sid
    secret: 'atguigu', //å‚ä¸åŠ å¯†çš„å­—ç¬¦ä¸²ï¼ˆåˆç§°ç­¾åï¼‰ åŠ ç›
    saveUninitialized: false, //æ˜¯å¦ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½è®¾ç½®ä¸€ä¸ªcookieç”¨æ¥å­˜å‚¨sessionçš„id
    resave: true, //æ˜¯å¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é‡æ–°ä¿å­˜session
    store: MongoStore.create({
        mongoUrl: 'mongodb://127.0.0.1:27017/bilibili' //æ•°æ®åº“çš„è¿æ¥é…ç½®
    }),
    cookie: {
        httpOnly: true, // å¼€å¯åå‰ç«¯æ— æ³•é€šè¿‡ JS æ“ä½œ
        maxAge: 1000 * 60 * 5 // è¿™ä¸€æ¡ æ˜¯æ§åˆ¶ sessionID çš„è¿‡æœŸæ—¶é—´çš„ï¼ï¼ï¼
    },
}))

//åˆ›å»ºè·¯ç”±è§„åˆ™
app.get('/', (req, res) => {
    res.send('home')
})

//ç™»é™†
app.get('/login', (req, res) => {
    //ä¼ é€’ç”¨æˆ·åå’Œå¯†ç  username=admin&password=admin
    if (req.query.username === 'admin' && req.query.password === 'admin') {
        //è®¾ç½®session
        req.session.username = 'admin'
        req.session.uid = '258aefccc'
        // æˆåŠŸå“åº”
        res.send('ç™»é™†æˆåŠŸ')
    } else {
        res.send('ç™»é™†å¤±è´¥')
    }
})

//è¯»å–session
app.get('/cart', (req, res) => {
    //æ£€æµ‹sessionæ˜¯å¦å­˜åœ¨ç”¨æˆ·æ•°æ®
    if (req.session.username) {
        res.send(`æ¬¢è¿ ${req.session.username} å…‰ä¸´è´­ç‰©è½¦`)
    } else {
        res.send('æ‚¨è¿˜æ²¡æœ‰ç™»é™†')
    }
})

//sessioné”€æ¯
app.get('/logout', (req, res) => {
    req.session.destroy(err => {
        res.send('é€€å‡ºæˆåŠŸ')
    })

})

//å¯åŠ¨æœåŠ¡
app.listen(3000)
```

### 11.4 session å’Œ cookie çš„åŒºåˆ«

cookie å’Œ session çš„åŒºåˆ«ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š

1. **å­˜åœ¨çš„ä½ç½®**

   - cookieï¼šæµè§ˆå™¨ç«¯

   - sessionï¼šæœåŠ¡ç«¯

2. **å®‰å…¨æ€§**

   - cookie æ˜¯ä»¥æ˜æ–‡çš„æ–¹å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒä½

   - session å­˜æ”¾äºæœåŠ¡å™¨ä¸­ï¼Œæ‰€ä»¥å®‰å…¨æ€§ **ç›¸å¯¹** è¾ƒå¥½

3. **ç½‘ç»œä¼ è¾“é‡**
- cookie è®¾ç½®å†…å®¹è¿‡å¤šä¼šå¢å¤§æŠ¥æ–‡ä½“ç§¯ï¼Œä¼šå½±å“ä¼ è¾“æ•ˆç‡
  
- session æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œåªæ˜¯é€šè¿‡ cookie ä¼ é€’ idï¼Œæ‰€ä»¥ä¸å½±å“ä¼ è¾“æ•ˆç‡
  
4. **å­˜å‚¨é™åˆ¶**

   - æµè§ˆå™¨é™åˆ¶å•ä¸ª cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ **4K**ï¼Œä¸”å•ä¸ªåŸŸåä¸‹çš„å­˜å‚¨æ•°é‡ä¹Ÿæœ‰é™åˆ¶

   - session æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™äº›é™åˆ¶

### 11.5 token

#### 1. token æ˜¯ä»€ä¹ˆ

token æ˜¯æœåŠ¡ç«¯ç”Ÿæˆå¹¶è¿”å›ç»™ HTTP å®¢æˆ·ç«¯çš„ä¸€ä¸²åŠ å¯†å­—ç¬¦ä¸²ï¼Œ token ä¸­ä¿å­˜ç€ ç”¨æˆ·ä¿¡æ¯

#### 2. token çš„ä½œç”¨

å®ç°ä¼šè¯æ§åˆ¶ï¼Œå¯ä»¥è¯†åˆ«ç”¨æˆ·çš„èº«ä»½ï¼Œä¸»è¦ç”¨äºç§»åŠ¨ç«¯ APP

#### 3. token çš„å·¥ä½œæµç¨‹

å¡«å†™è´¦å·å’Œå¯†ç æ ¡éªŒèº«ä»½ï¼Œæ ¡éªŒé€šè¿‡åå“åº” tokenï¼Œtoken ä¸€èˆ¬æ˜¯åœ¨å“åº”ä½“ä¸­è¿”å›ç»™å®¢æˆ·ç«¯çš„

![](./images/28.png)

åç»­å‘é€è¯·æ±‚æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å°† token æ·»åŠ åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œä¸€èˆ¬æ˜¯æ”¾åœ¨è¯·æ±‚å¤´ä¸­

![](./images/29.png)

#### 4. token çš„ç‰¹ç‚¹

- æœåŠ¡ç«¯å‹åŠ›æ›´å°

   - æ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯

- ç›¸å¯¹æ›´å®‰å…¨

   - æ•°æ®åŠ å¯†

- å¯ä»¥é¿å… CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰

   - æ‰©å±•æ€§æ›´å¼º

- æœåŠ¡é—´å¯ä»¥å…±äº«

   - å¢åŠ æœåŠ¡èŠ‚ç‚¹æ›´ç®€å•

#### 5. JWT

JWTï¼ˆJSON Web Token ï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œå¯ç”¨äºåŸºäº token çš„èº«ä»½éªŒè¯ |

JWT ä½¿ token çš„ç”Ÿæˆä¸æ ¡éªŒæ›´è§„èŒƒ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ jsonwebtoken åŒ… æ¥æ“ä½œ token

```javascript
//å¯¼å…¥jwtæ¨¡å—
const { log } = require('console');
const jwt = require('jsonwebtoken');

//ç”Ÿæˆtoken
// let token = jwt.sign(ç”¨æˆ·æ•°æ®,åŠ å¯†å­—ç¬¦ä¸²,é…ç½®å¯¹è±¡)
// let token = jwt.sign({
//     name: 'zhangsan',
// }, 'atguigu', {
//     expiresIn: 600  //å•ä½æ˜¯ç§’
// })


// console.log(token)

let t = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemhhbmdzYW4iLCJpYXQiOjE3NDc3NjAyMDYsImV4cCI6MTc0Nzc2MDgwNn0.Oj4I_t3mDQ7IltA2NatJp1QR4SnSN95_ZOQZZB0z-Pk'

//éªŒè¯token
jwt.verify(t, 'atguigu', (err, data) => {
    if (err) {
        console.log('tokenéªŒè¯å¤±è´¥');
        return
    }
    console.log(data);

})
```

> æ‰©å±•é˜…è¯»ï¼š https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html

### 11.6 é™„å½•

#### 1. æœ¬åœ°åŸŸå

æ‰€è°“æœ¬åœ°åŸŸåå°±æ˜¯ åªèƒ½åœ¨æœ¬æœºä½¿ç”¨çš„åŸŸå ï¼Œä¸€èˆ¬åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨

#### 2. æ“ä½œæµç¨‹

##### (1) æ“ä½œæµç¨‹

ç¼–è¾‘æ–‡ä»¶ C:\Windows\System32\drivers\etc\hosts

```
127.0.0.1 www.baidu.com
```

å¦‚æœä¿®æ”¹å¤±è´¥ï¼Œ å¯ä»¥ä¿®æ”¹è¯¥æ–‡ä»¶çš„æƒé™

![](./images/30.png)

##### (2) åŸç†

åœ¨åœ°å€æ è¾“å…¥ åŸŸå ä¹‹åï¼Œæµè§ˆå™¨ä¼šå…ˆè¿›è¡Œ DNSï¼ˆDomain Name Systemï¼‰ æŸ¥è¯¢ï¼Œè·å–è¯¥åŸŸåå¯¹åº”çš„ IP åœ°å€

è¯·æ±‚ä¼šå‘é€åˆ° DNS æœåŠ¡å™¨ï¼Œå¯ä»¥ æ ¹æ®åŸŸåè¿”å› IP åœ°å€

å¯ä»¥é€šè¿‡ ipconfig /all æŸ¥çœ‹æœ¬æœºçš„ DNS æœåŠ¡å™¨

hosts æ–‡ä»¶ä¹Ÿå¯ä»¥è®¾ç½®åŸŸåä¸ IP çš„æ˜ å°„å…³ç³»ï¼Œåœ¨å‘é€è¯·æ±‚å‰ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶è·å–åŸŸåçš„ IPåœ°å€

