# Debianè‡ªåŠ¨é…ç½®è„šæœ¬

## ä¸€ã€è¿è¡Œ

- å¤åˆ¶è„šæœ¬å†…å®¹ä¿å­˜ä¸ºauto-script.sh

```bash
#!/bin/bash

# æ£€æŸ¥rootæƒé™
if [ "$EUID" -ne 0 ]; then
    echo "âŒ è¯·ä½¿ç”¨ root æˆ– sudo æƒé™æ‰§è¡Œæ­¤è„šæœ¬ï¼"
    exit 1
fi

# ä¸»èœå•
function main_menu() {
    clear
    echo "ğŸš€ Debian 12 è‡ªåŠ¨é…ç½®è„šæœ¬"
    echo "============================"
    echo " 1. é…ç½®é™æ€IP"
    echo " 2. æ¢å¤DHCP"
    echo " 3. æ¢ä¸­ç§‘å¤§æº"
    echo " 4. å®‰è£…UFWé˜²ç«å¢™"
    echo " 5. é…ç½®UFWé˜²ç«å¢™è§„åˆ™"
    echo " 6. å®‰è£…DockeråŠDocker Compose"
    echo " 7. SSHå…å¯†ç™»å½•è®¾ç½®"
    echo " 8. ç³»ç»Ÿåƒåœ¾æ¸…ç†ï¼ˆæ¯æœˆè‡ªåŠ¨ï¼‰"
    echo " 9. ç³»ç»Ÿæ€§èƒ½å’Œå­˜å‚¨ä¼˜åŒ–"
    echo "10. æ—¶é—´åŒæ­¥å’Œè®¾ç½®æ—¶åŒº"
    echo "11. ç¦ç”¨IPv6"
    echo "12. ä¿®æ”¹ä¸»æœºå"
    echo "13. å®‰è£…qemu-guest-agent"
    echo "14. å®‰è£…å¹¶é…ç½®OpenSSH"
    echo "15. ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€"
    echo " 0. é€€å‡ºè„šæœ¬"
    echo "============================"
    read -p "è¯·é€‰æ‹©ä¸€ä¸ªæ“ä½œ [0-15]: " choice
    case $choice in
        1) configure_static_ip ;;
        2) restore_dhcp ;;
        3) switch_ustc_source ;;
        4) install_ufw ;;
        5) configure_ufw ;;
        6) install_docker ;;
        7) setup_ssh_nopass ;;
        8) setup_cleanup ;;
        9) performance_optimize ;;
        10) setup_time_sync ;;
        11) disable_ipv6 ;;
        12) change_hostname ;;
        13) install_qemu_agent ;;
        14) install_openssh ;;
        15) monitor_system ;;
        0) exit 0 ;;
        *) echo "æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥ï¼" && sleep 2 && main_menu ;;
    esac
}

# è¯·å°†ä»¥ä¸‹æ‰€æœ‰ä½ é™„ä»¶ä¸­çš„åŠŸèƒ½è„šæœ¬ä¾æ¬¡å®Œæ•´å¤åˆ¶åˆ°å¯¹åº”å‡½æ•°ä¸­ï¼š

function configure_static_ip(){
    # 2.1 é…ç½®é™æ€IP
    #!/bin/bash
    
    # Debian 12 é™æ€IPé…ç½®è„šæœ¬ï¼Œç›´æ¥ç¼–è¾‘ /etc/network/interfacesï¼Œå¹¶æ‰‹åŠ¨æ›´æ–° /etc/resolv.conf DNSè®¾ç½®
    
    INTERFACES_FILE="/etc/network/interfaces"
    RESOLV_FILE="/etc/resolv.conf"
    
    # å¤‡ä»½å½“å‰é…ç½®
    cp ${INTERFACES_FILE} ${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
    cp ${RESOLV_FILE} ${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
    echo "å·²å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶ï¼š${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
    echo "å·²å¤‡ä»½DNSé…ç½®æ–‡ä»¶ï¼š${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
    
    # è¾“å…¥ç½‘å¡åç§°
    read -p "è¯·è¾“å…¥ç½‘å¡åï¼ˆå¦‚eth0æˆ–ens18ï¼Œé»˜è®¤ens18ï¼‰: " INTERFACE
    INTERFACE=${INTERFACE:-ens18}
    
    # è·å–ç³»ç»Ÿå½“å‰IPã€æ©ç ã€ç½‘å…³ã€DNSä½œä¸ºé»˜è®¤å€¼
    CURRENT_IP=$(ip -4 addr show ${INTERFACE} | grep -oP '(?<=inet\s)\d+(\.\d+){3}')
    CURRENT_NETMASK=$(ifconfig ${INTERFACE} | grep -oP '(?<=netmask\s)\d+(\.\d+){3}')
    CURRENT_GATEWAY=$(ip route | grep default | grep ${INTERFACE} | awk '{print $3}')
    CURRENT_DNS=$(grep "nameserver" /etc/resolv.conf | head -n1 | awk '{print $2}')
    
    # è®¾ç½®é»˜è®¤å€¼ï¼ˆå¦‚æœè·å–ä¸åˆ°åˆ™ä½¿ç”¨å¸¸è§„é»˜è®¤å€¼ï¼‰
    [ -z "$CURRENT_NETMASK" ] && CURRENT_NETMASK="255.255.255.0"
    [ -z "$CURRENT_GATEWAY" ] && CURRENT_GATEWAY="192.168.1.1"
    [ -z "$CURRENT_DNS" ] && CURRENT_DNS="8.8.8.8"
    
    # ç”¨æˆ·è¾“å…¥æ–°é…ç½®ï¼Œæä¾›é»˜è®¤å€¼
    read -p "è¯·è¾“å…¥é™æ€IPåœ°å€ï¼ˆé»˜è®¤ï¼š${CURRENT_IP}ï¼‰: " STATIC_IP
    STATIC_IP=${STATIC_IP:-$CURRENT_IP}
    
    read -p "è¯·è¾“å…¥å­ç½‘æ©ç ï¼ˆé»˜è®¤ï¼š${CURRENT_NETMASK}ï¼‰: " NETMASK
    NETMASK=${NETMASK:-$CURRENT_NETMASK}
    
    read -p "è¯·è¾“å…¥ç½‘å…³åœ°å€ï¼ˆé»˜è®¤ï¼š${CURRENT_GATEWAY}ï¼‰: " GATEWAY
    GATEWAY=${GATEWAY:-$CURRENT_GATEWAY}
    
    read -p "è¯·è¾“å…¥DNSæœåŠ¡å™¨ï¼ˆé»˜è®¤ï¼š${CURRENT_DNS}ï¼Œå¤šä¸ªDNSç©ºæ ¼åˆ†éš”ï¼‰: " DNS
    DNS=${DNS:-$CURRENT_DNS}
    
    # åˆ é™¤ interfaces æ–‡ä»¶ä¸­å·²æœ‰çš„è¯¥ç½‘å¡é…ç½®ï¼ˆè‹¥å­˜åœ¨ï¼‰
    sed -i "/iface ${INTERFACE} inet/,/^$/d" ${INTERFACES_FILE}
    sed -i "/auto ${INTERFACE}/d" ${INTERFACES_FILE}
    sed -i "/allow-hotplug ${INTERFACE}/d" ${INTERFACES_FILE}
    
    # å†™å…¥æ–°çš„é™æ€IPé…ç½®åˆ°interfacesæ–‡ä»¶
cat >> ${INTERFACES_FILE} <<EOF

auto ${INTERFACE}
iface ${INTERFACE} inet static
    address ${STATIC_IP}
    netmask ${NETMASK}
    gateway ${GATEWAY}
EOF
    
    echo "é™æ€IPåœ°å€å·²æˆåŠŸé…ç½®åˆ°${INTERFACES_FILE}"
    
    # å†™å…¥DNSé…ç½®åˆ°resolv.confæ–‡ä»¶
    echo "# Generated by setup_static_ip.sh on $(date)" > ${RESOLV_FILE}
    for dns_server in ${DNS}
    do
        echo "nameserver ${dns_server}" >> ${RESOLV_FILE}
    done
    
    echo "DNSå·²æˆåŠŸé…ç½®åˆ°${RESOLV_FILE}"
    
    # é‡å¯ç½‘ç»œæœåŠ¡ä»¥åº”ç”¨é…ç½®
    systemctl restart networking
    
    # æ˜¾ç¤ºå½“å‰ç½‘ç»œé…ç½®ä¸DNSé…ç½®
    echo "å½“å‰${INTERFACE}æ¥å£ç½‘ç»œä¿¡æ¯ä¸ºï¼š"
    ip addr show ${INTERFACE}
    echo ""
    echo "å½“å‰DNSé…ç½®ä¿¡æ¯ä¸ºï¼š"
    cat ${RESOLV_FILE}
}

function restore_dhcp(){
    # 2.2 æ¢å¤DHCP
    #!/bin/bash
    
    # Debian 12 æ¢å¤ DHCP é…ç½®è„šæœ¬
    # ç›´æ¥ç¼–è¾‘ /etc/network/interfaces æ–‡ä»¶å¹¶æ¢å¤DNSä¸ºDHCPè‡ªåŠ¨è·å–
    
    INTERFACES_FILE="/etc/network/interfaces"
    RESOLV_FILE="/etc/resolv.conf"
    
    # å¤‡ä»½å½“å‰é…ç½®
    cp ${INTERFACES_FILE} ${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
    cp ${RESOLV_FILE} ${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
    echo "å·²å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶ï¼š${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
    echo "å·²å¤‡ä»½DNSé…ç½®æ–‡ä»¶ï¼š${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
    
    # è¾“å…¥ç½‘å¡åç§°
    read -p "è¯·è¾“å…¥è¦æ¢å¤ DHCP çš„ç½‘å¡åï¼ˆé»˜è®¤ ens18ï¼‰: " INTERFACE
    INTERFACE=${INTERFACE:-ens18}
    
    # åˆ é™¤ interfaces æ–‡ä»¶ä¸­å·²æœ‰çš„è¯¥ç½‘å¡é…ç½®ï¼ˆè‹¥å­˜åœ¨ï¼‰
    sed -i "/iface ${INTERFACE} inet/,/^$/d" ${INTERFACES_FILE}
    sed -i "/auto ${INTERFACE}/d" ${INTERFACES_FILE}
    sed -i "/allow-hotplug ${INTERFACE}/d" ${INTERFACES_FILE}
    
    # å†™å…¥ DHCP é…ç½®åˆ° interfaces æ–‡ä»¶
cat >> ${INTERFACES_FILE} <<EOF

allow-hotplug ${INTERFACE}
iface ${INTERFACE} inet dhcp
EOF
    
    echo "å·²æˆåŠŸæ¢å¤ DHCP é…ç½®åˆ° ${INTERFACES_FILE}"
    
    # æ¸…ç©º resolv.conf ä»¥ä¾¿ DHCP è‡ªåŠ¨æ›´æ–°DNS
    echo "# Generated by restore_dhcp.sh on $(date)" > ${RESOLV_FILE}
    
    # é‡å¯ç½‘ç»œæœåŠ¡åº”ç”¨é…ç½®
    systemctl restart networking
    
    # ç­‰å¾…å‡ ç§’é’Ÿè®© DHCP è·å–åœ°å€
    echo "è¯·ç¨ç­‰å‡ ç§’é’Ÿï¼Œè®© DHCP è·å– IP åœ°å€..."
    sleep 5
    
    # æ˜¾ç¤ºå½“å‰ç½‘ç»œé…ç½®å’ŒDNSé…ç½®
    echo "å½“å‰ ${INTERFACE} æ¥å£ç½‘ç»œä¿¡æ¯ä¸ºï¼š"
    ip addr show ${INTERFACE}
    echo ""
    echo "å½“å‰ DNS é…ç½®ä¿¡æ¯ä¸ºï¼š"
    cat ${RESOLV_FILE}
}

function switch_ustc_source(){
    # 2.3 æ¢ä¸­ç§‘å¤§æº
    #!/bin/bash
    
    # Debian 12 ä¸€é”®æ¢æºè„šæœ¬ï¼ˆä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æºï¼‰
    SOURCES_FILE="/etc/apt/sources.list"
    
    # å¤‡ä»½åŸsources.listæ–‡ä»¶
    cp ${SOURCES_FILE} ${SOURCES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
    echo "å·²å¤‡ä»½åŸæ–‡ä»¶ä¸º ${SOURCES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
    
    # æ¸…ç©ºåŸæ–‡ä»¶å†…å®¹ï¼Œå¹¶å†™å…¥æ–°æºå†…å®¹
cat > ${SOURCES_FILE} <<EOF
# é»˜è®¤æ³¨é‡Šäº†æºç ä»“åº“ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š
deb http://mirrors.ustc.edu.cn/debian bookworm main contrib non-free non-free-firmware
# deb-src http://mirrors.ustc.edu.cn/debian bookworm main contrib non-free non-free-firmware
deb http://mirrors.ustc.edu.cn/debian bookworm-updates main contrib non-free non-free-firmware
# deb-src http://mirrors.ustc.edu.cn/debian bookworm-updates main contrib non-free non-free-firmware

# backports è½¯ä»¶æºï¼Œè¯·æŒ‰éœ€å¯ç”¨
# deb http://mirrors.ustc.edu.cn/debian bookworm-backports main contrib non-free non-free-firmware
# deb-src http://mirrors.ustc.edu.cn/debian bookworm-backports main contrib non-free non-free-firmware
EOF
    
    echo "å·²æˆåŠŸæ›¿æ¢è½¯ä»¶æºä¸ºä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒæºã€‚"
    
    # æ›´æ–°è½¯ä»¶æº
    apt update
}

function install_ufw(){
    # 2.4 å®‰è£…UFW
    #!/bin/bash
    
    # Debian 12 æ£€æŸ¥å¹¶å®‰è£…UFWé˜²ç«å¢™è„šæœ¬
    
    # æ£€æŸ¥æ˜¯å¦å·²å®‰è£…UFW
    if dpkg -s ufw &> /dev/null; then
        echo "âœ… UFW å·²ç»å®‰è£…ï¼Œæ— éœ€å†æ¬¡å®‰è£…ã€‚"
    else
        echo "âš™ï¸ UFW æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…ä¸­..."
        apt update
        apt install -y ufw
        
        # å†æ¬¡æ£€æŸ¥æ˜¯å¦æˆåŠŸå®‰è£…
        if dpkg -s ufw &> /dev/null; then
            echo "âœ… UFW å®‰è£…æˆåŠŸï¼"
        else
            echo "âŒ UFW å®‰è£…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–è½¯ä»¶æºè®¾ç½®ï¼"
            exit 1
        fi
    fi
    
    # æ˜¾ç¤ºUFWå½“å‰çŠ¶æ€
    echo ""
    echo "ğŸ” å½“å‰UFWçŠ¶æ€ï¼š"
    ufw status verbose
}

function configure_ufw(){
    # 2.5 UFWé…ç½®é˜²ç«å¢™
    #!/bin/bash
    
    # Debian 12 UFW é˜²ç«å¢™é…ç½®è„šæœ¬ï¼ˆç”¨æˆ·è‡ªå®šä¹‰å…è®¸æˆ–ç¦ç”¨ç«¯å£ï¼‰
    
    # æ£€æŸ¥UFWæ˜¯å¦å·²å®‰è£…
    if ! dpkg -s ufw &> /dev/null; then
        echo "âš ï¸ UFW å°šæœªå®‰è£…ï¼Œè¯·å…ˆæ‰§è¡Œå®‰è£…è„šæœ¬å†è¿›è¡Œæ­¤æ“ä½œã€‚"
        exit 1
    fi
    
    echo "ğŸš€ å¼€å§‹é…ç½®UFWé˜²ç«å¢™..."
    
    # è®¾ç½®é»˜è®¤è§„åˆ™
    echo "âš™ï¸ è®¾ç½®é»˜è®¤è§„åˆ™ï¼šé»˜è®¤æ‹’ç»å…¥ç«™æµé‡ï¼Œå…è®¸å‡ºç«™æµé‡..."
    ufw default deny incoming
    ufw default allow outgoing
    
    # æ˜¾ç¤ºå½“å‰ufwçŠ¶æ€
    echo ""
    echo "ğŸ“‹ å½“å‰UFWè§„åˆ™å¦‚ä¸‹:"
    ufw status numbered
    echo ""
    
    # å…è®¸ç”¨æˆ·æ–°å¢ç«¯å£
    read -p "ğŸ›¡ï¸ æ˜¯å¦éœ€è¦å…è®¸æ–°çš„ç«¯å£ï¼Ÿ(y/n): " open_ports
    if [[ "$open_ports" =~ ^[Yy]$ ]]; then
        read -p "è¯·è¾“å…¥ä½ æƒ³å…è®¸çš„ç«¯å£å·(å¦‚22 80 443)ï¼Œå¤šä¸ªç«¯å£ä»¥ç©ºæ ¼åˆ†éš”: " ports_allow
        for port in $ports_allow; do
            ufw allow $port && echo "âœ… å·²å…è®¸ç«¯å£ $port"
        done
    fi
    
    # å…è®¸ç”¨æˆ·ç¦ç”¨ä¹‹å‰å¼€æ”¾çš„ç«¯å£
    read -p "ğŸš« æ˜¯å¦éœ€è¦ç¦ç”¨ä¹‹å‰å¼€æ”¾çš„ç«¯å£ï¼Ÿ(y/n): " close_ports
    if [[ "$close_ports" =~ ^[Yy]$ ]]; then
        read -p "è¯·è¾“å…¥ä½ æƒ³ç¦ç”¨çš„ç«¯å£å·(å¦‚22 80 443)ï¼Œå¤šä¸ªç«¯å£ä»¥ç©ºæ ¼åˆ†éš”: " ports_deny
        for port in $ports_deny; do
            ufw delete allow $port && echo "âœ… å·²ç¦ç”¨ç«¯å£ $port" || echo "âš ï¸ ç¦ç”¨ç«¯å£ $port æ—¶å‡ºé”™æˆ–ä¸å­˜åœ¨è¯¥è§„åˆ™"
        done
    fi
    
    # å¯ç”¨ufwï¼ˆå¦‚æœæœªå¯ç”¨ï¼‰
    echo ""
    echo "ğŸŸ¢ å¯ç”¨UFWé˜²ç«å¢™..."
    ufw --force enable
    
    # é‡è½½è§„åˆ™
    ufw reload
    
    # æ˜¾ç¤ºå½“å‰é˜²ç«å¢™çŠ¶æ€
    echo ""
    echo "ğŸ“‹ æœ€ç»ˆUFWé˜²ç«å¢™çŠ¶æ€:"
    ufw status verbose
}

function install_docker(){
    # 2.6 å®‰è£…dockerå’Œdocker compose
    apt update
    apt install ca-certificates curl
    install -m 0755 -d /etc/apt/keyrings
    curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
    chmod a+r /etc/apt/keyrings/docker.asc
    
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://mirrors.aliyun.com/docker-ce/linux/debian $(. /etc/os-release && echo "$VERSION_CODENAME") stable" |tee /etc/apt/sources.list.d/docker.list > /dev/null
    
    apt update
    apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y
    
    systemctl start docker
    systemctl enable docker
    
    docker --version
    docker compose version
}

function setup_ssh_nopass(){
    # 2.7 SSHå…å¯†ç™»å½•è®¾ç½®
    #!/bin/bash
    
    # SSHå…å¯†ç™»å½•é…ç½®è„šæœ¬ï¼ˆå®¢æˆ·ç«¯Windowsï¼‰
    
    echo "ğŸš€ æœ¬è„šæœ¬å¸®åŠ©ä½ è®¾ç½®SSHå…¬é’¥ç™»å½•ï¼ˆå…å¯†ç ç™»å½•ï¼‰"
    echo ""
    
    # æç¤ºç”¨æˆ·åœ¨æœ¬åœ°ç”Ÿæˆå¯†é’¥å¯¹
    echo "ğŸ”‘ è¯·åœ¨ä½ çš„ Windows 10 å®¢æˆ·ç«¯æ‰§è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå¦‚æœªç”Ÿæˆï¼‰ï¼š"
    echo ""
    echo "    ssh-keygen -t rsa -b 4096"
    echo ""
    echo "âš ï¸ å‘½ä»¤æ‰§è¡Œåä¸€è·¯å›è½¦å³å¯ï¼Œå¯†é’¥é»˜è®¤ä¿å­˜åœ¨ C:\\Users\\ä½ çš„ç”¨æˆ·å\\.ssh\\"
    echo ""
    
    # æç¤ºç”¨æˆ·æ‰“å¼€å…¬é’¥æ–‡ä»¶å¹¶å¤åˆ¶å†…å®¹
    echo "ğŸ“‹ è¯·åœ¨ Windows ä¸Šæ‰“å¼€å…¬é’¥æ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„ï¼‰ï¼š"
    echo ""
    echo "    C:\\Users\\ä½ çš„ç”¨æˆ·å\\.ssh\\id_rsa.pub"
    echo ""
    echo "ç„¶åå¤åˆ¶é‡Œé¢æ‰€æœ‰å†…å®¹ï¼Œæ¥ä¸‹æ¥å°†åœ¨æœåŠ¡å™¨ç«¯ç²˜è´´ã€‚"
    echo ""
    
    # ç­‰å¾…ç”¨æˆ·ç¡®è®¤
    read -p "âœ… å·²å¤åˆ¶å…¬é’¥å†…å®¹åˆ°å‰ªè´´æ¿äº†å—ï¼Ÿï¼ˆy/nï¼‰ï¼š" is_copied
    
    if [[ "$is_copied" =~ ^[Yy]$ ]]; then
        # åˆ›å»º.sshç›®å½•å¹¶è®¾ç½®æƒé™
        mkdir -p ~/.ssh
        chmod 700 ~/.ssh
        
        # ç”¨æˆ·ç²˜è´´å…¬é’¥åˆ°authorized_keys
        echo ""
        echo "âœï¸ è¯·å°†åˆšæ‰å¤åˆ¶çš„SSHå…¬é’¥å†…å®¹ç²˜è´´åˆ°ä¸‹æ–¹ï¼š"
        read -r ssh_pubkey
        
        # æ£€æŸ¥æ˜¯å¦ä¸ºç©º
        if [[ -z "$ssh_pubkey" ]]; then
            echo "âš ï¸ é”™è¯¯ï¼šæœªæ£€æµ‹åˆ°å…¬é’¥å†…å®¹ï¼Œé€€å‡ºé…ç½®ã€‚"
            exit 1
        fi
        
        # å°†å…¬é’¥å†™å…¥authorized_keysæ–‡ä»¶
        echo "$ssh_pubkey" >> ~/.ssh/authorized_keys
        chmod 600 ~/.ssh/authorized_keys
        
        echo ""
        echo "âœ… å…¬é’¥æ·»åŠ æˆåŠŸï¼"
    else
        echo "âš ï¸ è¯·å…ˆå®Œæˆå…¬é’¥å¤åˆ¶æ“ä½œï¼Œå†é‡æ–°è¿è¡Œæœ¬è„šæœ¬ã€‚"
        exit 1
    fi
    
    # æç¤ºç”¨æˆ·æµ‹è¯•å…å¯†ç™»é™†
    server_ip=$(hostname -I | awk '{print $1}')
    current_user=$(whoami)
    
    echo ""
    echo "ğŸš© ç°åœ¨è¯·åœ¨ Windows å®¢æˆ·ç«¯ä¸Šæµ‹è¯•SSHå…å¯†ç™»é™†ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š"
    echo ""
    echo "    ssh ${current_user}@${server_ip}"
    echo ""
    
    echo "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ æ— éœ€è¾“å…¥å¯†ç å³å¯æˆåŠŸç™»é™†ï¼ğŸš€"
}

function setup_cleanup(){
    # 2.8 ç³»ç»Ÿåƒåœ¾æ¸…ç†
    #!/bin/bash
    
    # è‡ªåŠ¨åˆ›å»º Debian åƒåœ¾æ¸…ç†è„šæœ¬å¹¶é…ç½®æ¯æœˆæœ«è‡ªåŠ¨æ‰§è¡Œçš„ä»»åŠ¡
    
    CLEANUP_SCRIPT="/usr/local/bin/system_cleanup.sh"
    LOG_FILE="/var/log/system_cleanup.log"
    
    echo "ğŸš©å¼€å§‹åˆ›å»ºç³»ç»Ÿåƒåœ¾æ¸…ç†è„šæœ¬..."
    
    # åˆ›å»ºè‡ªåŠ¨æ¸…ç†è„šæœ¬
cat > ${CLEANUP_SCRIPT} <<'EOF'
#!/bin/bash

# Debian ç³»ç»Ÿåƒåœ¾è‡ªåŠ¨æ¸…ç†è„šæœ¬

# æ¸…ç†APTç¼“å­˜
apt clean
apt autoclean
apt autoremove -y

# åˆ é™¤ä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/* /var/tmp/*

# åˆ é™¤æ—§çš„å‹ç¼©æ—¥å¿—
find /var/log -type f -name "*.gz" -exec rm -f {} \;
find /var/log -type f -name "*.1" -exec rm -f {} \;

# æ¸…ç©ºå…¶ä»–æ—¥å¿—æ–‡ä»¶
find /var/log -type f -exec truncate -s 0 {} \;

# åˆ é™¤ç”¨æˆ·çš„ç¼©ç•¥å›¾ç¼“å­˜ï¼ˆå¦‚æœæœ‰å›¾å½¢ç•Œé¢ï¼‰
rm -rf /home/*/.cache/thumbnails/*

# è¾“å‡ºæ‰§è¡Œæ—¶é—´åˆ°æ—¥å¿—
echo "ç³»ç»Ÿåƒåœ¾æ¸…ç†å®Œæˆäº $(date)" >> /var/log/system_cleanup.log
EOF
    
    # ç»™è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™
    chmod +x ${CLEANUP_SCRIPT}
    
    echo "âœ… åƒåœ¾æ¸…ç†è„šæœ¬åˆ›å»ºæˆåŠŸï¼Œè·¯å¾„ä¸ºï¼š${CLEANUP_SCRIPT}"
    
    # é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯æœˆæœˆåº•è‡ªåŠ¨æ‰§è¡Œï¼‰
    echo "ğŸš© æ­£åœ¨é…ç½®å®šæ—¶ä»»åŠ¡..."
    
    (crontab -l 2>/dev/null | grep -v "${CLEANUP_SCRIPT}"; \
    echo '59 23 28-31 * * [ "$(date -d tomorrow '\''+\%d'\'')" = "01" ] && /usr/local/bin/system_cleanup.sh') | crontab -
    
    echo "âœ… å®šæ—¶ä»»åŠ¡é…ç½®å®Œæˆï¼"
    
    # æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æ·»åŠ æˆåŠŸ
    echo ""
    echo "ğŸš© æ­£åœ¨æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦æ·»åŠ æˆåŠŸ..."
    
    if crontab -l | grep -q "${CLEANUP_SCRIPT}"; then
        echo "âœ… å®šæ—¶ä»»åŠ¡æ·»åŠ æˆåŠŸï¼å½“å‰å®šæ—¶ä»»åŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š"
        crontab -l | grep "${CLEANUP_SCRIPT}"
    else
        echo "âŒ å®šæ—¶ä»»åŠ¡æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥åé‡è¯•ï¼"
        exit 1
    fi
    
    echo ""
    echo "ğŸ‰å…¨éƒ¨é…ç½®å®Œæˆï¼ç³»ç»Ÿæ¯æœˆæœ€åä¸€å¤©23:59å°†è‡ªåŠ¨æ¸…ç†åƒåœ¾æ–‡ä»¶ã€‚"
    echo "æ¸…ç†æ—¥å¿—åœ¨ï¼š${LOG_FILE}"
}

function performance_optimize(){
    # 2.9 ç³»ç»Ÿæ€§èƒ½å’Œå­˜å‚¨ä¼˜åŒ–
    #!/bin/bash
    
    echo "ğŸš€ å¼€å§‹ Debian 12 (PVE è™šæ‹Ÿæœº) æ€§èƒ½ä¼˜åŒ–..."
    
    # 1ï¸âƒ£ ä¼˜åŒ– swappiness å‚æ•°ä¸º10ï¼Œé™ä½swapä½¿ç”¨é¢‘ç‡
    echo "âœ… æ­£åœ¨è®¾ç½® swappiness å‚æ•°ä¸º10..."
    if grep -q "vm.swappiness" /etc/sysctl.conf; then
        sed -i 's/^vm.swappiness.*/vm.swappiness = 10/' /etc/sysctl.conf
    else
        echo "vm.swappiness = 10" >> /etc/sysctl.conf
    fi
    sysctl -p
    
    # 2ï¸âƒ£ å¯ç”¨ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ä»¥æé«˜ç½‘ç»œæ€§èƒ½ï¼ˆè™šæ‹Ÿæœºé€‚ç”¨ï¼‰
    echo "âœ… æ­£åœ¨å¯ç”¨ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•..."
    if ! grep -q "net.core.default_qdisc" /etc/sysctl.conf; then
        echo "net.core.default_qdisc = fq" >> /etc/sysctl.conf
    fi
    if ! grep -q "net.ipv4.tcp_congestion_control" /etc/sysctl.conf; then
        echo "net.ipv4.tcp_congestion_control = bbr" >> /etc/sysctl.conf
    fi
    sysctl -p
    
    # éªŒè¯ TCP BBR æ˜¯å¦å¯ç”¨æˆåŠŸ
    if sysctl net.ipv4.tcp_congestion_control | grep -q "bbr"; then
        echo "âœ… TCP BBR å·²æˆåŠŸå¯ç”¨ï¼"
    else
        echo "âŒ TCP BBR å¯ç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬æ˜¯å¦æ”¯æŒï¼"
    fi
    
    # 3ï¸âƒ£ æ£€æµ‹è™šæ‹Ÿæœºç£ç›˜æ˜¯å¦æ”¯æŒ TRIM (discard)ï¼Œå†å†³å®šæ˜¯å¦å¯ç”¨å®šæœŸ TRIM
    echo "âœ… æ­£åœ¨æ£€æµ‹è™šæ‹Ÿç£ç›˜æ˜¯å¦æ”¯æŒ TRIM (discard)..."
    
    DISCARD_SUPPORT=$(lsblk -D | awk 'NR>1 && $4=="0B" {print $1}' | wc -l)
    
    if [ "$DISCARD_SUPPORT" -ne 0 ]; then
        echo "âš ï¸ æ£€æµ‹åˆ°è™šæ‹Ÿç£ç›˜ä¸æ”¯æŒ TRIMï¼Œè·³è¿‡å¯ç”¨ fstrim æœåŠ¡ã€‚"
    else
        echo "âœ… è™šæ‹Ÿç£ç›˜æ”¯æŒ TRIMï¼Œæ­£åœ¨å¯ç”¨ fstrim æœåŠ¡..."
        systemctl enable --now fstrim.timer
        
        # éªŒè¯ fstrim æœåŠ¡çŠ¶æ€
        if systemctl is-enabled fstrim.timer | grep -q "enabled"; then
            echo "âœ… fstrim å®šæœŸ TRIM æœåŠ¡å·²æˆåŠŸå¯ç”¨ï¼"
        else
            echo "âŒ fstrim æœåŠ¡å¯ç”¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ã€‚"
        fi
    fi
    
    echo ""
    echo "ğŸ‰ Debian 12 (PVE è™šæ‹Ÿæœº) æ€§èƒ½ä¼˜åŒ–é…ç½®å®Œæˆï¼"
}

function setup_time_sync(){
    # 2.10 æ—¶é—´åŒæ­¥å’Œè®¾ç½®æ—¶åŒº
    #!/bin/bash
    
    echo "ğŸŒ Debian 12 (PVEè™šæ‹Ÿæœº) æ—¶é—´åŒæ­¥ä¸æ—¶åŒºè®¾ç½®è„šæœ¬ã€é»˜è®¤æ—¶åŒº: Asia/Shanghaiã€‘"
    
    # æ£€æŸ¥æ˜¯å¦ä»¥rootæƒé™è¿è¡Œ
    if [ "$EUID" -ne 0 ]; then
        echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
        exit 1
    fi
    
    # ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œå¯ç”¨chronyæœåŠ¡è¿›è¡Œæ—¶é—´åŒæ­¥
    echo "ğŸš© æ­£åœ¨å®‰è£…å’Œå¯ç”¨chronyæ—¶é—´åŒæ­¥æœåŠ¡..."
    apt update
    apt install -y chrony
    
    # å¯ç”¨å¹¶å¯åŠ¨chronyæœåŠ¡
    systemctl enable --now chrony
    
    # éªŒè¯chronyæœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ
    if systemctl is-active chrony | grep -q "active"; then
        echo "âœ… chronyæœåŠ¡å·²æˆåŠŸå¯åŠ¨å’Œå¯ç”¨ï¼"
    else
        echo "âŒ chronyæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
        exit 1
    fi
    
    # å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡æ—¶é—´åŒæ­¥
    chronyc -a makestep
    
    # æ˜¾ç¤ºå½“å‰æ—¶é—´åŒæ­¥æºçŠ¶æ€
    echo ""
    echo "ğŸ•’ å½“å‰chronyæ—¶é—´åŒæ­¥æºçŠ¶æ€ï¼š"
    chronyc sources -v
    echo ""
    
    # ç¬¬äºŒæ­¥ï¼šäº¤äº’å¼è®¾ç½®æ—¶åŒºï¼ˆé»˜è®¤Asia/Shanghaiï¼ŒæŒ‰å›è½¦ä½¿ç”¨é»˜è®¤å€¼ï¼‰
    default_timezone="Asia/Shanghai"
    current_tz=$(timedatectl | grep "Time zone" | awk '{print $3}')
    echo "â° å½“å‰ç³»ç»Ÿæ—¶åŒºä¸ºï¼š$current_tz"
    echo ""
    
    echo "è¯·è¾“å…¥ä½ æƒ³è®¾ç½®çš„æ—¶åŒºï¼Œä¾‹å¦‚ï¼šAsia/Shanghai"
    echo "å¯ç”¨çš„æ—¶åŒºåˆ—è¡¨å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/List_of_tz_database_time_zones"
    read -p "è¯·è¾“å…¥æ–°çš„æ—¶åŒº (é»˜è®¤: ${default_timezone}): " new_timezone
    
    # å¦‚æœç”¨æˆ·æœªè¾“å…¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
    if [ -z "$new_timezone" ]; then
        new_timezone="$default_timezone"
    fi
    
    # æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ—¶åŒºæ˜¯å¦æœ‰æ•ˆ
    if [ ! -f "/usr/share/zoneinfo/$new_timezone" ]; then
        echo "âŒ æ—¶åŒº [$new_timezone] ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‹¼å†™åé‡æ–°è¿è¡Œè„šæœ¬ï¼"
        exit 1
    fi
    
    # è®¾ç½®æ–°æ—¶åŒº
    timedatectl set-timezone "$new_timezone"
    
    # æ˜¾ç¤ºè®¾ç½®åçš„æ—¶åŒºå’Œæ—¶é—´
    echo ""
    echo "âœ… æ—¶åŒºè®¾ç½®æˆåŠŸï¼å½“å‰æ—¶åŒºä¸ºï¼š$(timedatectl | grep "Time zone" | awk '{print $3}')"
    echo "ğŸ•’ å½“å‰ç³»ç»Ÿæ—¶é—´ä¸ºï¼š$(date)"
}

function disable_ipv6(){
    # 2.11 ç¦ç”¨IPv6
    #!/bin/bash
    
    echo "ğŸš© å¼€å§‹ç¦ç”¨ Debian 12 ç³»ç»Ÿ IPv6 åŠŸèƒ½..."
    
    # æ£€æŸ¥æ˜¯å¦ä»¥rootæƒé™è¿è¡Œ
    if [ "$EUID" -ne 0 ]; then
        echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
        exit 1
    fi
    
    # å¤‡ä»½sysctl.confæ–‡ä»¶
    sysctl_conf="/etc/sysctl.conf"
    backup_conf="/etc/sysctl.conf.bak_ipv6"
    if [ ! -f "$backup_conf" ]; then
        cp $sysctl_conf $backup_conf
        echo "âœ… å·²å¤‡ä»½åŸå§‹sysctl.confè‡³ $backup_conf"
    fi
    
    # ç¦ç”¨IPv6çš„sysctlé…ç½®
    echo "âœ… æ­£åœ¨é…ç½®ç¦ç”¨IPv6..."
cat <<EOF >> $sysctl_conf

# ç¦ç”¨IPv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
EOF
    
    # ç«‹å³åº”ç”¨é…ç½®
    sysctl -p
    
    # ç¦ç”¨IPv6æ¨¡å—åŠ è½½ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰
    echo "âœ… æ­£åœ¨é…ç½®ç¦æ­¢IPv6æ¨¡å—åŠ è½½..."
    modprobe_conf="/etc/modprobe.d/disable_ipv6.conf"
    echo "options ipv6 disable=1" > $modprobe_conf
    
    # æ›´æ–°initramfsä½¿æ¨¡å—ç¦ç”¨ç”Ÿæ•ˆ
    update-initramfs -u
    
    # éªŒè¯IPv6æ˜¯å¦ç¦ç”¨æˆåŠŸ
    if sysctl net.ipv6.conf.all.disable_ipv6 | grep -q "1"; then
        echo "âœ… IPv6å·²æˆåŠŸç¦ç”¨ï¼"
    else
        echo "âŒ IPv6ç¦ç”¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
    fi
    
    echo ""
    echo "ğŸ‰ Debian 12 IPv6ç¦ç”¨é…ç½®å®Œæˆï¼è¯·é‡å¯ç³»ç»Ÿä»¥ç¡®ä¿å½»åº•ç”Ÿæ•ˆï¼ˆæ¨èï¼‰ï¼"
}

function change_hostname(){
    # 2.12 ä¿®æ”¹ä¸»æœºå
    #!/bin/bash
    
    echo "ğŸš© Debian 12 ä¸»æœºåä¿®æ”¹è„šæœ¬"
    
    # æ£€æŸ¥æ˜¯å¦ä»¥rootæƒé™è¿è¡Œ
    if [ "$EUID" -ne 0 ]; then
        echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
        exit 1
    fi
    
    # æ˜¾ç¤ºå½“å‰ä¸»æœºå
    current_hostname=$(hostnamectl hostname)
    echo "ğŸ”– å½“å‰ä¸»æœºåä¸ºï¼š$current_hostname"
    echo ""
    
    # æç¤ºç”¨æˆ·è¾“å…¥æ–°çš„ä¸»æœºå (é»˜è®¤ä¸ºå½“å‰ä¸»æœºå)
    read -p "è¯·è¾“å…¥æ–°çš„ä¸»æœºå (é»˜è®¤: $current_hostname): " new_hostname
    
    # å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥ï¼Œä½¿ç”¨å½“å‰ä¸»æœºå
    if [ -z "$new_hostname" ]; then
        new_hostname=$current_hostname
    fi
    
    # éªŒè¯ä¸»æœºååˆæ³•æ€§ï¼ˆä»…å…è®¸å­—æ¯ã€æ•°å­—ã€çŸ­æ¨ªçº¿ï¼Œé•¿åº¦1-63å­—ç¬¦ï¼‰
    if [[ ! $new_hostname =~ ^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}$ ]]; then
        echo "âŒ ä¸»æœºå [$new_hostname] ä¸åˆæ³•ï¼ä»…å…è®¸å­—æ¯ã€æ•°å­—ã€çŸ­æ¨ªçº¿ï¼Œä¸”é•¿åº¦ä¸º1-63å­—ç¬¦ã€‚"
        exit 1
    fi
    
    # è®¾ç½®æ–°ä¸»æœºå
    echo "âœ… æ­£åœ¨è®¾ç½®æ–°ä¸»æœºåä¸ºï¼š$new_hostname"
    hostnamectl set-hostname "$new_hostname"
    
    # ä¿®æ”¹/etc/hostsæ–‡ä»¶ï¼Œç¡®ä¿ä¸»æœºåè§£ææ­£ç¡®
    if grep -q "127.0.1.1" /etc/hosts; then
        sed -i "/127.0.1.1/c\127.0.1.1\t$new_hostname" /etc/hosts
    else
        echo -e "127.0.1.1\t$new_hostname" >> /etc/hosts
    fi
    
    # æ˜¾ç¤ºä¿®æ”¹åçš„ä¸»æœºåä¿¡æ¯
    echo ""
    echo "âœ… ä¸»æœºåä¿®æ”¹æˆåŠŸï¼å½“å‰ä¸»æœºåä¿¡æ¯ï¼š"
    hostnamectl status
    
    echo ""
    echo "ğŸ‰ ä¸»æœºåè®¾ç½®å®Œæˆï¼å»ºè®®é‡å¯ä¸€æ¬¡ç³»ç»Ÿä»¥ç¡®ä¿æ‰€æœ‰æœåŠ¡ç”Ÿæ•ˆï¼ˆæ¨èï¼‰ã€‚"
}

function install_qemu_agent(){
    # 2.13 å®‰è£…qemu-guest-agent
    #!/bin/bash
    
    echo "ğŸš© Debian 12 (PVE è™šæ‹Ÿæœº) qemu-guest-agent è‡ªåŠ¨å®‰è£…è„šæœ¬"
    
    # æ£€æŸ¥æ˜¯å¦ä»¥ root æƒé™è¿è¡Œ
    if [ "$EUID" -ne 0 ]; then
        echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
        exit 1
    fi
    
    # æ£€æŸ¥æ˜¯å¦å·²å®‰è£… qemu-guest-agent
    if dpkg -s qemu-guest-agent &> /dev/null; then
        echo "âœ… qemu-guest-agent å·²å®‰è£…ï¼Œè·³è¿‡å®‰è£…æ­¥éª¤ã€‚"
    else
        # æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£… qemu-guest-agent
        echo "âœ… æ­£åœ¨æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£… qemu-guest-agent..."
        apt update
        apt install -y qemu-guest-agent
    fi
    
    # å¯ç”¨å¹¶å¯åŠ¨ qemu-guest-agent æœåŠ¡
    echo "âœ… æ­£åœ¨å¯ç”¨å¹¶å¯åŠ¨ qemu-guest-agent æœåŠ¡..."
    systemctl enable --now qemu-guest-agent
    
    # æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
    echo ""
    if systemctl is-active qemu-guest-agent | grep -q "active"; then
        echo "âœ… qemu-guest-agent æœåŠ¡å·²æˆåŠŸè¿è¡Œï¼"
    else
        echo "âŒ qemu-guest-agent æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
        exit 1
    fi
    
    echo ""
    echo "ğŸ‰ qemu-guest-agent å®‰è£…å’Œé…ç½®å®Œæˆï¼"
    echo "ğŸ”„ è¯·é‡å¯æ­¤è™šæ‹Ÿæœºï¼Œä»¥ç¡®ä¿ Proxmox VE èƒ½å®Œæ•´è¯†åˆ«å¹¶ä½¿ç”¨ qemu-guest-agentï¼"
}

function install_openssh(){
    # 2.14 å®‰è£…openssh
    #!/bin/bash
    echo "ğŸš€ æ­£åœ¨å®‰è£…OpenSSHæœåŠ¡å¹¶å¯ç”¨rootç™»å½•..."
    apt update && apt install -y openssh-server
    systemctl enable --now ssh
    
    SSH_CONFIG="/etc/ssh/sshd_config"
    BACKUP_CONFIG="/etc/ssh/sshd_config.bak_$(date '+%Y%m%d_%H%M%S')"
    cp ${SSH_CONFIG} ${BACKUP_CONFIG}
    
    sed -i 's/^#*PermitRootLogin.*/PermitRootLogin yes/' ${SSH_CONFIG}
    sed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication yes/' ${SSH_CONFIG}
    
    systemctl restart ssh
}

function monitor_system(){
    # 2.15 ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
    #!/bin/bash
    
    # å®šä¹‰Ctrl+Cé€€å‡ºæ—¶çš„æç¤ºå‡½æ•°
    exit_script() {
        echo ""
        echo "ğŸ‘‹ å·²é€€å‡ºç³»ç»Ÿå®æ—¶çŠ¶æ€ç›‘æ§ã€‚"
        exit 0
    }
    
    # æ•è·Ctrl+Cä¿¡å·ï¼Œè°ƒç”¨é€€å‡ºå‡½æ•°
    trap exit_script SIGINT
    
    # æ— é™å¾ªç¯å±•ç¤ºç³»ç»ŸçŠ¶æ€ï¼Œæ¯2ç§’åˆ·æ–°ä¸€æ¬¡
    while true
    do
        clear
        echo "ğŸ“Š Debian 12 ç³»ç»Ÿå®æ—¶çŠ¶æ€ç›‘æ§ï¼ˆæ¯2ç§’åˆ·æ–°ï¼‰"
        echo "==================================================="
        
        # å½“å‰ç³»ç»Ÿæ—¶é—´
        echo -e "\nâ° å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š$(date '+%Y-%m-%d %H:%M:%S')"
        
        # ä¸»æœºåå’Œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯
        echo -e "\nğŸ”– ä¸»æœºåï¼š$(hostname)"
        echo "ğŸ“Œ ç³»ç»Ÿç‰ˆæœ¬ï¼š$(lsb_release -d | awk -F '\t' '{print $2}')"
        
        # ç³»ç»Ÿè¿è¡Œæ—¶é—´
        echo -e "\nğŸš€ ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼š$(uptime -p)"
        
        # CPUä½¿ç”¨ç‡ä¸è´Ÿè½½
        echo -e "\nğŸ–¥ï¸ CPUä½¿ç”¨ç‡ä¸è´Ÿè½½ï¼š"
        top -b -n1 | grep "Cpu(s)" | awk '{print "å½“å‰CPUä½¿ç”¨æƒ…å†µï¼š " 100 - $8 "%"}'
        echo "è´Ÿè½½æƒ…å†µï¼š" $(uptime | awk '{print $(NF-2), $(NF-1), $(NF)}')
        
        # å†…å­˜ä½¿ç”¨æƒ…å†µ
        echo -e "\nğŸ“š å†…å­˜ä½¿ç”¨æƒ…å†µï¼š"
        free -h | awk '/^Mem:/ {print "æ€»å†…å­˜: "$2 ", å·²ä½¿ç”¨: "$3 ", ç©ºé—²: "$4 ", å¯ç”¨: "$7}'
        
        # ç£ç›˜ä½¿ç”¨æƒ…å†µ
        echo -e "\nğŸ’¾ ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š"
        df -hT -x tmpfs -x devtmpfs | awk 'NR==1 || /^\/dev\// {print $0}'
        
        # ç½‘ç»œIPåœ°å€
        echo -e "\nğŸŒ ç½‘ç»œIPåœ°å€ï¼š"
        hostname -I | awk '{print $1}' | xargs -I{} echo "æœ¬æœºIPåœ°å€: {}"
        
        # Dockerå®¹å™¨çŠ¶æ€ (æ–°å¢åŠŸèƒ½ï¼)
        echo -e "\nğŸ³ Dockerå®¹å™¨è¿è¡ŒçŠ¶æ€ï¼š"
        if command -v docker &> /dev/null; then
            docker_ps=$(docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Status}}")
            
            if [[ $(docker ps -q | wc -l) -gt 0 ]]; then
                echo "å½“å‰è¿è¡Œçš„å®¹å™¨ï¼š"
                echo "$docker_ps"
            else
                echo "âš ï¸ å½“å‰æ²¡æœ‰è¿è¡Œä¸­çš„Dockerå®¹å™¨ã€‚"
            fi
        else
            echo "âŒ æœªæ£€æµ‹åˆ°Dockerç¯å¢ƒï¼Œè¯·å…ˆå®‰è£…Dockerã€‚"
        fi
        
        echo -e "\n==================================================="
        echo "âœ¨ æŒ‰ Ctrl + C éšæ—¶é€€å‡ºç›‘æ§ã€‚"
        
        # ç­‰å¾…2ç§’ååˆ·æ–°
        sleep 2
    done
}

# è„šæœ¬ä¸»å¾ªç¯ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªåŠŸèƒ½åè¿”å›èœå•
while true; do
    main_menu
    read -p "ğŸš© æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•..." temp
done
```

- å¢åŠ æ‰§è¡Œæƒé™

```bash
chmod +x auto-script.sh
```

- è¿è¡Œ

```bash 
./auto-script.sh
```

##  äºŒã€è„šæœ¬å†…å®¹è®²è§£

### 2.1 é…ç½®é™æ€ip

```bash
#!/bin/bash

# Debian 12 é™æ€IPé…ç½®è„šæœ¬ï¼Œç›´æ¥ç¼–è¾‘ /etc/network/interfacesï¼Œå¹¶æ‰‹åŠ¨æ›´æ–° /etc/resolv.conf DNSè®¾ç½®

INTERFACES_FILE="/etc/network/interfaces"
RESOLV_FILE="/etc/resolv.conf"

# å¤‡ä»½å½“å‰é…ç½®
cp ${INTERFACES_FILE} ${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
cp ${RESOLV_FILE} ${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
echo "å·²å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶ï¼š${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
echo "å·²å¤‡ä»½DNSé…ç½®æ–‡ä»¶ï¼š${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"

# è¾“å…¥ç½‘å¡åç§°
read -p "è¯·è¾“å…¥ç½‘å¡åï¼ˆå¦‚eth0æˆ–ens18ï¼Œé»˜è®¤ens18ï¼‰: " INTERFACE
INTERFACE=${INTERFACE:-ens18}

# è·å–ç³»ç»Ÿå½“å‰IPã€æ©ç ã€ç½‘å…³ã€DNSä½œä¸ºé»˜è®¤å€¼
CURRENT_IP=$(ip -4 addr show ${INTERFACE} | grep -oP '(?<=inet\s)\d+(\.\d+){3}')
CURRENT_NETMASK=$(ifconfig ${INTERFACE} | grep -oP '(?<=netmask\s)\d+(\.\d+){3}')
CURRENT_GATEWAY=$(ip route | grep default | grep ${INTERFACE} | awk '{print $3}')
CURRENT_DNS=$(grep "nameserver" /etc/resolv.conf | head -n1 | awk '{print $2}')

# è®¾ç½®é»˜è®¤å€¼ï¼ˆå¦‚æœè·å–ä¸åˆ°åˆ™ä½¿ç”¨å¸¸è§„é»˜è®¤å€¼ï¼‰
[ -z "$CURRENT_NETMASK" ] && CURRENT_NETMASK="255.255.255.0"
[ -z "$CURRENT_GATEWAY" ] && CURRENT_GATEWAY="192.168.1.1"
[ -z "$CURRENT_DNS" ] && CURRENT_DNS="8.8.8.8"

# ç”¨æˆ·è¾“å…¥æ–°é…ç½®ï¼Œæä¾›é»˜è®¤å€¼
read -p "è¯·è¾“å…¥é™æ€IPåœ°å€ï¼ˆé»˜è®¤ï¼š${CURRENT_IP}ï¼‰: " STATIC_IP
STATIC_IP=${STATIC_IP:-$CURRENT_IP}

read -p "è¯·è¾“å…¥å­ç½‘æ©ç ï¼ˆé»˜è®¤ï¼š${CURRENT_NETMASK}ï¼‰: " NETMASK
NETMASK=${NETMASK:-$CURRENT_NETMASK}

read -p "è¯·è¾“å…¥ç½‘å…³åœ°å€ï¼ˆé»˜è®¤ï¼š${CURRENT_GATEWAY}ï¼‰: " GATEWAY
GATEWAY=${GATEWAY:-$CURRENT_GATEWAY}

read -p "è¯·è¾“å…¥DNSæœåŠ¡å™¨ï¼ˆé»˜è®¤ï¼š${CURRENT_DNS}ï¼Œå¤šä¸ªDNSç©ºæ ¼åˆ†éš”ï¼‰: " DNS
DNS=${DNS:-$CURRENT_DNS}

# åˆ é™¤ interfaces æ–‡ä»¶ä¸­å·²æœ‰çš„è¯¥ç½‘å¡é…ç½®ï¼ˆè‹¥å­˜åœ¨ï¼‰
sed -i "/iface ${INTERFACE} inet/,/^$/d" ${INTERFACES_FILE}
sed -i "/auto ${INTERFACE}/d" ${INTERFACES_FILE}
sed -i "/allow-hotplug ${INTERFACE}/d" ${INTERFACES_FILE}

# å†™å…¥æ–°çš„é™æ€IPé…ç½®åˆ°interfacesæ–‡ä»¶
cat >> ${INTERFACES_FILE} <<EOF

auto ${INTERFACE}
iface ${INTERFACE} inet static
    address ${STATIC_IP}
    netmask ${NETMASK}
    gateway ${GATEWAY}
EOF

echo "é™æ€IPåœ°å€å·²æˆåŠŸé…ç½®åˆ°${INTERFACES_FILE}"

# å†™å…¥DNSé…ç½®åˆ°resolv.confæ–‡ä»¶
echo "# Generated by setup_static_ip.sh on $(date)" > ${RESOLV_FILE}
for dns_server in ${DNS}
do
    echo "nameserver ${dns_server}" >> ${RESOLV_FILE}
done

echo "DNSå·²æˆåŠŸé…ç½®åˆ°${RESOLV_FILE}"

# é‡å¯ç½‘ç»œæœåŠ¡ä»¥åº”ç”¨é…ç½®
systemctl restart networking

# æ˜¾ç¤ºå½“å‰ç½‘ç»œé…ç½®ä¸DNSé…ç½®
echo "å½“å‰${INTERFACE}æ¥å£ç½‘ç»œä¿¡æ¯ä¸ºï¼š"
ip addr show ${INTERFACE}
echo ""
echo "å½“å‰DNSé…ç½®ä¿¡æ¯ä¸ºï¼š"
cat ${RESOLV_FILE}
```

### 2.2 æ¢å¤dhcp

```bash
#!/bin/bash

# Debian 12 æ¢å¤ DHCP é…ç½®è„šæœ¬
# ç›´æ¥ç¼–è¾‘ /etc/network/interfaces æ–‡ä»¶å¹¶æ¢å¤DNSä¸ºDHCPè‡ªåŠ¨è·å–

INTERFACES_FILE="/etc/network/interfaces"
RESOLV_FILE="/etc/resolv.conf"

# å¤‡ä»½å½“å‰é…ç½®
cp ${INTERFACES_FILE} ${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
cp ${RESOLV_FILE} ${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
echo "å·²å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶ï¼š${INTERFACES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"
echo "å·²å¤‡ä»½DNSé…ç½®æ–‡ä»¶ï¼š${RESOLV_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"

# è¾“å…¥ç½‘å¡åç§°
read -p "è¯·è¾“å…¥è¦æ¢å¤ DHCP çš„ç½‘å¡åï¼ˆé»˜è®¤ ens18ï¼‰: " INTERFACE
INTERFACE=${INTERFACE:-ens18}

# åˆ é™¤ interfaces æ–‡ä»¶ä¸­å·²æœ‰çš„è¯¥ç½‘å¡é…ç½®ï¼ˆè‹¥å­˜åœ¨ï¼‰
sed -i "/iface ${INTERFACE} inet/,/^$/d" ${INTERFACES_FILE}
sed -i "/auto ${INTERFACE}/d" ${INTERFACES_FILE}
sed -i "/allow-hotplug ${INTERFACE}/d" ${INTERFACES_FILE}

# å†™å…¥ DHCP é…ç½®åˆ° interfaces æ–‡ä»¶
cat >> ${INTERFACES_FILE} <<EOF

allow-hotplug ${INTERFACE}
iface ${INTERFACE} inet dhcp
EOF

echo "å·²æˆåŠŸæ¢å¤ DHCP é…ç½®åˆ° ${INTERFACES_FILE}"

# æ¸…ç©º resolv.conf ä»¥ä¾¿ DHCP è‡ªåŠ¨æ›´æ–°DNS
echo "# Generated by restore_dhcp.sh on $(date)" > ${RESOLV_FILE}

# é‡å¯ç½‘ç»œæœåŠ¡åº”ç”¨é…ç½®
systemctl restart networking

# ç­‰å¾…å‡ ç§’é’Ÿè®© DHCP è·å–åœ°å€
echo "è¯·ç¨ç­‰å‡ ç§’é’Ÿï¼Œè®© DHCP è·å– IP åœ°å€..."
sleep 5

# æ˜¾ç¤ºå½“å‰ç½‘ç»œé…ç½®å’ŒDNSé…ç½®
echo "å½“å‰ ${INTERFACE} æ¥å£ç½‘ç»œä¿¡æ¯ä¸ºï¼š"
ip addr show ${INTERFACE}
echo ""
echo "å½“å‰ DNS é…ç½®ä¿¡æ¯ä¸ºï¼š"
cat ${RESOLV_FILE}
```

### 2.3 æ¢ä¸­ç§‘å¤§æº

```bash
#!/bin/bash

# Debian 12 ä¸€é”®æ¢æºè„šæœ¬ï¼ˆä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æºï¼‰
SOURCES_FILE="/etc/apt/sources.list"

# å¤‡ä»½åŸsources.listæ–‡ä»¶
cp ${SOURCES_FILE} ${SOURCES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')
echo "å·²å¤‡ä»½åŸæ–‡ä»¶ä¸º ${SOURCES_FILE}.bak_$(date '+%Y%m%d_%H%M%S')"

# æ¸…ç©ºåŸæ–‡ä»¶å†…å®¹ï¼Œå¹¶å†™å…¥æ–°æºå†…å®¹
cat > ${SOURCES_FILE} <<EOF
# é»˜è®¤æ³¨é‡Šäº†æºç ä»“åº“ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š
deb http://mirrors.ustc.edu.cn/debian bookworm main contrib non-free non-free-firmware
# deb-src http://mirrors.ustc.edu.cn/debian bookworm main contrib non-free non-free-firmware
deb http://mirrors.ustc.edu.cn/debian bookworm-updates main contrib non-free non-free-firmware
# deb-src http://mirrors.ustc.edu.cn/debian bookworm-updates main contrib non-free non-free-firmware

# backports è½¯ä»¶æºï¼Œè¯·æŒ‰éœ€å¯ç”¨
# deb http://mirrors.ustc.edu.cn/debian bookworm-backports main contrib non-free non-free-firmware
# deb-src http://mirrors.ustc.edu.cn/debian bookworm-backports main contrib non-free non-free-firmware
EOF

echo "å·²æˆåŠŸæ›¿æ¢è½¯ä»¶æºä¸ºä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒæºã€‚"

# æ›´æ–°è½¯ä»¶æº
apt update
```

### 2.4 å®‰è£…ufw

```bash
#!/bin/bash

# Debian 12 æ£€æŸ¥å¹¶å®‰è£…UFWé˜²ç«å¢™è„šæœ¬

# æ£€æŸ¥æ˜¯å¦å·²å®‰è£…UFW
if dpkg -s ufw &> /dev/null; then
    echo "âœ… UFW å·²ç»å®‰è£…ï¼Œæ— éœ€å†æ¬¡å®‰è£…ã€‚"
else
    echo "âš™ï¸ UFW æœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…ä¸­..."
    apt update
    apt install -y ufw

    # å†æ¬¡æ£€æŸ¥æ˜¯å¦æˆåŠŸå®‰è£…
    if dpkg -s ufw &> /dev/null; then
        echo "âœ… UFW å®‰è£…æˆåŠŸï¼"
    else
        echo "âŒ UFW å®‰è£…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–è½¯ä»¶æºè®¾ç½®ï¼"
        exit 1
    fi
fi

# æ˜¾ç¤ºUFWå½“å‰çŠ¶æ€
echo ""
echo "ğŸ” å½“å‰UFWçŠ¶æ€ï¼š"
ufw status verbose
```

### 2.5 ufwé…ç½®é˜²ç«å¢™

```bash
#!/bin/bash

# Debian 12 UFW é˜²ç«å¢™é…ç½®è„šæœ¬ï¼ˆç”¨æˆ·è‡ªå®šä¹‰å…è®¸æˆ–ç¦ç”¨ç«¯å£ï¼‰

# æ£€æŸ¥UFWæ˜¯å¦å·²å®‰è£…
if ! dpkg -s ufw &> /dev/null; then
    echo "âš ï¸ UFW å°šæœªå®‰è£…ï¼Œè¯·å…ˆæ‰§è¡Œå®‰è£…è„šæœ¬å†è¿›è¡Œæ­¤æ“ä½œã€‚"
    exit 1
fi

echo "ğŸš€ å¼€å§‹é…ç½®UFWé˜²ç«å¢™..."

# è®¾ç½®é»˜è®¤è§„åˆ™
echo "âš™ï¸ è®¾ç½®é»˜è®¤è§„åˆ™ï¼šé»˜è®¤æ‹’ç»å…¥ç«™æµé‡ï¼Œå…è®¸å‡ºç«™æµé‡..."
ufw default deny incoming
ufw default allow outgoing

# æ˜¾ç¤ºå½“å‰ufwçŠ¶æ€
echo ""
echo "ğŸ“‹ å½“å‰UFWè§„åˆ™å¦‚ä¸‹:"
ufw status numbered
echo ""

# å…è®¸ç”¨æˆ·æ–°å¢ç«¯å£
read -p "ğŸ›¡ï¸ æ˜¯å¦éœ€è¦å…è®¸æ–°çš„ç«¯å£ï¼Ÿ(y/n): " open_ports
if [[ "$open_ports" =~ ^[Yy]$ ]]; then
    read -p "è¯·è¾“å…¥ä½ æƒ³å…è®¸çš„ç«¯å£å·(å¦‚22 80 443)ï¼Œå¤šä¸ªç«¯å£ä»¥ç©ºæ ¼åˆ†éš”: " ports_allow
    for port in $ports_allow; do
        ufw allow $port && echo "âœ… å·²å…è®¸ç«¯å£ $port"
    done
fi

# å…è®¸ç”¨æˆ·ç¦ç”¨ä¹‹å‰å¼€æ”¾çš„ç«¯å£
read -p "ğŸš« æ˜¯å¦éœ€è¦ç¦ç”¨ä¹‹å‰å¼€æ”¾çš„ç«¯å£ï¼Ÿ(y/n): " close_ports
if [[ "$close_ports" =~ ^[Yy]$ ]]; then
    read -p "è¯·è¾“å…¥ä½ æƒ³ç¦ç”¨çš„ç«¯å£å·(å¦‚22 80 443)ï¼Œå¤šä¸ªç«¯å£ä»¥ç©ºæ ¼åˆ†éš”: " ports_deny
    for port in $ports_deny; do
        ufw delete allow $port && echo "âœ… å·²ç¦ç”¨ç«¯å£ $port" || echo "âš ï¸ ç¦ç”¨ç«¯å£ $port æ—¶å‡ºé”™æˆ–ä¸å­˜åœ¨è¯¥è§„åˆ™"
    done
fi

# å¯ç”¨ufwï¼ˆå¦‚æœæœªå¯ç”¨ï¼‰
echo ""
echo "ğŸŸ¢ å¯ç”¨UFWé˜²ç«å¢™..."
ufw --force enable

# é‡è½½è§„åˆ™
ufw reload

# æ˜¾ç¤ºå½“å‰é˜²ç«å¢™çŠ¶æ€
echo ""
echo "ğŸ“‹ æœ€ç»ˆUFWé˜²ç«å¢™çŠ¶æ€:"
ufw status verbose
```

### 2.6 å®‰è£…dockerå’Œdocker compose

```bash
apt update
apt install ca-certificates curl
install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
chmod a+r /etc/apt/keyrings/docker.asc

echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://mirrors.aliyun.com/docker-ce/linux/debian $(. /etc/os-release && echo "$VERSION_CODENAME") stable" |tee /etc/apt/sources.list.d/docker.list > /dev/null

apt update
apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y

systemctl start docker
systemctl enable docker

docker --version
docker compose version
```

### 2.7 sshå…å¯†ç™»é™†è®¾ç½®

```bash
#!/bin/bash

# SSHå…å¯†ç™»å½•é…ç½®è„šæœ¬ï¼ˆå®¢æˆ·ç«¯Windowsï¼‰

echo "ğŸš€ æœ¬è„šæœ¬å¸®åŠ©ä½ è®¾ç½®SSHå…¬é’¥ç™»å½•ï¼ˆå…å¯†ç ç™»å½•ï¼‰"
echo ""

# æç¤ºç”¨æˆ·åœ¨æœ¬åœ°ç”Ÿæˆå¯†é’¥å¯¹
echo "ğŸ”‘ è¯·åœ¨ä½ çš„ Windows 10 å®¢æˆ·ç«¯æ‰§è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆå¦‚æœªç”Ÿæˆï¼‰ï¼š"
echo ""
echo "    ssh-keygen -t rsa -b 4096"
echo ""
echo "âš ï¸ å‘½ä»¤æ‰§è¡Œåä¸€è·¯å›è½¦å³å¯ï¼Œå¯†é’¥é»˜è®¤ä¿å­˜åœ¨ C:\\Users\\ä½ çš„ç”¨æˆ·å\\.ssh\\"
echo ""

# æç¤ºç”¨æˆ·æ‰“å¼€å…¬é’¥æ–‡ä»¶å¹¶å¤åˆ¶å†…å®¹
echo "ğŸ“‹ è¯·åœ¨ Windows ä¸Šæ‰“å¼€å…¬é’¥æ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„ï¼‰ï¼š"
echo ""
echo "    C:\\Users\\ä½ çš„ç”¨æˆ·å\\.ssh\\id_rsa.pub"
echo ""
echo "ç„¶åå¤åˆ¶é‡Œé¢æ‰€æœ‰å†…å®¹ï¼Œæ¥ä¸‹æ¥å°†åœ¨æœåŠ¡å™¨ç«¯ç²˜è´´ã€‚"
echo ""

# ç­‰å¾…ç”¨æˆ·ç¡®è®¤
read -p "âœ… å·²å¤åˆ¶å…¬é’¥å†…å®¹åˆ°å‰ªè´´æ¿äº†å—ï¼Ÿï¼ˆy/nï¼‰ï¼š" is_copied

if [[ "$is_copied" =~ ^[Yy]$ ]]; then
    # åˆ›å»º.sshç›®å½•å¹¶è®¾ç½®æƒé™
    mkdir -p ~/.ssh
    chmod 700 ~/.ssh

    # ç”¨æˆ·ç²˜è´´å…¬é’¥åˆ°authorized_keys
    echo ""
    echo "âœï¸ è¯·å°†åˆšæ‰å¤åˆ¶çš„SSHå…¬é’¥å†…å®¹ç²˜è´´åˆ°ä¸‹æ–¹ï¼š"
    read -r ssh_pubkey

    # æ£€æŸ¥æ˜¯å¦ä¸ºç©º
    if [[ -z "$ssh_pubkey" ]]; then
        echo "âš ï¸ é”™è¯¯ï¼šæœªæ£€æµ‹åˆ°å…¬é’¥å†…å®¹ï¼Œé€€å‡ºé…ç½®ã€‚"
        exit 1
    fi

    # å°†å…¬é’¥å†™å…¥authorized_keysæ–‡ä»¶
    echo "$ssh_pubkey" >> ~/.ssh/authorized_keys
    chmod 600 ~/.ssh/authorized_keys

    echo ""
    echo "âœ… å…¬é’¥æ·»åŠ æˆåŠŸï¼"
else
    echo "âš ï¸ è¯·å…ˆå®Œæˆå…¬é’¥å¤åˆ¶æ“ä½œï¼Œå†é‡æ–°è¿è¡Œæœ¬è„šæœ¬ã€‚"
    exit 1
fi

# æç¤ºç”¨æˆ·æµ‹è¯•å…å¯†ç™»é™†
server_ip=$(hostname -I | awk '{print $1}')
current_user=$(whoami)

echo ""
echo "ğŸš© ç°åœ¨è¯·åœ¨ Windows å®¢æˆ·ç«¯ä¸Šæµ‹è¯•SSHå…å¯†ç™»é™†ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š"
echo ""
echo "    ssh ${current_user}@${server_ip}"
echo ""

echo "å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ æ— éœ€è¾“å…¥å¯†ç å³å¯æˆåŠŸç™»é™†ï¼ğŸš€"
```

### 2.8 ç³»ç»Ÿåƒåœ¾æ¸…ç†

```bash
#!/bin/bash

# è‡ªåŠ¨åˆ›å»º Debian åƒåœ¾æ¸…ç†è„šæœ¬å¹¶é…ç½®æ¯æœˆæœ«è‡ªåŠ¨æ‰§è¡Œçš„ä»»åŠ¡

CLEANUP_SCRIPT="/usr/local/bin/system_cleanup.sh"
LOG_FILE="/var/log/system_cleanup.log"

echo "ğŸš©å¼€å§‹åˆ›å»ºç³»ç»Ÿåƒåœ¾æ¸…ç†è„šæœ¬..."

# åˆ›å»ºè‡ªåŠ¨æ¸…ç†è„šæœ¬
cat > ${CLEANUP_SCRIPT} <<'EOF'
#!/bin/bash

# Debian ç³»ç»Ÿåƒåœ¾è‡ªåŠ¨æ¸…ç†è„šæœ¬

# æ¸…ç†APTç¼“å­˜
apt clean
apt autoclean
apt autoremove -y

# åˆ é™¤ä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/* /var/tmp/*

# åˆ é™¤æ—§çš„å‹ç¼©æ—¥å¿—
find /var/log -type f -name "*.gz" -exec rm -f {} \;
find /var/log -type f -name "*.1" -exec rm -f {} \;

# æ¸…ç©ºå…¶ä»–æ—¥å¿—æ–‡ä»¶
find /var/log -type f -exec truncate -s 0 {} \;

# åˆ é™¤ç”¨æˆ·çš„ç¼©ç•¥å›¾ç¼“å­˜ï¼ˆå¦‚æœæœ‰å›¾å½¢ç•Œé¢ï¼‰
rm -rf /home/*/.cache/thumbnails/*

# è¾“å‡ºæ‰§è¡Œæ—¶é—´åˆ°æ—¥å¿—
echo "ç³»ç»Ÿåƒåœ¾æ¸…ç†å®Œæˆäº $(date)" >> /var/log/system_cleanup.log
EOF

# ç»™è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x ${CLEANUP_SCRIPT}

echo "âœ… åƒåœ¾æ¸…ç†è„šæœ¬åˆ›å»ºæˆåŠŸï¼Œè·¯å¾„ä¸ºï¼š${CLEANUP_SCRIPT}"

# é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯æœˆæœˆåº•è‡ªåŠ¨æ‰§è¡Œï¼‰
echo "ğŸš© æ­£åœ¨é…ç½®å®šæ—¶ä»»åŠ¡..."

(crontab -l 2>/dev/null | grep -v "${CLEANUP_SCRIPT}"; \
echo '59 23 28-31 * * [ "$(date -d tomorrow '\''+\%d'\'')" = "01" ] && /usr/local/bin/system_cleanup.sh') | crontab -

echo "âœ… å®šæ—¶ä»»åŠ¡é…ç½®å®Œæˆï¼"

# æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æ·»åŠ æˆåŠŸ
echo ""
echo "ğŸš© æ­£åœ¨æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦æ·»åŠ æˆåŠŸ..."

if crontab -l | grep -q "${CLEANUP_SCRIPT}"; then
    echo "âœ… å®šæ—¶ä»»åŠ¡æ·»åŠ æˆåŠŸï¼å½“å‰å®šæ—¶ä»»åŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š"
    crontab -l | grep "${CLEANUP_SCRIPT}"
else
    echo "âŒ å®šæ—¶ä»»åŠ¡æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥åé‡è¯•ï¼"
    exit 1
fi

echo ""
echo "ğŸ‰å…¨éƒ¨é…ç½®å®Œæˆï¼ç³»ç»Ÿæ¯æœˆæœ€åä¸€å¤©23:59å°†è‡ªåŠ¨æ¸…ç†åƒåœ¾æ–‡ä»¶ã€‚"
echo "æ¸…ç†æ—¥å¿—åœ¨ï¼š${LOG_FILE}"
```

### 2.9 ç³»ç»Ÿæ€§èƒ½å’Œå­˜å‚¨ä¼˜åŒ–

```bash
#!/bin/bash

echo "ğŸš€ å¼€å§‹ Debian 12 (PVE è™šæ‹Ÿæœº) æ€§èƒ½ä¼˜åŒ–..."

# 1ï¸âƒ£ ä¼˜åŒ– swappiness å‚æ•°ä¸º10ï¼Œé™ä½swapä½¿ç”¨é¢‘ç‡
echo "âœ… æ­£åœ¨è®¾ç½® swappiness å‚æ•°ä¸º10..."
if grep -q "vm.swappiness" /etc/sysctl.conf; then
    sed -i 's/^vm.swappiness.*/vm.swappiness = 10/' /etc/sysctl.conf
else
    echo "vm.swappiness = 10" >> /etc/sysctl.conf
fi
sysctl -p

# 2ï¸âƒ£ å¯ç”¨ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•ä»¥æé«˜ç½‘ç»œæ€§èƒ½ï¼ˆè™šæ‹Ÿæœºé€‚ç”¨ï¼‰
echo "âœ… æ­£åœ¨å¯ç”¨ TCP BBR æ‹¥å¡æ§åˆ¶ç®—æ³•..."
if ! grep -q "net.core.default_qdisc" /etc/sysctl.conf; then
    echo "net.core.default_qdisc = fq" >> /etc/sysctl.conf
fi
if ! grep -q "net.ipv4.tcp_congestion_control" /etc/sysctl.conf; then
    echo "net.ipv4.tcp_congestion_control = bbr" >> /etc/sysctl.conf
fi
sysctl -p

# éªŒè¯ TCP BBR æ˜¯å¦å¯ç”¨æˆåŠŸ
if sysctl net.ipv4.tcp_congestion_control | grep -q "bbr"; then
    echo "âœ… TCP BBR å·²æˆåŠŸå¯ç”¨ï¼"
else
    echo "âŒ TCP BBR å¯ç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬æ˜¯å¦æ”¯æŒï¼"
fi

# 3ï¸âƒ£ æ£€æµ‹è™šæ‹Ÿæœºç£ç›˜æ˜¯å¦æ”¯æŒ TRIM (discard)ï¼Œå†å†³å®šæ˜¯å¦å¯ç”¨å®šæœŸ TRIM
echo "âœ… æ­£åœ¨æ£€æµ‹è™šæ‹Ÿç£ç›˜æ˜¯å¦æ”¯æŒ TRIM (discard)..."

DISCARD_SUPPORT=$(lsblk -D | awk 'NR>1 && $4=="0B" {print $1}' | wc -l)

if [ "$DISCARD_SUPPORT" -ne 0 ]; then
    echo "âš ï¸ æ£€æµ‹åˆ°è™šæ‹Ÿç£ç›˜ä¸æ”¯æŒ TRIMï¼Œè·³è¿‡å¯ç”¨ fstrim æœåŠ¡ã€‚"
else
    echo "âœ… è™šæ‹Ÿç£ç›˜æ”¯æŒ TRIMï¼Œæ­£åœ¨å¯ç”¨ fstrim æœåŠ¡..."
    systemctl enable --now fstrim.timer

    # éªŒè¯ fstrim æœåŠ¡çŠ¶æ€
    if systemctl is-enabled fstrim.timer | grep -q "enabled"; then
        echo "âœ… fstrim å®šæœŸ TRIM æœåŠ¡å·²æˆåŠŸå¯ç”¨ï¼"
    else
        echo "âŒ fstrim æœåŠ¡å¯ç”¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ã€‚"
    fi
fi

echo ""
echo "ğŸ‰ Debian 12 (PVE è™šæ‹Ÿæœº) æ€§èƒ½ä¼˜åŒ–é…ç½®å®Œæˆï¼"
```

### 2.10 æ—¶é—´åŒæ­¥å’Œè®¾ç½®æ—¶åŒº

```bash
#!/bin/bash

echo "ğŸŒ Debian 12 (PVEè™šæ‹Ÿæœº) æ—¶é—´åŒæ­¥ä¸æ—¶åŒºè®¾ç½®è„šæœ¬ã€é»˜è®¤æ—¶åŒº: Asia/Shanghaiã€‘"

# æ£€æŸ¥æ˜¯å¦ä»¥rootæƒé™è¿è¡Œ
if [ "$EUID" -ne 0 ]; then
    echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
    exit 1
fi

# ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œå¯ç”¨chronyæœåŠ¡è¿›è¡Œæ—¶é—´åŒæ­¥
echo "ğŸš© æ­£åœ¨å®‰è£…å’Œå¯ç”¨chronyæ—¶é—´åŒæ­¥æœåŠ¡..."
apt update
apt install -y chrony

# å¯ç”¨å¹¶å¯åŠ¨chronyæœåŠ¡
systemctl enable --now chrony

# éªŒè¯chronyæœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ
if systemctl is-active chrony | grep -q "active"; then
    echo "âœ… chronyæœåŠ¡å·²æˆåŠŸå¯åŠ¨å’Œå¯ç”¨ï¼"
else
    echo "âŒ chronyæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
    exit 1
fi

# å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡æ—¶é—´åŒæ­¥
chronyc -a makestep

# æ˜¾ç¤ºå½“å‰æ—¶é—´åŒæ­¥æºçŠ¶æ€
echo ""
echo "ğŸ•’ å½“å‰chronyæ—¶é—´åŒæ­¥æºçŠ¶æ€ï¼š"
chronyc sources -v
echo ""

# ç¬¬äºŒæ­¥ï¼šäº¤äº’å¼è®¾ç½®æ—¶åŒºï¼ˆé»˜è®¤Asia/Shanghaiï¼ŒæŒ‰å›è½¦ä½¿ç”¨é»˜è®¤å€¼ï¼‰
default_timezone="Asia/Shanghai"
current_tz=$(timedatectl | grep "Time zone" | awk '{print $3}')
echo "â° å½“å‰ç³»ç»Ÿæ—¶åŒºä¸ºï¼š$current_tz"
echo ""

echo "è¯·è¾“å…¥ä½ æƒ³è®¾ç½®çš„æ—¶åŒºï¼Œä¾‹å¦‚ï¼šAsia/Shanghai"
echo "å¯ç”¨çš„æ—¶åŒºåˆ—è¡¨å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/List_of_tz_database_time_zones"
read -p "è¯·è¾“å…¥æ–°çš„æ—¶åŒº (é»˜è®¤: ${default_timezone}): " new_timezone

# å¦‚æœç”¨æˆ·æœªè¾“å…¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
if [ -z "$new_timezone" ]; then
    new_timezone="$default_timezone"
fi

# æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ—¶åŒºæ˜¯å¦æœ‰æ•ˆ
if [ ! -f "/usr/share/zoneinfo/$new_timezone" ]; then
    echo "âŒ æ—¶åŒº [$new_timezone] ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ‹¼å†™åé‡æ–°è¿è¡Œè„šæœ¬ï¼"
    exit 1
fi

# è®¾ç½®æ–°æ—¶åŒº
timedatectl set-timezone "$new_timezone"

# æ˜¾ç¤ºè®¾ç½®åçš„æ—¶åŒºå’Œæ—¶é—´
echo ""
echo "âœ… æ—¶åŒºè®¾ç½®æˆåŠŸï¼å½“å‰æ—¶åŒºä¸ºï¼š$(timedatectl | grep "Time zone" | awk '{print $3}')"
echo "ğŸ•’ å½“å‰ç³»ç»Ÿæ—¶é—´ä¸ºï¼š$(date)"
```

### 2.11 ç¦ç”¨ipv6

```bash
#!/bin/bash

echo "ğŸš© å¼€å§‹ç¦ç”¨ Debian 12 ç³»ç»Ÿ IPv6 åŠŸèƒ½..."

# æ£€æŸ¥æ˜¯å¦ä»¥rootæƒé™è¿è¡Œ
if [ "$EUID" -ne 0 ]; then
    echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
    exit 1
fi

# å¤‡ä»½sysctl.confæ–‡ä»¶
sysctl_conf="/etc/sysctl.conf"
backup_conf="/etc/sysctl.conf.bak_ipv6"
if [ ! -f "$backup_conf" ]; then
    cp $sysctl_conf $backup_conf
    echo "âœ… å·²å¤‡ä»½åŸå§‹sysctl.confè‡³ $backup_conf"
fi

# ç¦ç”¨IPv6çš„sysctlé…ç½®
echo "âœ… æ­£åœ¨é…ç½®ç¦ç”¨IPv6..."
cat <<EOF >> $sysctl_conf

# ç¦ç”¨IPv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
EOF

# ç«‹å³åº”ç”¨é…ç½®
sysctl -p

# ç¦ç”¨IPv6æ¨¡å—åŠ è½½ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰
echo "âœ… æ­£åœ¨é…ç½®ç¦æ­¢IPv6æ¨¡å—åŠ è½½..."
modprobe_conf="/etc/modprobe.d/disable_ipv6.conf"
echo "options ipv6 disable=1" > $modprobe_conf

# æ›´æ–°initramfsä½¿æ¨¡å—ç¦ç”¨ç”Ÿæ•ˆ
update-initramfs -u

# éªŒè¯IPv6æ˜¯å¦ç¦ç”¨æˆåŠŸ
if sysctl net.ipv6.conf.all.disable_ipv6 | grep -q "1"; then
    echo "âœ… IPv6å·²æˆåŠŸç¦ç”¨ï¼"
else
    echo "âŒ IPv6ç¦ç”¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
fi

echo ""
echo "ğŸ‰ Debian 12 IPv6ç¦ç”¨é…ç½®å®Œæˆï¼è¯·é‡å¯ç³»ç»Ÿä»¥ç¡®ä¿å½»åº•ç”Ÿæ•ˆï¼ˆæ¨èï¼‰ï¼"
```

### 2.12 ä¿®æ”¹ä¸»æœºå

```bash
#!/bin/bash

echo "ğŸš© Debian 12 ä¸»æœºåä¿®æ”¹è„šæœ¬"

# æ£€æŸ¥æ˜¯å¦ä»¥rootæƒé™è¿è¡Œ
if [ "$EUID" -ne 0 ]; then
    echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
    exit 1
fi

# æ˜¾ç¤ºå½“å‰ä¸»æœºå
current_hostname=$(hostnamectl hostname)
echo "ğŸ”– å½“å‰ä¸»æœºåä¸ºï¼š$current_hostname"
echo ""

# æç¤ºç”¨æˆ·è¾“å…¥æ–°çš„ä¸»æœºå (é»˜è®¤ä¸ºå½“å‰ä¸»æœºå)
read -p "è¯·è¾“å…¥æ–°çš„ä¸»æœºå (é»˜è®¤: $current_hostname): " new_hostname

# å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥ï¼Œä½¿ç”¨å½“å‰ä¸»æœºå
if [ -z "$new_hostname" ]; then
    new_hostname=$current_hostname
fi

# éªŒè¯ä¸»æœºååˆæ³•æ€§ï¼ˆä»…å…è®¸å­—æ¯ã€æ•°å­—ã€çŸ­æ¨ªçº¿ï¼Œé•¿åº¦1-63å­—ç¬¦ï¼‰
if [[ ! $new_hostname =~ ^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}$ ]]; then
    echo "âŒ ä¸»æœºå [$new_hostname] ä¸åˆæ³•ï¼ä»…å…è®¸å­—æ¯ã€æ•°å­—ã€çŸ­æ¨ªçº¿ï¼Œä¸”é•¿åº¦ä¸º1-63å­—ç¬¦ã€‚"
    exit 1
fi

# è®¾ç½®æ–°ä¸»æœºå
echo "âœ… æ­£åœ¨è®¾ç½®æ–°ä¸»æœºåä¸ºï¼š$new_hostname"
hostnamectl set-hostname "$new_hostname"

# ä¿®æ”¹/etc/hostsæ–‡ä»¶ï¼Œç¡®ä¿ä¸»æœºåè§£ææ­£ç¡®
if grep -q "127.0.1.1" /etc/hosts; then
    sed -i "/127.0.1.1/c\127.0.1.1\t$new_hostname" /etc/hosts
else
    echo -e "127.0.1.1\t$new_hostname" >> /etc/hosts
fi

# æ˜¾ç¤ºä¿®æ”¹åçš„ä¸»æœºåä¿¡æ¯
echo ""
echo "âœ… ä¸»æœºåä¿®æ”¹æˆåŠŸï¼å½“å‰ä¸»æœºåä¿¡æ¯ï¼š"
hostnamectl status

echo ""
echo "ğŸ‰ ä¸»æœºåè®¾ç½®å®Œæˆï¼å»ºè®®é‡å¯ä¸€æ¬¡ç³»ç»Ÿä»¥ç¡®ä¿æ‰€æœ‰æœåŠ¡ç”Ÿæ•ˆï¼ˆæ¨èï¼‰ã€‚"
```

### 2.13 å®‰è£…qemu-guest-agent

```bash
#!/bin/bash

echo "ğŸš© Debian 12 (PVE è™šæ‹Ÿæœº) qemu-guest-agent è‡ªåŠ¨å®‰è£…è„šæœ¬"

# æ£€æŸ¥æ˜¯å¦ä»¥ root æƒé™è¿è¡Œ
if [ "$EUID" -ne 0 ]; then
    echo "âŒ è¯·ä»¥ root æˆ– sudo æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦å·²å®‰è£… qemu-guest-agent
if dpkg -s qemu-guest-agent &> /dev/null; then
    echo "âœ… qemu-guest-agent å·²å®‰è£…ï¼Œè·³è¿‡å®‰è£…æ­¥éª¤ã€‚"
else
    # æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£… qemu-guest-agent
    echo "âœ… æ­£åœ¨æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£… qemu-guest-agent..."
    apt update
    apt install -y qemu-guest-agent
fi

# å¯ç”¨å¹¶å¯åŠ¨ qemu-guest-agent æœåŠ¡
echo "âœ… æ­£åœ¨å¯ç”¨å¹¶å¯åŠ¨ qemu-guest-agent æœåŠ¡..."
systemctl enable --now qemu-guest-agent

# æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
echo ""
if systemctl is-active qemu-guest-agent | grep -q "active"; then
    echo "âœ… qemu-guest-agent æœåŠ¡å·²æˆåŠŸè¿è¡Œï¼"
else
    echo "âŒ qemu-guest-agent æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
    exit 1
fi

echo ""
echo "ğŸ‰ qemu-guest-agent å®‰è£…å’Œé…ç½®å®Œæˆï¼"
echo "ğŸ”„ è¯·é‡å¯æ­¤è™šæ‹Ÿæœºï¼Œä»¥ç¡®ä¿ Proxmox VE èƒ½å®Œæ•´è¯†åˆ«å¹¶ä½¿ç”¨ qemu-guest-agentï¼"
```

### 2.14 å®‰è£…openssh

```bash
#!/bin/bash
echo "ğŸš€ æ­£åœ¨å®‰è£…OpenSSHæœåŠ¡å¹¶å¯ç”¨rootç™»å½•..."
apt update && apt install -y openssh-server
systemctl enable --now ssh

SSH_CONFIG="/etc/ssh/sshd_config"
BACKUP_CONFIG="/etc/ssh/sshd_config.bak_$(date '+%Y%m%d_%H%M%S')"
cp ${SSH_CONFIG} ${BACKUP_CONFIG}

sed -i 's/^#*PermitRootLogin.*/PermitRootLogin yes/' ${SSH_CONFIG}
sed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication yes/' ${SSH_CONFIG}

systemctl restart ssh
```

### 2.15 ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

```bash
#!/bin/bash

# å®šä¹‰Ctrl+Cé€€å‡ºæ—¶çš„æç¤ºå‡½æ•°
exit_script() {
    echo ""
    echo "ğŸ‘‹ å·²é€€å‡ºç³»ç»Ÿå®æ—¶çŠ¶æ€ç›‘æ§ã€‚"
    exit 0
}

# æ•è·Ctrl+Cä¿¡å·ï¼Œè°ƒç”¨é€€å‡ºå‡½æ•°
trap exit_script SIGINT

# æ— é™å¾ªç¯å±•ç¤ºç³»ç»ŸçŠ¶æ€ï¼Œæ¯2ç§’åˆ·æ–°ä¸€æ¬¡
while true
do
    clear
    echo "ğŸ“Š Debian 12 ç³»ç»Ÿå®æ—¶çŠ¶æ€ç›‘æ§ï¼ˆæ¯2ç§’åˆ·æ–°ï¼‰"
    echo "==================================================="

    # å½“å‰ç³»ç»Ÿæ—¶é—´
    echo -e "\nâ° å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š$(date '+%Y-%m-%d %H:%M:%S')"

    # ä¸»æœºåå’Œç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯
    echo -e "\nğŸ”– ä¸»æœºåï¼š$(hostname)"
    echo "ğŸ“Œ ç³»ç»Ÿç‰ˆæœ¬ï¼š$(lsb_release -d | awk -F '\t' '{print $2}')"

    # ç³»ç»Ÿè¿è¡Œæ—¶é—´
    echo -e "\nğŸš€ ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼š$(uptime -p)"

    # CPUä½¿ç”¨ç‡ä¸è´Ÿè½½
    echo -e "\nğŸ–¥ï¸ CPUä½¿ç”¨ç‡ä¸è´Ÿè½½ï¼š"
    top -b -n1 | grep "Cpu(s)" | awk '{print "å½“å‰CPUä½¿ç”¨æƒ…å†µï¼š " 100 - $8 "%"}'
    echo "è´Ÿè½½æƒ…å†µï¼š" $(uptime | awk '{print $(NF-2), $(NF-1), $(NF)}')

    # å†…å­˜ä½¿ç”¨æƒ…å†µ
    echo -e "\nğŸ“š å†…å­˜ä½¿ç”¨æƒ…å†µï¼š"
    free -h | awk '/^Mem:/ {print "æ€»å†…å­˜: "$2 ", å·²ä½¿ç”¨: "$3 ", ç©ºé—²: "$4 ", å¯ç”¨: "$7}'

    # ç£ç›˜ä½¿ç”¨æƒ…å†µ
    echo -e "\nğŸ’¾ ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š"
    df -hT -x tmpfs -x devtmpfs | awk 'NR==1 || /^\/dev\// {print $0}'

    # ç½‘ç»œIPåœ°å€
    echo -e "\nğŸŒ ç½‘ç»œIPåœ°å€ï¼š"
    hostname -I | awk '{print $1}' | xargs -I{} echo "æœ¬æœºIPåœ°å€: {}"

    # Dockerå®¹å™¨çŠ¶æ€ (æ–°å¢åŠŸèƒ½ï¼)
    echo -e "\nğŸ³ Dockerå®¹å™¨è¿è¡ŒçŠ¶æ€ï¼š"
    if command -v docker &> /dev/null; then
        docker_ps=$(docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Status}}")

        if [[ $(docker ps -q | wc -l) -gt 0 ]]; then
            echo "å½“å‰è¿è¡Œçš„å®¹å™¨ï¼š"
            echo "$docker_ps"
        else
            echo "âš ï¸ å½“å‰æ²¡æœ‰è¿è¡Œä¸­çš„Dockerå®¹å™¨ã€‚"
        fi
    else
        echo "âŒ æœªæ£€æµ‹åˆ°Dockerç¯å¢ƒï¼Œè¯·å…ˆå®‰è£…Dockerã€‚"
    fi

    echo -e "\n==================================================="
    echo "âœ¨ æŒ‰ Ctrl + C éšæ—¶é€€å‡ºç›‘æ§ã€‚"

    # ç­‰å¾…2ç§’ååˆ·æ–°
    sleep 2
done
```

